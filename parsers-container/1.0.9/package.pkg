KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50KSA9PiB7DQogICAgdmFyIHJldHVybk9iamVjdCA9IHt9Ow0KICAgIHJldHVybk9iamVjdC5pZCA9ICIxLmFsbG5vdmVsIjsNCiAgICByZXR1cm5PYmplY3QuZGV0YWxpSXRlbVR5cGUgPSBEZXRhbGlJdGVtVHlwZS5Ob3ZlbDsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyTGFuZ3VhZ2UgPSAiZW4iOw0KICAgIHJldHVybk9iamVjdC5uYW1lID0gJ0FsbE5vdmVsJzsNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vYWxsbm92ZWwubmV0Lyc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL2FsbG5vdmVsLm5ldC8nOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hVcmwgPSAnaHR0cHM6Ly9hbGxub3ZlbC5uZXQvc2VhcmNoLnBocD9rZXl3b3JkPXtxfSc7DQogICAgcmV0dXJuT2JqZWN0LnBhbmluYXRpb24gPSBmYWxzZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly9hbGxub3ZlbC5uZXQvbWVkaWEvZmF2aWNvbi5wbmcnOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJSb21hbmNlIiwgInJvbWFuY2UuaHRtbD9wYWdlPXtwfSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkFkdmVudHVyZSIsICJhZHZlbnR1cmUuaHRtbD9wYWdlPXtwfSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlRocmlsbGVyIiwgInRocmlsbGVyLmh0bWw/cGFnZT17cH0iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJGYW50YXN5IiwgImZhbnRhc3kuaHRtbD9wYWdlPXtwfSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIllvdW5nIEFkdWx0IiwgInlvdW5nLWFkdWx0Lmh0bWw/cGFnZT17cH0iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNeXN0ZXJ5IiwgIm15c3RlcnkuaHRtbD9wYWdlPXtwfSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhpc3RvcmljYWwiLCAiaGlzdG9yaWNhbC5odG1sP3BhZ2U9e3B9IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSG9ycm9yIiwgImhvcnJvci5odG1sP3BhZ2U9e3B9IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2NpZW5jZSBGaWN0aW9uIiwgInNjaWVuY2UtZmljdGlvbi5odG1sP3BhZ2U9e3B9IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSHVtb3JvdXMiLCAiaHVtb3JvdXMuaHRtbD9wYWdlPXtwfSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkNocmlzdGlhbiIsICJjaHJpc3RpYW4uaHRtbD9wYWdlPXtwfSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIldlc3Rlcm4iLCAid2VzdGVybi5odG1sP3BhZ2U9e3B9IikNCiAgICAgICAgXQ0KICAgIH0NCiAgICByZXR1cm5PYmplY3QuZ2V0U2VjdGlvbnMgPSAoa2V5cykgPT4gew0KICAgICAgICB2YXIgc2VjdGlvbnMgPSBbDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibGF0ZXN0IiwgIkxhdGVzdCBVcGRhdGUiLCAiTGF0ZXN0IiwgdHJ1ZSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigicm9tYW5jZSIsICJSb21hbmNlIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsicm9tYW5jZS5odG1sP3BhZ2U9e3B9Il0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJ5b3VuZy1hZHVsdCIsICJZb3VuZyBBZHVsdCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcihbInlvdW5nLWFkdWx0Lmh0bWw/cGFnZT17cH0iXSkpLA0KICAgICAgICBdDQoNCiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICB2YXIgZmlsdGVyID0gbmV3IEZpbHRlcigpOw0KICAgICAgICByZXR1cm4gZmlsdGVyOw0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoIWZpbHRlci50aXRsZSkNCiAgICAgICAgICAgIGZpbHRlci50aXRsZSA9ICIiOw0KICAgICAgICBpZiAoZmlsdGVyLmdlbnJlcy5sZW5ndGggPD0gMCAmJiBmaWx0ZXIudGl0bGUgPT0gIiIpDQogICAgICAgICAgICByZXR1cm4gW107DQogICAgICAgIHZhciB1cmwgPSBmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDAgPyBmaWx0ZXIuZ2VucmVzWzBdLnRvU3RyaW5nKCkudXJpKHJldHVybk9iamVjdC51cmwpLnJlcGxhY2UoIntwfSIsIHBhZ2UpIDogcmV0dXJuT2JqZWN0LnNlYXJjaFVybC5yZXBsYWNlKCJ7cX0iLCBmaWx0ZXIudGl0bGUpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW10NCiAgICAgICAgcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwodXJsKSkuZmluZCgiLmxpc3Qtbm92ZWwgYSIpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJpbWciKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnRpdGxlLWhvbWUtbm92ZWwiKS50ZXh0KCksDQogICAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgICAgeC5hdHRyKCJocmVmIikudXJsKCksDQogICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUpKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Tm92ZWwgPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCg0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwpKTsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gY29udGFpbmVyLmZpbmQoIi5saXN0LXBhZ2Utbm92ZWwgYSIpLm1hcCh4ID0+IG5ldyBDaGFwdGVyKHgudGV4dChmYWxzZSksIHguYXR0cigiaHJlZiIpLnVybCgpKSk7DQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIHZhciBpbmZvID0gY29udGFpbmVyLmZpbmQoIi5saXN0LWluZm8iKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGluZm8uZXEoMSkuZmluZCgiYSIpLnRleHRBcnJheSgpOw0KICAgICAgICBub3ZlbFJldmlld3MuYXV0aG9yID0gaW5mby5lcSgwKS5zZWxlY3QoImEiKS50ZXh0KGZhbHNlKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLnV2b3RlcyA9IGluZm8uZXEoMikuc2VsZWN0KCJzcGFuIikuaGFzRWxlbWVudCgpID8gaW5mby5lcSgyKS5zZWxlY3QoInNwYW4iKS50ZXh0KGZhbHNlKSArICIgVmlld3MiIDogIiI7DQogICAgICAgIHJldHVybiBuZXcgRGV0YWxpSXRlbSgNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoIi5yb3cgaW1nIikuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCIuZGV0YWlsLW5vdmVsIGgxIikudGV4dChmYWxzZSksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCIuZGVzLW5vdmVsIikuY2xlYW5Jbm5lckhUTUwoKSwNCiAgICAgICAgICAgIG5vdmVsVXJsLA0KICAgICAgICAgICAgY2hhcHRlcnMsDQogICAgICAgICAgICBub3ZlbFJldmlld3MsDQogICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgIHVuZGVmaW5lZCwNCiAgICAgICAgKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlciA9IGFzeW5jICh1cmwpID0+IHsNCiAgICAgICAgcmV0dXJuIHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgbmV3IGNsaWVudCgpLmdldEh0bWwodXJsKSkucmVtb3ZlKCIuYWQtY29udGFpbmVyIikuc2VsZWN0KCIuY29udGVudF9ub3ZlbCIpLmNsZWFuSW5uZXJIVE1MKCk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdCA9IGFzeW5jIChwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3QubGF0ZXN0VXJsLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLmxpc3Qtbm92ZWwgYSIpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJpbWciKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnRpdGxlLWhvbWUtbm92ZWwiKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICB4LmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIHJldHVybiByZXR1cm5PYmplY3Q7DQp9Ow==&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5ib3hub3ZlbCI7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCiAgICByZXR1cm5PYmplY3QubmFtZSA9ICdCb3hOb3ZlbCc7DQogICAgcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdFVybCA9ICdodHRwczovL2JveG5vdmVsLmNvbS9wYWdlL3twfSc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL2JveG5vdmVsLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICcnOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly9ib3hub3ZlbC5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTgvMDQvYm94LWljb24tMTUweDE1MC5wbmcnOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgXSwNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LmxvYWRTZXR0aW5ncyA9IGFzeW5jICgpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKCJodHRwczovL2JveG5vdmVsLmNvbS8/cz0mcG9zdF90eXBlPXdwLW1hbmdhIikpOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLmNoZWNrYm94LWdyb3VwIC5jaGVja2JveCIpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MuZ2VucmVzLnZhbHVlcy5wdXNoKG5ldyBsYWJlbFZhbHVlKHguc2VsZWN0KCJsYWJlbCIpLnRleHQoKSwgeC5zZWxlY3QoImlucHV0IikuYXR0cigidmFsdWUiKS50ZXh0KCkpKTsNCiAgICAgICAgfSkNCiAgICB9DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnNvcnRUeXBlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdMYXRlc3QgUmVsZWFzZSBOb3ZlbCcsICdsYXRlc3QnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdSZWxldmFuY2UnLCAnJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUmF0aW5nJywgJ3JhdGluZycpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1RyZW5kaW5nJywgJ3RyZW5kaW5nJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTW9zdCBWaWV3cycsICd2aWV3cycpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ05ldycsICduZXctbWFuZ2EnKSwNCiAgICAgICAgXSwNCiAgICB9Ow0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJuZXciLCAiTmV3IE5vdmVscyIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJuZXctbWFuZ2EiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiTW9zdCBWaWV3cyIsICJNb3N0IFZpZXdzIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgInZpZXdzIikpLA0KICAgICAgICBdDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgIH0NCiAgICByZXR1cm5PYmplY3QudHJhbnNsYXRlU2VjdGlvbiA9IGFzeW5jIChzZWN0aW9uLCBwYWdlKSA9PiB7DQogICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QubGF0ZXN0KHBhZ2UpOw0KICAgICAgICBlbHNlIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCiAgICByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlciA9ICgpID0+IHsNCiAgICAgICAgdmFyIGZpbHRlciA9IG5ldyBGaWx0ZXIoKTsNCiAgICAgICAgcmV0dXJuIGZpbHRlcjsNCiAgICB9Ow0KDQogICAgLy9odHRwczovL2JveG5vdmVsLmNvbS9wYWdlLzIvP3MmcG9zdF90eXBlPXdwLW1hbmdhJmdlbnJlJTVCMCU1RD1hY3Rpb24mZ2VucmUlNUIxJTVEPWFkdmVudHVyZSZvcCZhdXRob3ImYXJ0aXN0JnJlbGVhc2UmYWR1bHQmbV9vcmRlcmJ5PWxhdGVzdA0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSBgaHR0cHM6Ly9ib3hub3ZlbC5jb20vcGFnZS8ke3BhZ2V9Lz9zPSR7ZmlsdGVyLnRpdGxlIHx8ICIifSZwb3N0X3R5cGU9d3AtbWFuZ2Eme2dlbnJlfSZvcCZhdXRob3ImYXJ0aXN0JnJlbGVhc2UmYWR1bHQmbV9vcmRlcmJ5PSR7ZmlsdGVyLnNvcnRUeXBlIHx8ICIifWANCiAgICAgICAgaWYgKGZpbHRlci5nZW5yZXMgJiYgZmlsdGVyLmdlbnJlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgie2dlbnJlfSIsIGZpbHRlci5nZW5yZXMubWFwKHggPT4gImdlbnJlJTVCMCU1RD0iICsgeCkuam9pbigiJiIpKQ0KICAgICAgICB9IGVsc2UgdXJsID0gdXJsLnJlcGxhY2UoIiZ7Z2VucmV9IiwgIiIpDQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgnLnRhYi1jb250ZW50LXdyYXAgLmMtdGFicy1pdGVtIC50YWItdGh1bWIgYScpLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoJ2ltZycpLmF0dHIoInNyYyIpLnVybCgpLCB4LmF0dHIoInRpdGxlIikudGV4dCgpLCAnJywgeC5hdHRyKCJocmVmIikudXJsKCksIHJldHVybk9iamVjdC5uYW1lKSk7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCiAgICByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlcnMgPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHZhciBjaGFwdGVycyA9IFtdOw0KICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5wb3N0Rm9ybSgiYWpheC9jaGFwdGVycyIudXJpKG5vdmVsVXJsKSwge2tleTogInRlc3QifSkpOw0KICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5saXN0aW5nLWNoYXB0ZXJzX3dyYXAgYScpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICAgICAgY2hhcHRlcnMucHVzaChuZXcgQ2hhcHRlcih4LnRleHQoZmFsc2UpLCB4LmF0dHIoImhyZWYiKS51cmwoKSkpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICByZXR1cm4gY2hhcHRlcnMucmV2ZXJzZSgpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhlKQ0KICAgICAgICAgICAgdGhyb3cgZQ0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybk9iamVjdC5nZXROb3ZlbCA9IGFzeW5jIChub3ZlbFVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwpKTsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gYXdhaXQgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXJzKG5vdmVsVXJsKTsNCiAgICAgICAgdmFyIGl0ZW0gPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIGl0ZW0uZ2VucmVzID0gY29udGFpbmVyLmZpbmQoIi5nZW5yZXMtY29udGVudCBhIikudGV4dEFycmF5KCk7DQogICAgICAgIGl0ZW0uYXV0aG9yID0gY29udGFpbmVyLmZpbmQoIi5hdXRob3ItY29udGVudCBhIikudGV4dChmYWxzZSkNCiAgICAgICAgaXRlbS5jb21wbGV0ZWQgPSAiU3RhdHVzOiIgKyBjb250YWluZXIuZmluZCgiLnBvc3Qtc3RhdHVzIC5wb3N0LWNvbnRlbnRfaXRlbSIpLmxhc3QoKS5zZWxlY3QoIi5zdW1tYXJ5LWNvbnRlbnQiKS50ZXh0KGZhbHNlKQ0KICAgICAgICBpdGVtLnV2b3RlcyA9ICJSYXRpbmc6IiArIGNvbnRhaW5lci5zZWxlY3QoIi50b3RhbF92b3RlcyIpLnRleHQoZmFsc2UpICsgIi81IjsNCiAgICAgICAgcmV0dXJuIG5ldyBEZXRhbGlJdGVtKGNvbnRhaW5lci5zZWxlY3QoJy5zdW1tYXJ5X2ltYWdlIGltZycpLmF0dHIoInNyYyIpLnVybCgpLCBjb250YWluZXIuc2VsZWN0KCcucG9zdC10aXRsZSBoMScpLnRleHQoZmFsc2UpLCBjb250YWluZXIuc2VsZWN0KCcuc3VtbWFyeV9fY29udGVudCcpLmNsZWFuSW5uZXJIVE1MKCksIG5vdmVsVXJsLCBjaGFwdGVycywgaXRlbSwgcmV0dXJuT2JqZWN0Lm5hbWUsIHVuZGVmaW5lZCk7DQogICAgfQ0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICByZXR1cm4gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBuZXcgY2xpZW50KCkuZ2V0SHRtbCh1cmwpKS5zZWxlY3QoJy5yZWFkaW5nLWNvbnRlbnQnKS5jbGVhbklubmVySFRNTCgpOw0KICAgIH0NCiAgICByZXR1cm5PYmplY3QubGF0ZXN0ID0gYXN5bmMgKHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHVybCA9IHJldHVybk9iamVjdC5sYXRlc3RVcmwucmVwbGFjZSgne3B9JywgcGFnZS50b1N0cmluZygpKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcucGFnZS1saXN0aW5nLWl0ZW0gLnJvdycpLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoJ2ltZycpLmF0dHIoInNyYyIpLnVybCgpLCB4LnNlbGVjdCgnLnBvc3QtdGl0bGUgYScpLnRleHQoKSwgJycsIHguc2VsZWN0KCcucG9zdC10aXRsZSBhJykuYXR0cigiaHJlZiIpLnVybCgpLCByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCn07&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50KSA9PiB7DQogICAgdmFyIHJldHVybk9iamVjdCA9IHt9Ow0KICAgIHJldHVybk9iamVjdC5pZCA9ICIxLmNvbXJhZGVtYW8iOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIHJldHVybk9iamVjdC5uYW1lID0gJ0NvbXJhZGVtYW8nOw0KICAgIHJldHVybk9iamVjdC5sYXRlc3RVcmwgPSAnaHR0cHM6Ly9jb21yYWRlbWFvLmNvbS9wYWdlL3twfS8nOw0KICAgIHJldHVybk9iamVjdC51cmwgPSAnaHR0cHM6Ly9jb21yYWRlbWFvLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL2NvbXJhZGVtYW8uY29tL3BhZ2Uve3B9Lz9zPXtxfSZwb3N0X3R5cGU9bm92ZWwnOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9zMi9mYXZpY29ucz9kb21haW49aHR0cHM6Ly9jb21yYWRlbWFvLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzID0gbmV3IFBhcnNlclNlYXJjaFNldHRpbmdzKCk7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MuZ2VucmVzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0FjdGlvbicpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NvbWVkeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0ZhbnRhc3knKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdIYXJlbScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01hdHVyZScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ015c3RlcnknKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdSb21hbmNlJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2NpLWZpJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVHJhZ2VkeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1hpYW54aWEnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdXdXhpYScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1h1YW5odWFuJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWR2ZW50dXJlJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU3VwZXJuYXR1cmFsJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRHJhbWEnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNYXJ0aWFsIEFydHMnLCAiTWFydGlhbC1BcnRzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2VpbmVuJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUHN5Y2hvbG9naWNhbCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1NsaWNlIG9mIExpZmUnLCAic2xpY2Utb2YtbGlmZSIpLA0KICAgICAgICBdLA0KICAgIH07DQoNCg0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnNvcnRUeXBlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDaGluZXNlJywgJ2NoaW5lc2UnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdKYXBhbmVzZScsICdqYXBhbmVzZScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0tvcmVhbicsICdrb3JlYW4nKSwNCiAgICAgICAgXSwNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnN0YXR1c2VzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkNvbXBsZXRlIiwgImNvbXBsZXRlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiT25Hb2luZyIsICJvbi1nb2luZyIpDQogICAgICAgIF0NCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0U2VjdGlvbnMgPSAoa2V5cykgPT4gew0KICAgICAgICB2YXIgc2VjdGlvbnMgPSBbDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibGF0ZXN0IiwgIkxhdGVzdCBVcGRhdGUiLCAiTGF0ZXN0IiwgdHJ1ZSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiY29tcGxldGVkIiwgIkNvbXBsZXRlZCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCAiY29tcGxldGUiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiY2hpbmVzZSIsICJDaGluZXNlIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgImNoaW5lc2UiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiamFwYW5lc2UiLCAiSmFwYW5lc2UiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAiamFwYW5lc2UiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigia29yZWFuIiwgIktvcmVhbiIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJrb3JlYW4iKSkNCiAgICAgICAgXQ0KDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC50cmFuc2xhdGVTZWN0aW9uID0gYXN5bmMgKHNlY3Rpb24sIHBhZ2UpID0+IHsNCiAgICAgICAgaWYgKHNlY3Rpb24uaWRlbnRpZmllciA9PSAiTGF0ZXN0IikNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QubGF0ZXN0KHBhZ2UpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LnNlYXJjaChzZWN0aW9uLmZpbHRlciB8fCByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlcigpLCBwYWdlKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlciA9ICgpID0+IHsNCiAgICAgICAgdmFyIGZpbHRlciA9IG5ldyBGaWx0ZXIoKTsNCiAgICAgICAgcmV0dXJuIGZpbHRlcjsNCiAgICB9DQoNCg0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciBzb3J0VHlwZVVyaSA9ICJodHRwczovL2NvbXJhZGVtYW8uY29tL210eXBlL3tzfS9wYWdlL3twfS8iDQogICAgICAgIHZhciBzb3J0VHlwZVVybCA9IHNvcnRUeXBlVXJpLnJlcGxhY2UoIntzfSIsIGZpbHRlci5zb3J0VHlwZSkucmVwbGFjZSgie3B9IiwgcGFnZS50b1N0cmluZygpKTsNCg0KICAgICAgICB2YXIgdXJsID0gZmlsdGVyLnNvcnRUeXBlICYmIGZpbHRlci5zb3J0VHlwZSAhPSAiIiA/IHNvcnRUeXBlVXJsIDogcmV0dXJuT2JqZWN0LnNlYXJjaFVybC5yZXBsYWNlKCd7cX0nLCBmaWx0ZXIudGl0bGUgfHwgIiIpLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIGlmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCAmJiBmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDApDQogICAgICAgICAgICB1cmwgPSAoImdlbnJlLyIgKyBmaWx0ZXIuZ2VucmVzWzBdICsgIi9wYWdlL3twfSIpLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSkudXJpKHJldHVybk9iamVjdC51cmwpOw0KICAgICAgICBlbHNlDQogICAgICAgIGlmIChmaWx0ZXIuYWN0aXZlICYmICghZmlsdGVyLnNvcnRUeXBlIHx8IGZpbHRlci5zb3J0VHlwZSA9PSAiIikpDQogICAgICAgICAgICB1cmwgPSAoInN0YXR1cy8iICsgZmlsdGVyLmFjdGl2ZSArICIvcGFnZS97cH0iKS5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpLnVyaShyZXR1cm5PYmplY3QudXJsKTsNCg0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwodXJsKSk7DQogICAgICAgIHZhciBteWJveCA9IGNvbnRhaW5lci5zZWxlY3QoIi5teWJveCIpLmhhc0VsZW1lbnQoKTsNCiAgICAgICAgdmFyIGl0ZW0gPSAhbXlib3ggPyBjb250YWluZXIuZmluZCgic2VjdGlvbiAuY29sdW1ucyIpIDogY29udGFpbmVyLmZpbmQoIi5teWJveCBsaSIpOw0KDQogICAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgICAgaXRlbS5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgdmFyIGEgPSBteWJveCA/IHguc2VsZWN0KCJoMyBhIikgOiB4LmZpbmQoImEiKS5sYXN0KCk7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJpbWciKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICBhLnRleHQoZmFsc2UpLCAiIiwNCiAgICAgICAgICAgICAgICBhLmF0dHIoImhyZWYiKS51cmwoKSwgcmV0dXJuT2JqZWN0Lm5hbWUpKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlcnMgPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHZhciByZXN1bHQgPSB7fTsNCiAgICAgICAgdmFyIHBhZ2UgPSAxOw0KDQogICAgICAgIHdoaWxlICh0cnVlKSB7DQoNCiAgICAgICAgICAgIHZhciBwVXJsID0gKCIvcGFnZS97cGFnZX0vIikudXJpKHVybCk7DQogICAgICAgICAgICB2YXIgaXRlbSA9IHJldHVybk9iamVjdC5wYXJzZXIucmVuZGVyQ291bnRlckNhbGxzKHBhZ2UsIHBVcmwpOw0KICAgICAgICAgICAgcGFnZSA9IGl0ZW0ucGFnZTsNCiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChpdGVtLnByb21pc2VzKTsNCiAgICAgICAgICAgIHZhciBicmVha0l0ID0gZmFsc2U7DQoNCiAgICAgICAgICAgIHZhbHVlcy5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgICAgIGlmICghYnJlYWtJdCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKHgpLmZpbmQoInRib2R5IHRyIHRoIGEiKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpdGVtcy5oYXNFbGVtZW50cygpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVha0l0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHRBID0gaXRlbXMucmVkdWNlKChhcnIsIHgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFyclt4LnRleHQoKSArIHguYXR0cigiaHJlZiIpLnVybCgpXSA9IG5ldyBDaGFwdGVyKHgudGV4dChmYWxzZSksIHguYXR0cigiaHJlZiIpLnVybCgpKTsNCiAgICAgICAgICAgICAgICAgICAgfSwge30pOw0KDQogICAgICAgICAgICAgICAgICAgIGlmIChyZXR1cm5PYmplY3QucGFyc2VyLnZhbGlkYXRlQ2hhcHRlcnMocmVzdWx0QSwgcmVzdWx0KSA9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtJdCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICBpZiAoYnJlYWtJdCkNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICB9DQogICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHJlc3VsdCk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldE5vdmVsID0gYXN5bmMgKG5vdmVsVXJsLCBiYXNpY0luZm8pID0+IHsNCg0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwsIGJhc2ljSW5mbykpOw0KICAgICAgICB2YXIgY2hhcHRlcnMgPSBiYXNpY0luZm8gPT09IHRydWUgPyBbXSA6IGF3YWl0IHJldHVybk9iamVjdC5nZXRDaGFwdGVycyhub3ZlbFVybCk7DQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIGlmICghYmFzaWNJbmZvKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHZhciBub2RlID0gY29udGFpbmVyLmZpbmQoIiNOb3ZlbEluZm8gPiBwIik7DQoNCiAgICAgICAgICAgICAgICBub3ZlbFJldmlld3MuZ2VucmVzID0gbm9kZS5lcSgxKS5maW5kKCJhIikubWFwKHggPT4geC50ZXh0KCkpOw0KICAgICAgICAgICAgICAgIG5vdmVsUmV2aWV3cy5hdXRob3IgPSBub2RlLmVxKDIpLnNlbGVjdCgiYSIpLnRleHQoKTsNCiAgICAgICAgICAgICAgICBub3ZlbFJldmlld3MuY29tcGxldGVkID0gbm9kZS5sYXN0KCkuc2VsZWN0KCJhIikudGV4dCgpID09PSAiQ29tcGxldGUiID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIjsNCiAgICAgICAgICAgICAgICBub3ZlbFJldmlld3MuYXV0aG9yVXJsID0gbm9kZS5lcSgyKS5zZWxlY3QoImEiKS5hdHRyKCJocmVmIikudGV4dCgpOw0KDQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcjTm92ZWxJbmZvIGltZycpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgndGl0bGUnKS50ZXh0KCkucmVwbGFjZSgiQ29tcmFkZSBNYW8iLCAiIikucmVwbGFjZSgiLSIsICIiKS50cmltKCksDQogICAgICAgICAgICBjb250YWluZXIuZmluZCgnI05vdmVsSW5mbyAuY29sdW1ucyAuY29sdW1uJykubGFzdCgpLmNsZWFuSW5uZXJIVE1MKCksDQogICAgICAgICAgICBub3ZlbFVybCwNCiAgICAgICAgICAgIGNoYXB0ZXJzLnJldmVyc2UoKSwNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICAgICAgdW5kZWZpbmVkLA0KICAgICAgICApDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IG5ldyBjbGllbnQoKS5nZXRIdG1sKHVybCkpLnNlbGVjdCgiI2NvbnRlbnQiKS5jbGVhbklubmVySFRNTCgpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5sYXRlc3QgPSBhc3luYyAocGFnZSkgPT4gew0KICAgICAgICB2YXIgdXJsID0gcmV0dXJuT2JqZWN0LmxhdGVzdFVybC5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwodXJsKSk7DQogICAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgICAgY29udGFpbmVyLmZpbmQoInRib2R5ID4gdHIgPiB0aDpmaXJzdC1jaGlsZCA+IGEiKS5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbShhc3luYyAoKSA9PiAoYXdhaXQgcmV0dXJuT2JqZWN0LmdldE5vdmVsKHguYXR0cigiaHJlZiIpLnVybCgpLCB0cnVlKSkuaW1hZ2UsDQogICAgICAgICAgICAgICAgeC50ZXh0KGZhbHNlKSwgIiIsIHguYXR0cigiaHJlZiIpLnVybCgpLCByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm4gcmV0dXJuT2JqZWN0Ow0KfTs=&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50KSA9PiB7DQogICAgY29uc3QgcmV0dXJuT2JqZWN0PSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5rb2xub3ZlbCI7DQogICAgcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImFyIjsNCiAgICByZXR1cm5PYmplY3QubmFtZSA9ICdLb2xOb3ZlbCc7DQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdFVybCA9ICdodHRwOi8va29sbm92ZWwuY29tL3Nlcmllcz9wYWdlPXtwfSZzdGF0dXM9JnR5cGU9Jm9yZGVyPXVwZGF0ZSc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICJodHRwczovL2tvbG5vdmVsLmNvbSI7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICJodHRwczovL2tvbG5vdmVsLmNvbS9zZXJpZXM/cGFnZT17cH0mb3JkZXI9IjsNCiAgICByZXR1cm5PYmplY3QucGFuaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFBhZ2luYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5pY29uID0gJ2h0dHBzOi8va29sbm92ZWwuY29tL3dwLWNvbnRlbnQvdXBsb2Fkcy8yMDE5LzA2L2Nyb3BwZWQt2KPZitmC2YjZhi0xLTEtMTUweDE1MC5wbmcnOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJXdXhpYSIsICd3dXhpYScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlhpYW54aWEiLCAieGlhbnhpYSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlhVQU5IVUFOIiwgInh1YW5odWFuIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2KPYtdmE2YrYqSIsICJvcmlnaW5hbCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItij2YPYtNmGIiwgImFjdGlvbiIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItil2KvYp9ix2KkiLCAiZXhjaXRlbWVudCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItil2YbYqtmC2KfZhCDYp9mE2Ykg2LnYp9mE2YUg2KPYrtixIiwgImlzZWthaSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItil2YrYqti02YoiLCAiZXRjaGkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLYp9mE2K7Zitin2YQg2KfZhNi52YTZhdmKIiwgInNjaS1maSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItio2YjZhNmK2LPZiiIsICJwb2xpY3kiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLYqtin2LHZitiu2YoiLCAiaGlzdG9yaWNhbCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItiq2YLZhdi1INi02K7YtdmK2KfYqiIsICJycGciKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLYrNix2YrZhdipIiwgImNyaW1lIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2KzZiNiz2YkiLCAiam9zZWkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLYrdix2YrZhSIsICJoYXJlbSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItit2YrYp9ipINmF2K/Ysdiz2YrYqSIsICJzY2hvb2wtbGlmZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItiu2KfYsdmC2Kkg2YTZhNi32KjZiti52KkiLCAic3VwZXJuYXR1cmFsIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2K7Zitin2YTZiiIsICJmYW50YXN5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2K/Ysdin2YXYpyIsICJkcmFtYSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItix2LnYqCIsICJob3Jyb3IiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLYsdmI2YXYp9mG2LPZiiIsICJyb21hbnRpYyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItiz2K3YsSIsICJtYWdpYyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItiz2YrZhtmGIiwgInNlbmVuIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2LTYsdmK2K3YqSDZhdmGINin2YTYrdmK2KfYqSIsICJzbGljZS1vZi1saWZlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2LTZiNmG2YrZhiIsICJzaG9uZW4iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLYtdmK2YbZiiIsICJjaGluZXNlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2LrZhdmI2LYiLCAibXlzdGVyaWVzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2YHZhtmI2YYg2KfZhNmC2KrYp9mEIiwgIm1hcnRpYWwtYXJ0cyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItmC2YjZiSDYrtin2LHZgtipIiwgInN1cGVycG93ZXIiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLZg9mI2LHZiiIsICJrb3JlYW4iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLZg9mI2YXZitiv2YkiLCAiY29tZWR5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2YXYo9iz2KfZiNmKIiwgInRyYWdlZHkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLZhdinINio2LnYryDYp9mE2YPYp9ix2KvYqSIsICJhZnRlci10aGUtZGlzYXN0ZXIiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLZhdi62KfZhdix2KkiLCAiYWR2ZW50dXJlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2YXZitmD2KciLCAibWVjaGFuaWNhbCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItmG2KfYttisIiwgIm1hdHVyZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItmG2YHYs9mKIiwgInBzeWNob2xvZ2ljYWwiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLZitin2KjYp9mG2YoiLCAiamFwYW5lc2UiKSwNCg0KDQogICAgICAgIF0sDQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zdGF0dXNlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IHRydWUsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ09uR29pbmcnLCAnb25nb2luZycpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hpYXR1cycsICdoaWF0dXMnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDb21wbGV0ZWQnLCAnY29tcGxldGVkJyksDQogICAgICAgIF0sDQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJjb21wbGV0ZWQiLCAiQ29tcGxldGVkIE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsICJjb21wbGV0ZWQiKSkNCiAgICAgICAgXQ0KDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC50cmFuc2xhdGVTZWN0aW9uID0gYXN5bmMgKHNlY3Rpb24sIHBhZ2UpID0+IHsNCiAgICAgICAgaWYgKHNlY3Rpb24uaWRlbnRpZmllciA9PSAiTGF0ZXN0IikNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QubGF0ZXN0KHBhZ2UpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LnNlYXJjaChzZWN0aW9uLmZpbHRlciB8fCByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlcigpLCBwYWdlKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlciA9ICgpID0+IHsNCiAgICAgICAgdmFyIGZpbHRlciA9IG5ldyBGaWx0ZXIoKTsNCiAgICAgICAgcmV0dXJuIGZpbHRlcjsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSkgPT4gew0KICAgICAgICB2YXIgdXJsID0gcmV0dXJuT2JqZWN0LnNlYXJjaFVybC5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICBpZiAoZmlsdGVyLnRpdGxlICYmICFmaWx0ZXIudGl0bGUuaXNFbXB0eU9yU3BhY2VzKCkpDQogICAgICAgICAgICB1cmwgKz0gIiZzPSIgKyBmaWx0ZXIudGl0bGU7DQogICAgICAgIGlmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDApDQogICAgICAgICAgICB1cmwgKz0gIiYiICsgZmlsdGVyLmdlbnJlcy5tYXAoeCA9PiAiZ2VucmVbXT0iICsgeCkuam9pbigiJiIpOw0KICAgICAgICBpZiAoZmlsdGVyLmFjdGl2ZSAmJiBmaWx0ZXIuYWN0aXZlLmxlbmd0aCA+IDApDQogICAgICAgICAgICB1cmwgKz0gIiZzdGF0dXM9IiArIGZpbHRlci5hY3RpdmU7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgnLmxpc3R1cGQgYScpLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgIGlmICh4LnNlbGVjdCgnaW1nJykuYXR0cigic3JjIikuaGFzVmFsdWUoKSkNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgNCiAgICAgICAgICAgICAgICAgICAgbmV3IExpZ2h0SXRlbSh4LnNlbGVjdCgnaW1nJykuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLm50aXRsZScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICAgICAgICAgICAgJycsDQogICAgICAgICAgICAgICAgICAgICAgICB4LmF0dHIoImhyZWYiKS51cmwoKSwgcmV0dXJuT2JqZWN0Lm5hbWUNCiAgICAgICAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXROb3ZlbCA9IGFzeW5jIChub3ZlbFVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwpKTsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gY29udGFpbmVyLmZpbmQoIi5lcGxpc3RlciBsaSBhIikubWFwKHggPT4gbmV3IENoYXB0ZXIoeC5zZWxlY3QoIi5lcGwtbnVtIikudGV4dChmYWxzZSkgKyAiICIgKyB4LnNlbGVjdCgiLmVwbC10aXRsZSIpLnRleHQoZmFsc2UpLCB4LmF0dHIoImhyZWYiKS51cmwoKSkpDQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIHZhciBpbmZvcyA9IGNvbnRhaW5lci5maW5kKCIubmluZm8iKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGNvbnRhaW5lci5maW5kKCIuZ2VueGVkIGEiKS5tYXAoeCA9PiB4LnRleHQoZmFsc2UpKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmF1dGhvciA9IGluZm9zLmVxKDApLmZpbmQoIi5pbmZvLWNvbnRlbnQgLnNwZSBzcGFuIikuZXEoMikuZmluZCgiYSIpLnRleHRBcnJheSgpLmpvaW4oIiwiKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLnV2b3RlcyA9IGNvbnRhaW5lci5zZWxlY3QoIi5yYXRpbmcgc3Ryb25nIikudGV4dCgpLm51bWJlcigpICsgIiAvIDEwIjsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmNvbXBsZXRlZCA9IGNvbnRhaW5lci5maW5kKCIuaW5mby1jb250ZW50IC5zcGUgc3BhbiIpLmVxKDApLnJlbW92ZSgiYiIpLnRleHQoZmFsc2UpID09PSAiQ29tcGxldGVkIiA/ICJTdGF0dXM6Q29tcGxldGVkIiA6ICJTdGF0dXM6T25nb2luZyI7DQoNCiAgICAgICAgcmV0dXJuIG5ldyBEZXRhbGlJdGVtKA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLnRodW1iIGltZycpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmVudHJ5LXRpdGxlJykudGV4dChmYWxzZSksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcuZW50cnktY29udGVudCcpLmNsZWFuSW5uZXJIVE1MKCksDQogICAgICAgICAgICBub3ZlbFVybCwNCiAgICAgICAgICAgIGNoYXB0ZXJzLnJldmVyc2UoKSwNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICAgICAgdW5kZWZpbmVkLA0KICAgICAgICApOw0KICAgIH0NCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IG5ldyBjbGllbnQoKS5nZXRIdG1sKHVybCkpLnNlbGVjdCgnLmVudHJ5LWNvbnRlbnQnKS5jbGVhbklubmVySFRNTCgpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5sYXRlc3QgPSBhc3luYyAocGFnZSkgPT4gew0KICAgICAgICB2YXIgdXJsID0gcmV0dXJuT2JqZWN0LmxhdGVzdFVybC5yZXBsYWNlKCd7cH0nLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICB2YXIgaHRtbCA9YXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCk7DQogICAgICAgIGNvbnNvbGUubG9nKGh0bWwpDQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGh0bWwpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcubGlzdHVwZCBhJykuZm9yRWFjaCgoeCkgPT4gew0KICAgICAgICAgICAgaWYgKHguc2VsZWN0KCdpbWcnKS5hdHRyKCJzcmMiKS5oYXNWYWx1ZSgpKQ0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKA0KICAgICAgICAgICAgICAgICAgICBuZXcgTGlnaHRJdGVtKHguc2VsZWN0KCdpbWcnKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCcubnRpdGxlJykudGV4dChmYWxzZSksDQogICAgICAgICAgICAgICAgICAgICAgICAnJywNCiAgICAgICAgICAgICAgICAgICAgICAgIHguYXR0cigiaHJlZiIpLnVybCgpLCByZXR1cm5PYmplY3QubmFtZQ0KICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCn07&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50KSA9PiB7DQogICAgY29uc3QgcmV0dXJuT2JqZWN0ID0ge307DQogICAgcmV0dXJuT2JqZWN0LmlkID0gIjEubGlnaHRub3ZlbHB1YiI7DQogICAgcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCiAgICByZXR1cm5PYmplY3QubmFtZSA9ICdMaWdodE5vdmVsUHViJzsNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vd3d3LmxpZ2h0bm92ZWxwdWIuY29tL2Jyb3dzZS9hbGwvdXBkYXRlZC9hbGwve3B9JzsNCiAgICByZXR1cm5PYmplY3QudXJsID0gJ2h0dHBzOi8vd3d3LmxpZ2h0bm92ZWxwdWIuY29tJzsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoVXJsID0gJ2h0dHBzOi8vd3d3LmxpZ2h0bm92ZWxwdWIuY29tL2xud3NlYXJjaGxpdmU/aW5wdXRDb250ZW50PXtxfSc7DQogICAgcmV0dXJuT2JqZWN0LnBhbmluYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hQYWdpbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3QuaWNvbiA9ICdodHRwczovL3N0YXRpYy5saWdodG5vdmVscHViLmNvbS9jb250ZW50L2ltZy9saWdodG5vdmVscHViL2FwcGxlLXRvdWNoLWljb24ucG5nJzsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MgPSBuZXcgUGFyc2VyU2VhcmNoU2V0dGluZ3MoKTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MubXVsdGlTZWxlY3Rpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJBY3Rpb24iLCAxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJBZHVsdCIsIDQ4KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJBZHZlbnR1cmUiLCAyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJDb21lZHkiLCAxMiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQ29udGVtcG9yYXJ5IFJvbWFuY2UiLCA1OSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRHJhbWEiLCAzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJFYXN0ZXJuIEZhbnRhc3kiLCA1OCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRWNjaGkiLCAxMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRmFudGFzeSIsIDQpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkZhbnRhc3kgUm9tYW5jZSIsIDYwKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJHZW5kZXIgQmVuZGVyIiwgNTIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhhcmVtIiwgNSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGlzdG9yaWNhbCIsIDQ2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIb3Jyb3IiLCA0NCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSm9zZWkiLCAyMyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTG9saWNvbiIsIDUxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNYWdpY2FsIFJlYWxpc20iLCA1NyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWFydGlhbCBBcnRzIiwgNiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWF0dXJlIiwgNyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWVjaGEiLCA0NSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTXlzdGVyeSIsIDE0KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJQc3ljaG9sb2dpY2FsIiwgMTgpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlJvbWFuY2UiLCA4KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTY2hvb2wgTGlmZSIsIDIxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTY2ktZmkiLCAxOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2VpbmVuIiwgNDkpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNob3VqbyIsIDQ3KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTaG91am8gQWkiLCA2MSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2hvdW5lbiIsIDQzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTaG91bmVuIEFpIiwgNTMpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNsaWNlIG9mIExpZmUiLCAxMyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU211dCIsIDU2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTcG9ydHMiLCA1MCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU3VwZXJuYXR1cmFsIiwgMTYpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlRyYWdlZHkiLCA5KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJWaWRlbyBHYW1lcyIsIDU1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJXdXhpYSIsIDQyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJYaWFueGlhIiwgMjApLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlh1YW5odWFuIiwgMTApLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIllhb2kiLCA1NCkNCiAgICAgICAgXQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zdGF0dXNlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IHRydWUsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkNvbXBsZXRlZCIsIDEpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk9uZ29pbmciLCAyKSwNCiAgICAgICAgXQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5sYW5ndWFnZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJDaGluZXNlIE5vdmVsIiwgNCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiS29yZWFuIE5vdmVsIiwgNSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTGlnaHQgTm92ZWwiLCA2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJMaWdodCBOb3ZlbCAoSlApIiwgOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTGlnaHQgTm92ZWwgKEtSKSIsIDEwKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJQdWJsaXNoZWQgTm92ZWwgKENOKSIsIDExKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJQdWJsaXNoZWQgTm92ZWwgKEtSKSIsIDgpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIldlYiBOb3ZlbCIsIDcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIldlYiBOb3ZlbCAoQ04pIiwgMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiV2ViIE5vdmVsIChKUCkiLCAzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJXZWIgTm92ZWwgKEtSKSIsIDIpDQogICAgICAgIF0NCiAgICB9DQoNCg0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJyb21hbmNlIiwgIlJvbWFuY2UiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIoWzhdKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiYWN0aW9uIiwgIkFjdGlvbiIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcihbMV0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJteXN0ZXJ5IiwgIk15c3RlcnkiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIoWzE0XSkpLA0KICAgICAgICBdDQoNCiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgIHJldHVybiBuZXcgRmlsdGVyKCk7DQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5nZXRHZW5yZXMgPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSAiaHR0cHM6Ly93d3cubGlnaHRub3ZlbHB1Yi5jb20vc2VhcmNoYWR2P2N0Z2Nvbj1hbmQmdGFnY29uPWFuZCZyYXRjb249bWluJnJhdGluZz0wJnNvcnQ9c2RhdGUmcGFnZU5vPSIgKyBwYWdlOw0KICAgICAgICBpZiAoZmlsdGVyLmFjdGl2ZSkNCiAgICAgICAgICAgIHVybCA9IHVybCArICImc3RhdHVzPSIgKyBmaWx0ZXIuYWN0aXZlOw0KICAgICAgICBpZiAoZmlsdGVyLmxhbmd1YWdlICYmIGZpbHRlci5sYW5ndWFnZSAhPSAiIikNCiAgICAgICAgICAgIHVybCA9IHVybCArICImZ2VucmV0eXBlcz0iICsgZmlsdGVyLmxhbmd1YWdlOw0KDQogICAgICAgIGlmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDApDQogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJmNhdGVnb3JpZXM9IiArIGZpbHRlci5nZW5yZXMuam9pbigiJTJDIik7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLm5vdmVsLWl0ZW0iKS5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbSh4LnNlbGVjdCgiaW1nIikuYXR0cigiZGF0YS1zcmMgfCBzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLm5vdmVsLXRpdGxlIGEiKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLm5vdmVsLXRpdGxlIGEiKS5hdHRyKCJocmVmIikudXJsKCksDQogICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUpKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoIWZpbHRlci50aXRsZSkNCiAgICAgICAgICAgIGZpbHRlci50aXRsZSA9ICIiOw0KICAgICAgICB2YXIgdXJsID0gcmV0dXJuT2JqZWN0LnNlYXJjaFVybC5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpLnJlcGxhY2UoIntxfSIsIGZpbHRlci50aXRsZSk7DQogICAgICAgIGlmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDAgfHwgZmlsdGVyLmxhbmd1YWdlICE9ICIiIHx8IGZpbHRlci5hY3RpdmUpDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmdldEdlbnJlcyhmaWx0ZXIsIHBhZ2UpOw0KICAgICAgICB2YXIgY29udGFpbmVyID0gYXdhaXQgSHR0cENsaWVudC5HZXRKc29uKHVybCk7DQogICAgICAgIHZhciBodG1sID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShjb250YWluZXIucmVzdWx0dmlldy50b0h0bWwoKSk7DQogICAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgICAgaHRtbC5maW5kKCIubm92ZWwtaXRlbSIpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKHguc2VsZWN0KCJpbWciKS5hdHRyKCJkYXRhLXNyYyB8IHNyYyIpLnVybCgpLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCIubm92ZWwtdGl0bGUiKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiYSIpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVycyA9IGFzeW5jIChub3ZlbFVybCkgPT4gew0KICAgICAgICB2YXIgcGFnZSA9IDE7DQogICAgICAgIHZhciByZXN1bHQgPSB7fTsNCiAgICAgICAgd2hpbGUgKHRydWUpIHsNCiAgICAgICAgICAgIHZhciB1cmwgPSBub3ZlbFVybCArICIvcGFnZS17cGFnZX0iOw0KICAgICAgICAgICAgdmFyIGl0ZW0gPSByZXR1cm5PYmplY3QucGFyc2VyLnJlbmRlckNvdW50ZXJDYWxscyhwYWdlLCB1cmwpOw0KICAgICAgICAgICAgcGFnZSA9IGl0ZW0ucGFnZTsNCiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChpdGVtLnByb21pc2VzKTsNCiAgICAgICAgICAgIHZhciBicmVha0l0ID0gZmFsc2U7DQoNCiAgICAgICAgICAgIHZhbHVlcy5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgICAgIGlmICghYnJlYWtJdCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKHgpLmZpbmQoIi5jaGFwdGVyLWxpc3QgYSIpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIWl0ZW1zLmhhc0VsZW1lbnRzKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrSXQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdEEgPSBpdGVtcy5yZWR1Y2UoKGFyciwgeCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgYXJyW3guYXR0cigidGl0bGUiKS50ZXh0KCkgKyB4LmF0dHIoImhyZWYiKS51cmwoKV0gPSBuZXcgQ2hhcHRlcih4LmF0dHIoInRpdGxlIikudGV4dCgpLCB4LmF0dHIoImhyZWYiKS51cmwoKSk7DQogICAgICAgICAgICAgICAgICAgIH0sIHt9KTsNCg0KICAgICAgICAgICAgICAgICAgICBpZiAocmV0dXJuT2JqZWN0LnBhcnNlci52YWxpZGF0ZUNoYXB0ZXJzKHJlc3VsdEEsIHJlc3VsdCkgPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrSXQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB9KQ0KDQogICAgICAgICAgICBpZiAoYnJlYWtJdCkNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHJlc3VsdCk7DQoNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Tm92ZWwgPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsKSk7DQogICAgICAgIHZhciBjaGFwdGVyVXJsID0gY29udGFpbmVyLnNlbGVjdCgiLmNoYXB0ZXItbGF0ZXN0LWNvbnRhaW5lciIpLmF0dHIoImhyZWYiKS51cmwoKTsNCiAgICAgICAgaWYgKCFjaGFwdGVyVXJsIHx8IGNoYXB0ZXJVcmwgPT0gIiIpDQogICAgICAgICAgICBjaGFwdGVyVXJsID0gbm92ZWxVcmw7DQogICAgICAgIHZhciBjaGFwdGVycyA9IGF3YWl0IHJldHVybk9iamVjdC5nZXRDaGFwdGVycyhjaGFwdGVyVXJsKTsNCiAgICAgICAgdmFyIG5vdmVsUmV2aWV3cyA9IG5ldyBOb3ZlbFJldmlld3MoKTsNCiAgICAgICAgdmFyIGluZm8gPSBjb250YWluZXIuc2VsZWN0KCIubm92ZWwtaW5mbyIpOw0KICAgICAgICBub3ZlbFJldmlld3MuZ2VucmVzID0gaW5mby5maW5kKCIuY2F0ZWdvcmllcyBhIikudGV4dEFycmF5KCk7DQogICAgICAgIG5vdmVsUmV2aWV3cy5hdXRob3IgPSBpbmZvLnNlbGVjdCgiLmF1dGhvciBhIikudGV4dChmYWxzZSk7DQogICAgICAgIG5vdmVsUmV2aWV3cy51dm90ZXMgPSAiUmF0aW5nOiIgKyBjb250YWluZXIuc2VsZWN0KCIucmF0aW5nLXN0YXIgc3Ryb25nIikudGV4dChmYWxzZSkgKyAiLzUiOw0KICAgICAgICBub3ZlbFJldmlld3MuZGVzY3JpcHRpb24gPSBjb250YWluZXIuc2VsZWN0KCIjaW5mbyAuc3VtbWFyeSIpLmNsZWFuSW5uZXJIVE1MKCk7DQogICAgICAgIG5vdmVsUmV2aWV3cy5jb21wbGV0ZWQgPSBpbmZvLnRleHQoZmFsc2UpID09PSAiQ29tcGxldGVkIiA/ICJTdGF0dXM6Q29tcGxldGVkIiA6ICJTdGF0dXM6T25nb2luZyI7DQoNCiAgICAgICAgcmV0dXJuIG5ldyBEZXRhbGlJdGVtKA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgiLmNvdmVyIGltZyIpLmF0dHIoImRhdGEtc3JjIHwgc3JjIikudXJsKCksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCIubm92ZWwtdGl0bGUiKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cy5kZXNjcmlwdGlvbiwNCiAgICAgICAgICAgIG5vdmVsVXJsLA0KICAgICAgICAgICAgY2hhcHRlcnMsDQogICAgICAgICAgICBub3ZlbFJldmlld3MsDQogICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgIHVuZGVmaW5lZCwNCiAgICAgICAgKQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICByZXR1cm4gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBuZXcgY2xpZW50KCkuZ2V0SHRtbCh1cmwpKS5zZWxlY3QoIiNjaGFwdGVyLWNvbnRhaW5lciIpLmNsZWFuSW5uZXJIVE1MKCk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdCA9IGFzeW5jIChwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3QubGF0ZXN0VXJsLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLm5vdmVsLWl0ZW0iKS5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbSh4LnNlbGVjdCgiLm5vdmVsLWNvdmVyIGltZyIpLmF0dHIoImRhdGEtc3JjIHwgc3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoIi5ub3ZlbC10aXRsZSIpLnRleHQoKSwNCiAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLmNvdmVyLXdyYXAgYSIpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm4gcmV0dXJuT2JqZWN0Ow0KDQp9Ow==&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5tYW5nYW5lbG8iOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk1hbmFnYTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyTGFuZ3VhZ2UgPSAiZW4iOw0KICAgIHJldHVybk9iamVjdC5uYW1lID0gJ01hbmdhbkVsbyc7DQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdFVybCA9ICdodHRwczovL21hbmdhbmVsby5jb20vZ2VucmUtYWxsL3twfSc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL21hbmdhbmVsby5jb20vJzsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoVXJsID0gJ2h0dHBzOi8vbWFuZ2FuZWxvLmNvbS9hZHZhbmNlZF9zZWFyY2g/cz1hbGwmcGFnZT17cH0nOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly9tYW5nYW5lbG8uY29tL2Zhdmljb24ucG5nJzsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MgPSBuZXcgUGFyc2VyU2VhcmNoU2V0dGluZ3MoKTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MubXVsdGlTZWxlY3Rpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWN0aW9uJywgMiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWR1bHQnLCAzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBZHZlbnR1cmUnLCA0KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDb21lZHknLCA2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDb29raW5nJywgNyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRG91amluc2hpJywgOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRHJhbWEnLCAxMCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRWNjaGknLCAxMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRmFudGFzeScsIDEyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdHZW5kZXIgYmVuZGVyJywgMTMpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hhcmVtJywgMTQpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hpc3RvcmljYWwnLCAxNSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnSG9ycm9yJywgMTYpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0lzZWthaScsIDQ1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdKb3NlaScsIDE3KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNYW5odWEnLCA0NCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTWFuaHdhJywgNDMpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01hcnRpYWwgYXJ0cycsIDE5KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNYXR1cmUnLCAyMCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTWVjaGEnLCAyMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTWVkaWNhbCcsIDIyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNeXN0ZXJ5JywgMjQpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ09uZSBzaG90JywgMjUpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1BzeWNob2xvZ2ljYWwnLCAyNiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUm9tYW5jZScsIDI3KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTY2hvb2wgbGlmZScsIDI4KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTY2kgZmknLCAyOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2VpbmVuJywgMzApLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1Nob3VqbycsIDMxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTaG91am8gYWknLCAzMiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2hvdW5lbicsIDMzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTaG91bmVuIGFpJywgMzQpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1NsaWNlIG9mIGxpZmUnLCAzNSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU211dCcsIDM2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTcG9ydHMnLCAzNyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU3VwZXJuYXR1cmFsJywgMzgpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1RyYWdlZHknLCAzOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnV2VidG9vbnMnLCA0MCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWWFvaScsIDQxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdZdXJpJywgNDIpLA0KICAgICAgICBdLA0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3Muc29ydFR5cGVzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0xhdGVzdCBSZWxlYXNlJywgJycpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ05ld2VzdCcsICduZXdlc3QnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdUb3AgdmlldycsICd0b3B2aWV3JyksDQogICAgICAgIF0sDQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zdGF0dXNlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJDb21wbGV0ZWQiLCAiY29tcGxldGVkIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgib25nb2luZyIsICJvbmdvaW5nIikNCiAgICAgICAgXQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJob3QiLCAiTmV3ZXN0IiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgIm5ld2VzdCIpKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJjb21wbGV0ZWQiLCAiQ29tcGxldGVkIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsICJjb21wbGV0ZWQiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigicG9wdWxhciIsICJNb3N0IFBvcHVsYXIiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAidG9wdmlldyIpKQ0KICAgICAgICBdDQoNCiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICB2YXIgZmlsdGVyID0gbmV3IEZpbHRlcigpOw0KICAgICAgICByZXR1cm4gZmlsdGVyOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3Quc2VhcmNoVXJsLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIGlmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDApDQogICAgICAgICAgICB1cmwgPSAoIiZnX2k9XyIgKyBmaWx0ZXIuZ2VucmVzLmpvaW4oIl8iKSkudXJpKHVybCk7DQogICAgICAgIGlmIChmaWx0ZXIuc29ydFR5cGUgJiYgZmlsdGVyLnNvcnRUeXBlICE9ICIiKQ0KICAgICAgICAgICAgdXJsID0gKCImb3JieT0iICsgZmlsdGVyLnNvcnRUeXBlKS51cmkodXJsKTsNCiAgICAgICAgaWYgKGZpbHRlci5hY3RpdmUgJiYgZmlsdGVyLmFjdGl2ZSAhPSAiIikNCiAgICAgICAgICAgIHVybCA9ICgiJnN0cz0iICsgZmlsdGVyLmFjdGl2ZSkudXJpKHVybCk7DQogICAgICAgIGlmIChmaWx0ZXIudGl0bGUgJiYgZmlsdGVyLnRpdGxlLnRyaW0oKS5sZW5ndGggPiAwKQ0KICAgICAgICAgICAgdXJsID0gKCIma2V5dz0iICsgZmlsdGVyLnRpdGxlLnJlcGxhY2UoL1sgXS9nLCAiXyIpKS51cmkodXJsKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcuY29udGVudC1nZW5yZXMtaXRlbScpLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgIGlmICh4LnNlbGVjdCgnLmdlbnJlcy1pdGVtLWltZyBpbWcnKS5hdHRyKCJzcmMiKS5oYXNWYWx1ZSgpKQ0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKA0KICAgICAgICAgICAgICAgICAgICBuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgICAgICAgICAgeC5zZWxlY3QoJy5nZW5yZXMtaXRlbS1pbWcgaW1nJykuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLmdlbnJlcy1pdGVtLWltZycpLmF0dHIoInRpdGxlIikudGV4dCgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgJycsDQogICAgICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLmdlbnJlcy1pdGVtLWltZycpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lDQogICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldE5vdmVsID0gYXN5bmMgKG5vdmVsVXJsKSA9PiB7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbChub3ZlbFVybCkpOw0KDQogICAgICAgIHZhciBpdGVtID0gbmV3IE5vdmVsUmV2aWV3cygpOw0KICAgICAgICB2YXIgdGJJbmZvID0gY29udGFpbmVyLmZpbmQoIi52YXJpYXRpb25zLXRhYmxlSW5mbyB0ciIpDQogICAgICAgIGlmICh0YkluZm8ubGVuZ3RoKCkgPiAzKQ0KICAgICAgICAgICAgaXRlbS5nZW5yZXMgPSB0YkluZm8uZXEoMykuZmluZCgiLnRhYmxlLXZhbHVlIGEiKS5tYXAoeCA9PiB4LnRleHQoZmFsc2UpKTsNCiAgICAgICAgZWxzZSBpZiAodGJJbmZvLmxlbmd0aCgpID09IDMpDQogICAgICAgICAgICBpdGVtLmdlbnJlcyA9IHRiSW5mby5lcSgyKS5maW5kKCIudGFibGUtdmFsdWUgYSIpLm1hcCh4ID0+IHgudGV4dChmYWxzZSkpOw0KICAgICAgICBpdGVtLmRlc2NyaXB0aW9uID0gY29udGFpbmVyLnNlbGVjdCgiLnBhbmVsLXN0b3J5LWluZm8tZGVzY3JpcHRpb24iKS50ZXh0KGZhbHNlKQ0KDQogICAgICAgIGl0ZW0udXZvdGVzID0gY29udGFpbmVyLnNlbGVjdCgiZW1bdHlwZW9mPSd2OlJhdGluZyddIikudGV4dChmYWxzZSkucmVtb3ZlTmV3TGluZSgiICIpOw0KICAgICAgICBpdGVtLmFsdGVybmF0aXZlTmFtZXMgPSB0YkluZm8ubGVuZ3RoKCkgPiAzID8gdGJJbmZvLmVxKDApLnNlbGVjdCgiI2VkaXRhc3NvY2lhdGVkIikudGV4dChmYWxzZSkgOiAiIjsNCiAgICAgICAgaWYgKHRiSW5mby5sZW5ndGgoKSA+IDMpDQogICAgICAgICAgICBpdGVtLmF1dGhvciA9IHRiSW5mby5lcSgxKS5zZWxlY3QoIi50YWJsZS12YWx1ZSIpLnRleHQoZmFsc2UpOw0KICAgICAgICBlbHNlIGlmICh0YkluZm8ubGVuZ3RoKCkgPiAwKQ0KICAgICAgICAgICAgaXRlbS5hdXRob3IgPSB0YkluZm8uZXEoMCkuc2VsZWN0KCIudGFibGUtdmFsdWUiKS50ZXh0KGZhbHNlKTsNCiAgICAgICAgaXRlbS5sYW5nID0gIiI7DQogICAgICAgIGlmICh0YkluZm8ubGVuZ3RoKCkgPiAzKQ0KICAgICAgICAgICAgaXRlbS5jb21wbGV0ZWQgPSB0YkluZm8uZXEoMikudGV4dChmYWxzZSkucmVtb3ZlTmV3TGluZSgiICIpOw0KICAgICAgICBlbHNlIGlmICh0YkluZm8ubGVuZ3RoKCkgPT0gMykNCiAgICAgICAgICAgIGl0ZW0uY29tcGxldGVkID0gdGJJbmZvLmVxKDEpLnRleHQoZmFsc2UpLnJlbW92ZU5ld0xpbmUoIiAiKTsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gY29udGFpbmVyLmZpbmQoIi5yb3ctY29udGVudC1jaGFwdGVyIGEiKS5tYXAoeCA9PiBuZXcgQ2hhcHRlcih4LnRleHQoZmFsc2UpLCB4LmF0dHIoImhyZWYiKS51cmwoKSkpOw0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcuaW5mby1pbWFnZSBpbWcnKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy5zdG9yeS1pbmZvLXJpZ2h0IGgxJykudGV4dChmYWxzZSksDQogICAgICAgICAgICBpdGVtLmRlc2NyaXB0aW9uLA0KICAgICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgICBjaGFwdGVycy5yZXZlcnNlKCksDQogICAgICAgICAgICBpdGVtLA0KICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUsDQogICAgICAgICAgICB1bmRlZmluZWQsDQogICAgICAgICk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IG5ldyBjbGllbnQoKS5nZXRIdG1sKHVybCkpLmZpbmQoIi5jb250YWluZXItY2hhcHRlci1yZWFkZXIgaW1nIikubWFwKHggPT4geC5hdHRyKCJzcmMiKS51cmwoKSkuZmlsdGVyKHggPT4geCAmJiB4ICE9ICIiKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0ID0gYXN5bmMgKHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHVybCA9IHJldHVybk9iamVjdC5sYXRlc3RVcmwucmVwbGFjZSgne3B9JywgcGFnZS50b1N0cmluZygpKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcuY29udGVudC1nZW5yZXMtaXRlbScpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICBpZiAoeC5zZWxlY3QoJy5nZW5yZXMtaXRlbS1pbWcgaW1nJykuYXR0cigic3JjIikuaGFzVmFsdWUoKSkNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgNCiAgICAgICAgICAgICAgICAgICAgbmV3IExpZ2h0SXRlbSgNCiAgICAgICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCIuZ2VucmVzLWl0ZW0taW1nIGltZyIpLmF0dHIoInNyYyIpLnRleHQoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCIuZ2VucmVzLWl0ZW0taW1nIikuYXR0cigidGl0bGUiKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICcnLA0KICAgICAgICAgICAgICAgICAgICAgICAgeC5zZWxlY3QoJy5nZW5yZXMtaXRlbS1pbWcnKS5hdHRyKCJocmVmIikudXJsKCksDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZQ0KICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCn07&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50KSA9PiB7DQogICAgY29uc3QgcmV0dXJuT2JqZWN0ID0ge307DQogICAgcmV0dXJuT2JqZWN0LmlkID0gIjEubXRsbm92ZWwiOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJMYW5ndWFnZSA9ICJlbiI7DQogICAgcmV0dXJuT2JqZWN0Lm5hbWUgPSAnTXRsTm92ZWwnOw0KICAgIHJldHVybk9iamVjdC5sYXRlc3RVcmwgPSAnaHR0cHM6Ly93d3cubXRsbm92ZWwuY29tL3dwLWFkbWluL2FkbWluLWFqYXgucGhwP2FjdGlvbj1yY250X3VwZGF0ZSZ2aWV3X2FsbD15ZXMmbW9yZUl0ZW1zUGFnZUluZGV4PXtwfSZfX2FtcF9zb3VyY2Vfb3JpZ2luPWh0dHBzJTNBJTJGJTJGd3d3Lm10bG5vdmVsLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL3d3dy5tdGxub3ZlbC5jb20nOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hVcmwgPSAnaHR0cHM6Ly93d3cubXRsbm92ZWwuY29tL3dwLWFkbWluL2FkbWluLWFqYXgucGhwP2FjdGlvbj1hdXRvc3VnZ2VzdCZxPXtxfSZtb3JlSXRlbXNQYWdlSW5kZXg9e3B9Jl9fYW1wX3NvdXJjZV9vcmlnaW49aHR0cHMlM0ElMkYlMkZ3d3cubXRsbm92ZWwuY29tJzsNCiAgICByZXR1cm5PYmplY3QucGFuaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFBhZ2luYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5pY29uID0gJ2h0dHBzOi8vd3d3Lm10bG5vdmVsLm5ldC90aGVtZXMvbXRsbm92ZWwvaW1hZ2VzL210bG5vdmVsLTMyLmljbyc7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzID0gbmV3IFBhcnNlclNlYXJjaFNldHRpbmdzKCk7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLm11bHRpU2VsZWN0aW9uID0gZmFsc2U7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBY3Rpb24nKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBZHVsdCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NvbWVkeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0FkdmVudHVyZScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0RyYW1hJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRWNjaGknKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdFcmNpeXVhbicpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0Zhbi1GaWN0aW9uJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRmFudGFzeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0dhbWUnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdHZW5kZXIgQmVuZGVyJywgImdlbmRlci1iZW5kZXIiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdIYXJlbScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hpc3RvcmljYWwnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdIb3Jyb3InKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdKb3NlaScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01hcnRpYWwgQXJ0cycsICJtYXJ0aWFsLWFydHMiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNYXR1cmUnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNZWNoYScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01pbGl0YXJ5JyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTXlzdGVyeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1BzeWNob2xvZ2ljYWwnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdSb21hbmNlJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2Nob29sIExpZmUnLCAnc2Nob29sLWxpZmUnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTY2ktZmknKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTZWluZW4nKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTaG91am8nKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTaG91am8gQWknLCAic2hvdWpvLWFpIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2hvdW5lbicpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1Nob3VuZW4gQWknLCAic2hvdW5lbi1haSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1NsaWNlIG9mIExpZmUnLCAic2xpY2Utb2YtbGlmZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1NtdXQnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTcG9ydHMnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTdXBlcm5hdHVyYWwnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdUcmFnZWR5JyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVHdvLWRpbWVuc2lvbmFsJywgInR3by1kaW1lbnNpb25hbC1ub3ZlbCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1VyYmFuIExpZmUnLCAidXJiYW4tZmljdGlvbiIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1d1eGlhJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWGlhbnhpYScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1h1YW5odWFuJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWWFvaScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1l1cmknKSwNCg0KICAgICAgICBdLA0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3Muc3RhdHVzZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQ29tcGxldGVkJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRHJvcHBlZCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hpYXR1cycpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0luY29tcGxldGUnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdPbmdvaW5nJyksDQogICAgICAgIF0sDQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJjb21wbGV0ZWQiLCAiQ29tcGxldGVkIE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsICJjb21wbGV0ZWQiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigib25nb2luZyIsICJPbmdvaW5nIE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsICJvbmdvaW5nIikpLA0KICAgICAgICBdDQoNCiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICB2YXIgZmlsdGVyID0gbmV3IEZpbHRlcigpOw0KICAgICAgICByZXR1cm4gZmlsdGVyOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRCeUdlbnJlcyA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgdmFyIGdlbnJlVXJsID0gImdlbnJlL3tnfS9wYWdlL3twfS8iLnVyaShyZXR1cm5PYmplY3QudXJsKS5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgdmFyIHN0YXR1c1VybCA9ICJzdGF0dXMve3N9L3BhZ2Uve3B9LyIudXJpKHJldHVybk9iamVjdC51cmwpLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgICAgICB2YXIgcSA9DQogICAgICAgICAgICAgICAgZmlsdGVyLmdlbnJlcy5sZW5ndGggPiAwID8NCiAgICAgICAgICAgICAgICBnZW5yZVVybC5yZXBsYWNlKCJ7Z30iLCBmaWx0ZXIuZ2VucmVzWzBdLnRvTG93ZXJDYXNlKCkpIDoNCiAgICAgICAgICAgICAgICBmaWx0ZXIuYWN0aXZlICYmIGZpbHRlci5hY3RpdmUgIT0gJycgPw0KICAgICAgICAgICAgICAgIHN0YXR1c1VybC5yZXBsYWNlKCJ7c30iLCBmaWx0ZXIuYWN0aXZlLnRvTG93ZXJDYXNlKCkpIDoNCiAgICAgICAgICAgICAgICB1bmRlZmluZWQ7DQogICAgICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwocSB8fCAiIikpOw0KICAgICAgICAgICAgdmFyIGRhdGEgPSBjb250YWluZXIuZmluZCgnLmJveCcpOw0KICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICAgICAgZGF0YS5mb3JFYWNoKCh4KSA9PiB7DQogICAgICAgICAgICAgICAgdmFyIGhyZWYgPSB4LnNlbGVjdCgiLmxpc3QtYSIpLmF0dHIoImhyZWYiKS50ZXh0KCkNCiAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSBjb250YWluZXIuZmluZCgiLmxpc3QtdGl0bGUiKS53aGVyZSh4ID0+IHguYXR0cigiaHJlZiIpLnRleHQoKSA9PSBocmVmKS50ZXh0KCk7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goDQogICAgICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoJy5saXN0LWltZycpLmF0dHIoJ3NyYycpLnVybCgpLCB0aXRsZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICcnLA0KICAgICAgICAgICAgICAgICAgICAgICAgaHJlZi51cmkocmV0dXJuT2JqZWN0LnVybCksIHJldHVybk9iamVjdC5uYW1lDQogICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIH0pOw0KDQoNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5sb2coZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSkgPT4gew0KDQogICAgICAgIGlmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDAgfHwgKGZpbHRlci5hY3RpdmUgJiYgZmlsdGVyLmFjdGl2ZSAhPSAiIikpDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmdldEJ5R2VucmVzKGZpbHRlciwgcGFnZSk7DQoNCiAgICAgICAgaWYgKCFmaWx0ZXIudGl0bGUgfHwgZmlsdGVyLnRpdGxlLmxlbmd0aCA8PSAwKQ0KICAgICAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgICB2YXIganNvbkRhdGEgPSBhd2FpdCBIdHRwQ2xpZW50LkdldEpzb24ocmV0dXJuT2JqZWN0LnNlYXJjaFVybC5yZXBsYWNlKCJ7cX0iLCBmaWx0ZXIudGl0bGUgfHwgIiIpLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGlmIChqc29uRGF0YS5pdGVtcyAmJiBqc29uRGF0YS5pdGVtcy5sZW5ndGggPiAwKQ0KICAgICAgICAgICAganNvbkRhdGEuaXRlbXMuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoeC5yZXN1bHRzICYmIHgucmVzdWx0cy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIHgucmVzdWx0cy5mb3JFYWNoKGl0ZW0gPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IExpZ2h0SXRlbShpdGVtLnRodW1ibmFpbCwgaXRlbS50aXRsZS5odG1sVGV4dChmYWxzZSksICIiLCBpdGVtLnBlcm1hbGluay51cmkocmV0dXJuT2JqZWN0LnVybCkgfHwgIiIsIHJldHVybk9iamVjdC5uYW1lKQ0KICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXJzID0gYXN5bmMgKG5vdmVsVXJsKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSAiY2hhcHRlci1saXN0LyIudXJpKG5vdmVsVXJsKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICByZXR1cm4gY29udGFpbmVyLmZpbmQoIi5jaC1saXN0IGEiKS5tYXAoeCA9PiBuZXcgQ2hhcHRlcih4LnRleHQoZmFsc2UpLCB4LmF0dHIoImhyZWYiKS51cmwoKSkpLnJldmVyc2UoKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Tm92ZWwgPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsKSk7DQogICAgICAgIHZhciBjaGFwdGVycyA9IGF3YWl0IHJldHVybk9iamVjdC5nZXRDaGFwdGVycyhub3ZlbFVybCk7DQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIG5vdmVsUmV2aWV3cy5nZW5yZXMgPSBjb250YWluZXIuZmluZCgiI2N1cnJlbnRnZW4gYSIpLnRleHRBcnJheSgpOw0KICAgICAgICBub3ZlbFJldmlld3MudXZvdGVzID0gY29udGFpbmVyLnNlbGVjdCgiLnJhdGluZy1pbmZvIHN0cm9uZyIpLnRleHQoZmFsc2UpICsgIiAvIDUiOw0KICAgICAgICBub3ZlbFJldmlld3MuY29tcGxldGVkID0gY29udGFpbmVyLnNlbGVjdCgiI2N1cnJlbnRzdGF0dXMiKS50ZXh0KGZhbHNlKSA9PT0gIkNvbXBsZXRlZCIgPyAiU3RhdHVzOkNvbXBsZXRlZCIgOiAiU3RhdHVzOiIgKyBjb250YWluZXIuc2VsZWN0KCIjY3VycmVudHN0YXR1cyIpLnRleHQoZmFsc2UpOw0KICAgICAgICB2YXIgdHIgPSBjb250YWluZXIuc2VsZWN0KCIjcGFuZWxub3ZlbGluZm8gLmluZm8iKS5maW5kKCJ0ciIpOw0KICAgICAgICBpZiAodHIgIT09IG51bGwgJiYgdHIgJiYgdHIubGVuZ3RoKCkgPiAwKQ0KICAgICAgICAgICAgbm92ZWxSZXZpZXdzLmF1dGhvciA9IHRyLmVxKHRyLmxlbmd0aCgpIC0gMSkuc2VsZWN0KCJhIikudGV4dEFycmF5KCkuam9pbigiLCIpOw0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcubWFpbi10bWInKS5hdHRyKCdzcmMnKS51cmwoKSwNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy5lbnRyeS10aXRsZScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmRlc2MnKS5jbGVhbklubmVySFRNTCgpLA0KICAgICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgICBjaGFwdGVycywNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICAgICAgdW5kZWZpbmVkLA0KICAgICAgICApOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBuZXcgY2xpZW50KCkuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5zZWxlY3QoJy5wb3N0LWNvbnRlbnQgLnBhcicpLmNsZWFuSW5uZXJIVE1MKCk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdCA9IGFzeW5jIChwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3QubGF0ZXN0VXJsLnJlcGxhY2UoJ3twfScsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBqc29uRGF0YSA9IGF3YWl0IEh0dHBDbGllbnQuR2V0SnNvbih1cmwpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGlmIChqc29uRGF0YS5pdGVtcyAmJiBqc29uRGF0YS5pdGVtcy5sZW5ndGggPiAwKQ0KICAgICAgICAgICAganNvbkRhdGEuaXRlbXMuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgICAgICB2YXIgbG5rID0gKHgubm92ZWxfcGVybWFsaW5rIHx8ICIiKS50b0h0bWwoKS5xdWVyeVNlbGVjdG9yKCJhIik7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goDQogICAgICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0oeC50bWIsIChsbmsuaW5uZXJUZXh0IHx8ICIiKSwgIiIsIGxuay5nZXRBdHRyaWJ1dGUoImhyZWYiKS51cmkocmV0dXJuT2JqZWN0LnVybCksIHJldHVybk9iamVjdC5uYW1lKQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgIH0pDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCg0KfTs=&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5ub3ZlbGZ1bGwiOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJMYW5ndWFnZSA9ICJlbiI7DQogICAgcmV0dXJuT2JqZWN0Lm5hbWUgPSAnTm92ZWxGdWxsJzsNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vbm92ZWxmdWxsLmNvbS9sYXRlc3QtcmVsZWFzZS1ub3ZlbD9wYWdlPXtwfSc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL25vdmVsZnVsbC5jb20nOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hVcmwgPSAnaHR0cHM6Ly9ub3ZlbGZ1bGwuY29tL3NlYXJjaD9rZXl3b3JkPXtxfSZwYWdlPXtwfSc7DQogICAgcmV0dXJuT2JqZWN0LmNoYXB0ZXJzVXJsID0gJ2h0dHBzOi8vbm92ZWxmdWxsLmNvbS9hamF4LWNoYXB0ZXItb3B0aW9uP25vdmVsSWQ9e2lkfSc7DQogICAgcmV0dXJuT2JqZWN0LnBhbmluYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hQYWdpbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3QuaWNvbiA9ICdodHRwczovL25vdmVsZnVsbC5jb20vd2ViL2ltYWdlcy9mYXZpY29uLmljbyc7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzID0gbmV3IFBhcnNlclNlYXJjaFNldHRpbmdzKCk7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTaG91bmVuJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnSGFyZW0nKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDb21lZHknKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNYXJ0aWFsIEFydHMnLCAnTWFydGlhbCtBcnRzJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2Nob29sIExpZmUnLCAnU2Nob29sK0xpZmUnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNeXN0ZXJ5JyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2hvdWpvJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUm9tYW5jZScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1NjaS1maScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0dlbmRlciBCZW5kZXInLCAnR2VuZGVyK0JlbmRlcicpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01hdHVyZScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0ZhbnRhc3knKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdIb3Jyb3InKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdEcmFtYScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1RyYWdlZHknKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTdXBlcm5hdHVyYWwnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdFY2NoaScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1h1YW5odWFuJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWR2ZW50dXJlJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUHN5Y2hvbG9naWNhbCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1hpYW54aWEnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdXdXhpYScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hpc3RvcmljYWwnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTbGljZSBvZiBMaWZlJywgJ1NsaWNlK29mK0xpZmUnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdMb2xpY29uJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWR1bHQnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdKb3NlaScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1Nwb3J0cycpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1NtdXQnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNZWNoYScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1lhb2knKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTaG91bmVuIEFpJywgJ1Nob3VuZW4rQWknKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdL4buzIFTDrWNoIFbGsMahbmcgVOG7jWEnLCAnS+G7sytUw61jaCtWxrDGoW5nK1Thu41hJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTVQnKSwNCiAgICAgICAgXSwNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3Muc29ydFR5cGVzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0xhdGVzdCBSZWxlYXNlIE5vdmVsJywgJ2xhdGVzdC1yZWxlYXNlLW5vdmVsJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnSG90IE5vdmVsJywgJ2hvdC1ub3ZlbCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NvbXBsZXRlZCBOb3ZlbCcsICdjb21wbGV0ZWQtbm92ZWwnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNb3N0IFBvcHVsYXInLCAnbW9zdC1wb3B1bGFyJyksDQogICAgICAgIF0sDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldFNlY3Rpb25zID0gKGtleXMpID0+IHsNCiAgICAgICAgdmFyIHNlY3Rpb25zID0gWw0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImxhdGVzdCIsICJMYXRlc3QgVXBkYXRlIiwgIkxhdGVzdCIsIHRydWUpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImhvdCIsICJIb3QgTm92ZWwiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAiaG90LW5vdmVsIikpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImNvbXBsZXRlZCIsICJDb21wbGV0ZWQgTm92ZWwiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAiY29tcGxldGVkLW5vdmVsIikpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oInBvcHVsYXIiLCAiTW9zdCBQb3B1bGFyIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgIm1vc3QtcG9wdWxhciIpKQ0KICAgICAgICBdDQoNCiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICByZXR1cm4gbmV3IEZpbHRlcigpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciBnZW5yZVVybCA9ICJnZW5yZS97Z30/cGFnZT17cH0iLnVyaShyZXR1cm5PYmplY3QudXJsKS5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICB2YXIgc29ydFR5cGVVcmwgPSAie3N9P3BhZ2U9e3B9Ii51cmkocmV0dXJuT2JqZWN0LnVybCkucmVwbGFjZSgie3B9IiwgcGFnZS50b1N0cmluZygpKTsNCiAgICAgICAgdmFyIHEgPSBmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDAgPyBnZW5yZVVybC5yZXBsYWNlKCJ7Z30iLCBmaWx0ZXIuZ2VucmVzWzBdKSA6ICgoZmlsdGVyLnNvcnRUeXBlICYmIGZpbHRlci5zb3J0VHlwZSAhPSAnJyA/IHNvcnRUeXBlVXJsLnJlcGxhY2UoIntzfSIsIGZpbHRlci5zb3J0VHlwZSkgOiB1bmRlZmluZWQpKTsNCiAgICAgICAgdmFyIHF1ZXJ5ID0gcSB8fCByZXR1cm5PYmplY3Quc2VhcmNoVXJsLnJlcGxhY2UoJ3txfScsIGZpbHRlci50aXRsZSB8fCAiIikucmVwbGFjZSgne3B9JywgcGFnZS50b1N0cmluZygpKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHF1ZXJ5KSk7DQogICAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgICAgY29udGFpbmVyLmZpbmQoJy5saXN0LXRydXllbiAucm93JykuZm9yRWFjaCgoeCkgPT4gew0KICAgICAgICAgICAgaWYgKHguc2VsZWN0KCdpbWcnKS5hdHRyKCJzcmMiKS5oYXNWYWx1ZSgpKQ0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKA0KICAgICAgICAgICAgICAgICAgICBuZXcgTGlnaHRJdGVtKG5ldyBJbWFnZUhhbmRsZXIocmV0dXJuT2JqZWN0LnVybCwgeC5zZWxlY3QoJy50cnV5ZW4tdGl0bGUgYScpLmF0dHIoImhyZWYiKS51cmwoKSwgIi5ib29rIGltZyIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgeC5zZWxlY3QoJy50cnV5ZW4tdGl0bGUgYScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICAgICAgICAgICAgJycsDQogICAgICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLnRydXllbi10aXRsZSBhJykuYXR0cigiaHJlZiIpLnVybCgpLCByZXR1cm5PYmplY3QubmFtZQ0KICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXJzID0gYXN5bmMgKG5vdmVsVXJsLCBodG1sQ29udGFpbmVyKSA9PiB7DQogICAgICAgIHZhciBjaGFwdGVycyA9IFtdOw0KICAgICAgICB2YXIgdXJsID0gImh0dHBzOi8vbm92ZWxmdWxsLmNvbS9hamF4LWNoYXB0ZXItb3B0aW9uP25vdmVsSWQ9e2lkfSIucmVwbGFjZSgie2lkfSIsDQogICAgICAgICAgICBodG1sQ29udGFpbmVyLnNlbGVjdCgiI3JhdGluZyIpLmF0dHIoImRhdGEtbm92ZWwtaWQiKS5oYXNWYWx1ZSgpID8NCiAgICAgICAgICAgIGh0bWxDb250YWluZXIuc2VsZWN0KCIjcmF0aW5nIikuYXR0cigiZGF0YS1ub3ZlbC1pZCIpLnRleHQoKSA6DQogICAgICAgICAgICBodG1sQ29udGFpbmVyLnNlbGVjdCgiW2RhdGEtbm92ZWwtaWRdIikuYXR0cigiZGF0YS1ub3ZlbC1pZCIpLnRleHQoKSk7DQoNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KDQogICAgICAgIGNvbnRhaW5lci5maW5kKCdvcHRpb24nKS5mb3JFYWNoKGEgPT4gew0KICAgICAgICAgICAgdmFyIGFVcmwgPSBhLmF0dHIoInZhbHVlIikudXJsKCk7DQogICAgICAgICAgICB2YXIgdGl0bGUgPSBhLnRleHQoZmFsc2UpOw0KICAgICAgICAgICAgaWYgKHVybCAmJiB1cmwgIT09ICcnKSBjaGFwdGVycy5wdXNoKG5ldyBDaGFwdGVyKHRpdGxlLCBhVXJsKSk7DQogICAgICAgIH0pDQogICAgICAgIHJldHVybiBjaGFwdGVyczsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Tm92ZWwgPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsKSk7DQogICAgICAgIHZhciBjaGFwdGVycyA9IGF3YWl0IHJldHVybk9iamVjdC5nZXRDaGFwdGVycyhub3ZlbFVybCwgY29udGFpbmVyKTsNCiAgICAgICAgdmFyIG5vdmVsUmV2aWV3cyA9IG5ldyBOb3ZlbFJldmlld3MoKTsNCiAgICAgICAgdmFyIGluZm9zID0gY29udGFpbmVyLmZpbmQoIi5pbmZvID4gZGl2Iik7DQogICAgICAgIG5vdmVsUmV2aWV3cy5nZW5yZXMgPSBpbmZvcy5lcSgyKS5maW5kKCJhIikubWFwKHggPT4geC50ZXh0KGZhbHNlKSk7DQogICAgICAgIG5vdmVsUmV2aWV3cy5hdXRob3IgPSBpbmZvcy5lcSgwKS5maW5kKCJhIikudGV4dChmYWxzZSk7DQogICAgICAgIG5vdmVsUmV2aWV3cy51dm90ZXMgPSBjb250YWluZXIuc2VsZWN0KCIuY29sLWluZm8tZGVzYyA+IC5kZXNjID4gLnNtYWxsIHN0cm9uZzpmaXJzdC1jaGlsZCBzcGFuIikudGV4dChmYWxzZSkgKyAiIC8gMTAiOw0KICAgICAgICBub3ZlbFJldmlld3MuY29tcGxldGVkID0gaW5mb3MubGFzdCgpLnNlbGVjdCgiYSIpLnRleHQoZmFsc2UpID09PSAiQ29tcGxldGVkIiA/ICJTdGF0dXM6Q29tcGxldGVkIiA6ICJTdGF0dXM6T25nb2luZyI7DQoNCiAgICAgICAgcmV0dXJuIG5ldyBEZXRhbGlJdGVtKA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmJvb2sgaW1nJykuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcudGl0bGUnKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy5kZXNjLXRleHQnKS5jbGVhbklubmVySFRNTCgpLA0KICAgICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgICBjaGFwdGVycywNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICAgICAgdW5kZWZpbmVkLA0KICAgICAgICApOw0KICAgIH0NCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IG5ldyBjbGllbnQoKS5nZXRIdG1sKHVybCkpLnNlbGVjdCgnI2NoYXB0ZXItY29udGVudCcpLmNsZWFuSW5uZXJIVE1MKCk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdCA9IGFzeW5jIChwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3QubGF0ZXN0VXJsLnJlcGxhY2UoJ3twfScsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgnLmxpc3QtdHJ1eWVuIC5yb3cnKS5mb3JFYWNoKCh4KSA9PiB7DQogICAgICAgICAgICBpZiAoeC5zZWxlY3QoJ2ltZycpLmF0dHIoInNyYyIpLmhhc1ZhbHVlKCkpDQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goDQogICAgICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0oDQogICAgICAgICAgICAgICAgICAgICAgICBuZXcgSW1hZ2VIYW5kbGVyKHJldHVybk9iamVjdC51cmwsIHguc2VsZWN0KCcudHJ1eWVuLXRpdGxlIGEnKS5hdHRyKCJocmVmIikudXJsKCksICIuYm9vayBpbWciKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCcudHJ1eWVuLXRpdGxlIGEnKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICcnLA0KICAgICAgICAgICAgICAgICAgICAgICAgeC5zZWxlY3QoJy50cnV5ZW4tdGl0bGUgYScpLmF0dHIoImhyZWYiKS51cmwoKSwgcmV0dXJuT2JqZWN0Lm5hbWUNCiAgICAgICAgICAgICAgICAgICAgKSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCg0KfTs=&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5ub3ZlbG9ubGluZWZ1bGwiOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJMYW5ndWFnZSA9ICJlbiI7DQogICAgcmV0dXJuT2JqZWN0Lm5hbWUgPSAnTm92ZWxPbmxpbmVGdWxsJzsNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vbm92ZWxvbmxpbmVmdWxsLmNvbS9ub3ZlbF9saXN0P3R5cGU9bGF0ZXN0JmNhdGVnb3J5PWFsbCZzdGF0ZT1hbGwmcGFnZT17cH0nOw0KICAgIHJldHVybk9iamVjdC51cmwgPSAnaHR0cHM6Ly9ub3ZlbG9ubGluZWZ1bGwuY29tLyc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL25vdmVsb25saW5lZnVsbC5jb20vc2VhcmNoX25vdmVscy97cX0/cGFnZT17cH0nOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IGZhbHNlOw0KICAgIHJldHVybk9iamVjdC5pY29uID0gJ2h0dHBzOi8vbm92ZWxvbmxpbmVmdWxsLmNvbS90aGVtZXMvaG9tZS9pbWFnZXMvZmF2aWNvbi5wbmcnOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5tdWx0aVNlbGVjdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJBbGwiLCAiYWxsIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQ2hpbmVzZSIsIDMpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkVuZ2xpc2giLCA2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJLb3JlYW4iLCAxMyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiT3JpZ2luYWwiLCAxOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQWN0aW9uIiwgMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQWR2ZW50dXJlIiwgMiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQ29tZWR5IiwgNCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRHJhbWEiLCA1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJGYW50YXN5IiwgNyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR2VuZGVyIEJlbmRlciIsIDgpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhhcmVtIiwgOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGlzdG9yaWNhbCIsIDEwKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIb3Jyb3IiLCAxMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSm9zZWkiLCAxMiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTG9saWNvbiIsIDE0KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNYXJ0aWFsIEFydHMiLCAxNSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWF0dXJlIiwgMTYpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1lY2hhIiwgMTcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk15c3RlcnkiLCAxOCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUHN5Y2hvbG9naWNhbCIsIDIwKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJSZWluY2FybmF0aW9uIiwgMjEpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlJvbWFuY2UiLCAyMiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2Nob29sIExpZmUiLCAyMyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2NpLWZpIiwgMjQpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNlaW5lbiIsIDI1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTaG90YWNvbiIsIDI2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTaG91am8iLCAyNyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2hvdWpvIEFpIiwgMjgpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNob3VuZW4iLCAyOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2hvdW5lbiBBaSIsIDMwKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTbGljZSBvZiBMaWZlIiwgMzEpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNtdXQiLCAzMiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU3BvcnRzIiwgMzMpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlN1cGVybmF0dXJhbCIsIDM0KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJUcmFnZWR5IiwgMzUpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlZpcnR1YWwgUmVhbGl0eSIsIDM2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJXdXhpYSIsIDM3KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJYaWFueGlhIiwgMzgpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlh1YW5odWFuIiwgMzkpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkFydHMiLCA0MCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQmlvZ3JhcGhpZXMiLCA0MSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQnVzaW5lc3MiLCA0MiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQ29tcHV0ZXJzIiwgNDMpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkVkdWNhdGlvbiIsIDQ2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJFbnRlcnRhaW5tZW50IiwgNDcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkZpY3Rpb24iLCA0OCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSHVtb3IiLCA1MSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSW52ZXN0aW5nIiwgNTIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkxpdGVyYXR1cmUiLCA1MyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWVtb2lycyIsIDU0KQ0KDQogICAgICAgIF0NCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3Muc29ydFR5cGVzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0xhdGVzdCcsICdsYXRlc3QnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdOZXdlc3QnLCAnbmV3ZXN0JyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVG9wIHZpZXcnLCAndG9wdmlldycpDQogICAgICAgIF0sDQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJuZXdlc3QiLCAiTmV3ZXN0IE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgIm5ld2VzdCIpKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJ0b3AiLCAiVG9wIHZpZXciLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAidG9wdmlldyIpKQ0KICAgICAgICBdDQoNCiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICByZXR1cm4gbmV3IEZpbHRlcihbImFsbCJdLCAidG9wdmlldyIpOw0KICAgIH07DQoNCg0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciBzb3J0VHlwZVVyaSA9ICJodHRwczovL25vdmVsb25saW5lZnVsbC5jb20vbm92ZWxfbGlzdD90eXBlPXtzfSZjYXRlZ29yeT17Z30mc3RhdGU9YWxsJnBhZ2U9e3B9Ig0KICAgICAgICB2YXIgc29ydFR5cGVVcmwgPSBzb3J0VHlwZVVyaS5yZXBsYWNlKCJ7c30iLCBmaWx0ZXIuc29ydFR5cGUpLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSkucmVwbGFjZSgie2d9IiwgZmlsdGVyLmdlbnJlcy5sZW5ndGggPiAwID8gZmlsdGVyLmdlbnJlc1swXSA6ICJhbGwiKTsNCg0KICAgICAgICB2YXIgdXJsID0gKCFmaWx0ZXIudGl0bGUgfHwgZmlsdGVyLnRpdGxlID09ICIiKSAmJiBmaWx0ZXIuc29ydFR5cGUgJiYgZmlsdGVyLnNvcnRUeXBlICE9ICcnID8gc29ydFR5cGVVcmwgOiByZXR1cm5PYmplY3Quc2VhcmNoVXJsLnJlcGxhY2UoJ3txfScsIChmaWx0ZXIudGl0bGUgfHwgIiIpLnJlcGxhY2UoL1sgXS8sICJfIikpOw0KDQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLnVwZGF0ZV9pdGVtLCAuaXRlbXVwZGF0ZSIpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKHguc2VsZWN0KCJpbWciKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiaW1nIikuYXR0cigiYWx0IHwgdGl0bGUiKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiYSIpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldE5vdmVsID0gYXN5bmMgKG5vdmVsVXJsKSA9PiB7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbChub3ZlbFVybCkpOw0KICAgICAgICB2YXIgY2hhcHRlcnMgPSBjb250YWluZXIuZmluZCgiLmNoYXB0ZXItbGlzdCAucm93IGEiKS5tYXAoeCA9PiBuZXcgQ2hhcHRlcih4LnRleHQoZmFsc2UpLCB4LmF0dHIoImhyZWYiKS51cmwoKSkpOw0KICAgICAgICB2YXIgbm92ZWxSZXZpZXdzID0gbmV3IE5vdmVsUmV2aWV3cygpOw0KICAgICAgICB2YXIgaW5mb3MgPSBjb250YWluZXIuZmluZCgiLnRydXllbl9pbmZvX3JpZ2h0IGxpIikNCg0KDQogICAgICAgIG5vdmVsUmV2aWV3cy5nZW5yZXMgPSBpbmZvcy5lcSgyKS5maW5kKCJhIikudGV4dEFycmF5KCk7DQogICAgICAgIG5vdmVsUmV2aWV3cy5hdXRob3IgPSBpbmZvcy5lcSgxKS5maW5kKCJhIikudGV4dCgpOw0KICAgICAgICBub3ZlbFJldmlld3MudXZvdGVzID0gaW5mb3MuZXEoNikudGV4dChmYWxzZSk7DQogICAgICAgIG5vdmVsUmV2aWV3cy5kZXNjcmlwdGlvbiA9IGluZm9zLnNlbGVjdCgiI25vaWR1bmdtIikudGV4dChmYWxzZSk7DQogICAgICAgIG5vdmVsUmV2aWV3cy5jb21wbGV0ZWQgPSBpbmZvcy5lcSgzKS5zZWxlY3QoImEiKS50ZXh0KGZhbHNlKSA9PT0gIkNvbXBsZXRlZCIgPyAiU3RhdHVzOkNvbXBsZXRlZCIgOiAiU3RhdHVzOk9uZ29pbmciOw0KDQogICAgICAgIHJldHVybiBuZXcgRGV0YWxpSXRlbSgNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoIi5pbmZvX2ltYWdlIGltZyIpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLnRydXllbl9pbmZvX3JpZ2h0IGgxJykudGV4dChmYWxzZSksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcjbm9pZHVuZ20nKS5jbGVhbklubmVySFRNTCgpLA0KICAgICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgICBjaGFwdGVycy5yZXZlcnNlKCksDQogICAgICAgICAgICBub3ZlbFJldmlld3MsDQogICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgIHVuZGVmaW5lZCwNCiAgICAgICAgKTsNCiAgICB9DQoNCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICByZXR1cm4gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBuZXcgY2xpZW50KCkuZ2V0SHRtbCh1cmwpKS5zZWxlY3QoIi52dW5nX2RvYyIpLmNsZWFuSW5uZXJIVE1MKCk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdCA9IGFzeW5jIChwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3QubGF0ZXN0VXJsLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLnVwZGF0ZV9pdGVtIikuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoImltZyIpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJpbWciKS5hdHRyKCJ0aXRsZSIpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICAgICIiLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJhIikuYXR0cigiaHJlZiIpLnVybCgpLA0KICAgICAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lKSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCn07&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5yZWFkbGlnaHRub3ZlbCI7DQogICAgcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCiAgICByZXR1cm5PYmplY3QubmFtZSA9ICdSZWFkTGlnaHROb3ZlbCc7DQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdFVybCA9ICdodHRwczovL3d3dy5yZWFkbGlnaHRub3ZlbC5jYyc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL3d3dy5yZWFkbGlnaHRub3ZlbC5jYy8nOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hVcmwgPSAnaHR0cHM6Ly93d3cucmVhZGxpZ2h0bm92ZWwuY2Mvc2VhcmNoL3txfS97cH0nOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gZmFsc2U7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFBhZ2luYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5pY29uID0gJ2h0dHBzOi8vd3d3Lmdvb2dsZS5jb20vczIvZmF2aWNvbnM/ZG9tYWluPWh0dHBzOi8vd3d3LnJlYWRsaWdodG5vdmVsLmNjLyc7DQoNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MgPSBuZXcgUGFyc2VyU2VhcmNoU2V0dGluZ3MoKTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MuZ2VucmVzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0FueScsIDApLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0ZhbnRhc3knLCAxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdYaWFueGlhJywgMiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUm9tYW50aWMnLCAzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdIaXN0b3JpY2FsJywgNCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2NpLWZpJywgNSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnR2FtZScsIDYpLA0KICAgICAgICBdLA0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0U2VjdGlvbnMgPSBhc3luYyAoa2V5cykgPT4gew0KICAgICAgICB2YXIgc2VjdGlvbnMgPSBbDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibGF0ZXN0IiwgIkxhdGVzdCBVcGRhdGUiLCAiTGF0ZXN0IiwgdHJ1ZSkNCiAgICAgICAgXQ0KDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC50cmFuc2xhdGVTZWN0aW9uID0gYXN5bmMgKHNlY3Rpb24sIHBhZ2UpID0+IHsNCiAgICAgICAgaWYgKHNlY3Rpb24uaWRlbnRpZmllciA9PSAiTGF0ZXN0IikNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QubGF0ZXN0KHBhZ2UpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LnNlYXJjaChzZWN0aW9uLmZpbHRlciB8fCByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlcigpLCBwYWdlKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlciA9ICgpID0+IHsNCiAgICAgICAgdmFyIGZpbHRlciA9IG5ldyBGaWx0ZXIoKTsNCiAgICAgICAgcmV0dXJuIGZpbHRlcjsNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LmdldEdlbnJlc1NlYXJjaCA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHEgPSAnaHR0cHM6Ly93d3cucmVhZGxpZ2h0bm92ZWwuY2MvbWVtYmVyYWN0aW9uLmFzcHgnOw0KICAgICAgICB2YXIgZiA9IHsNCiAgICAgICAgICAgIGFjdGlvbjogJ25leHRib29rY2F0ZWdvcnknLA0KICAgICAgICAgICAgY2F0ZWdvcnlpZDogZmlsdGVyLmdlbnJlc1swXSwNCiAgICAgICAgICAgIHBhZ2U6IHBhZ2UsDQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIGpzb24gPSBhd2FpdCBIdHRwQ2xpZW50LnBvc3RGb3JtKHEsIGYpOw0KDQogICAgICAgIHJldHVybiBqc29uICYmIGpzb24uZGF0YSA/IGpzb24uZGF0YS5tYXAoKHgpID0+DQogICAgICAgICAgICAgICAgbmV3IExpZ2h0SXRlbSgNCiAgICAgICAgICAgICAgICAgICAgYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoYXdhaXQgcmV0dXJuT2JqZWN0LmdldE5vdmVsKHguQm9va1Bpbllpbi51cmkocmV0dXJuT2JqZWN0LnBhcnNlci51cmwpICsgIi8iLCB0cnVlKSkuaW1hZ2UNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICB4LkJvb2tOYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgeC5EZXNjcmlwdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgIHguQm9va1Bpbllpbi51cmkodHJldHVybk9iamVjdGhpcy51cmwpICsgIi8iLA0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUNCiAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgKSA6DQogICAgICAgICAgICBbXTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoZmlsdGVyLmdlbnJlcy5sZW5ndGggPiAwKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5nZXRHZW5yZXNTZWFyY2goZmlsdGVyLCBwYWdlKTsNCg0KICAgICAgICB2YXIgcXVlcnkgPSByZXR1cm5PYmplY3Quc2VhcmNoVXJsDQogICAgICAgICAgICAucmVwbGFjZSgne3F9JywgZmlsdGVyLnRpdGxlIHx8ICIiKQ0KICAgICAgICAgICAgLnJlcGxhY2UoJ3twfScsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbChxdWVyeSkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcubGlzdC1pdGVtJykuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKA0KICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0oDQogICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCdpbWcnKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICAgICAgeC5zZWxlY3QoJ2ltZycpLmF0dHIoImFsdCB8IHRpdGxlIikudGV4dChmYWxzZSksDQogICAgICAgICAgICAgICAgICAgICcnLA0KICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLmJvb2stbmFtZScpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUNCiAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgKTsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldE5vdmVsID0gYXN5bmMgKG5vdmVsVXJsLCBpZ25vcmVDaGFwdGVycykgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwsIGlnbm9yZUNoYXB0ZXJzKSk7DQogICAgICAgIHZhciBjaGFwdGVycyA9IFtdOw0KICAgICAgICB2YXIgbm92ZWxSZXZpZXdzID0gbmV3IE5vdmVsUmV2aWV3cygpOw0KICAgICAgICBpZiAoIWlnbm9yZUNoYXB0ZXJzKSB7DQogICAgICAgICAgICB2YXIgaHRtbENoYXB0ZXJzID0gY29udGFpbmVyLmZpbmQoJy5jaGFwdGVyLWxpc3QgYScpOw0KICAgICAgICAgICAgaHRtbENoYXB0ZXJzLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgICAgICBjaGFwdGVycy5wdXNoKA0KICAgICAgICAgICAgICAgICAgICBuZXcgQ2hhcHRlcih4LnNlbGVjdCgnLmNoYXB0ZXItbmFtZScpLnRleHQoZmFsc2UpLCB4LmF0dHIoImhyZWYiKS51cmwoKSkNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGNvbnRhaW5lci5maW5kKCIuYmFzZS1pbmZvIC5ib29rLWNhdGFsb2cgLnR4dCIpLnRleHRBcnJheSgpOw0KICAgICAgICBub3ZlbFJldmlld3MuYXV0aG9yID0gY29udGFpbmVyLnNlbGVjdCgiLmF1dGhvciAubmFtZSIpLnRleHQoZmFsc2UpOw0KICAgICAgICBub3ZlbFJldmlld3MudXZvdGVzID0gY29udGFpbmVyLnNlbGVjdCgiLnNjb3JlIikudGV4dChmYWxzZSkgKyAiIC8gMTAiOw0KICAgICAgICBub3ZlbFJldmlld3MuY29tcGxldGVkID0gY29udGFpbmVyLnNlbGVjdCgiLmJhc2UtaW5mbyAuYm9vay1zdGF0ZSAudHh0IikudGV4dChmYWxzZSkgPT09ICJDb21wbGV0ZWQiID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIjsNCiAgICAgICAgcmV0dXJuIG5ldyBEZXRhbGlJdGVtKA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmJvb2stY29udGFpbmVyIGltZycpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmJvb2staW5mbyAuYm9vay1uYW1lJykudGV4dChmYWxzZSksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcuc3lub3BzaXMgLmNvbnRlbnQgLmRlc2MnKS5jbGVhbklubmVySFRNTCgpLA0KICAgICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgICBjaGFwdGVycywNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICAgICAgdW5kZWZpbmVkLA0KICAgICAgICApOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICByZXR1cm4gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBuZXcgY2xpZW50KCkuZ2V0SHRtbCh1cmwpKS5zZWxlY3QoJy5yZWFkLWNvbnRhaW5lciAuc2VjdGlvbi1saXN0JykuY2xlYW5Jbm5lckhUTUwoKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0ID0gYXN5bmMgKHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHJldHVybk9iamVjdC5sYXRlc3RVcmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KDQogICAgICAgIGNvbnRhaW5lci5maW5kKCcudXBkYXRlLWNvbnRlbnQnKS5mb3JFYWNoKCh4KSA9PiB7DQogICAgICAgICAgICB2YXIgdSA9IHguc2VsZWN0KCcuaXRlbS10aXRsZSBhJykuYXR0cigiaHJlZiIpLnRleHQoZmFsc2UpOw0KICAgICAgICAgICAgdmFyIHRpdGxlID0geC5zZWxlY3QoJy5pdGVtLXRpdGxlIGEnKS50ZXh0KGZhbHNlKTsNCiAgICAgICAgICAgIGlmICh1ICE9ICIiICYmICFyZXN1bHQuZmluZCgoeCkgPT4gdS51cmkocmV0dXJuT2JqZWN0LnVybCkgPT0geC5ub3ZlbCB8fCB0aXRsZSA9PSB4LnRpdGxlKSkNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgNCiAgICAgICAgICAgICAgICAgICAgbmV3IExpZ2h0SXRlbSgNCiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChhd2FpdCByZXR1cm5PYmplY3QuZ2V0Tm92ZWwodS51cmkocmV0dXJuT2JqZWN0LnVybCksIHRydWUpKS5pbWFnZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdS51cmkocmV0dXJuT2JqZWN0LnVybCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUNCiAgICAgICAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm4gcmV0dXJuT2JqZWN0Ow0KfTs=&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50KSA9PiB7DQoJY29uc3QgcmV0dXJuT2JqZWN0ID0ge307DQoJcmV0dXJuT2JqZWN0LmlkID0gIjEucmVhZG5vdmVsZnVsbCI7DQoJcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCglyZXR1cm5PYmplY3QubmFtZSA9ICdSZWFkTm92ZWxGdWxsJzsNCglyZXR1cm5PYmplY3QuZGV0YWxpSXRlbVR5cGUgPSBEZXRhbGlJdGVtVHlwZS5Ob3ZlbDsNCglyZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vcmVhZG5vdmVsZnVsbC5jb20vbGF0ZXN0LXJlbGVhc2Utbm92ZWw/cGFnZT17cH0nOw0KCXJldHVybk9iamVjdC51cmwgPSAnaHR0cHM6Ly9yZWFkbm92ZWxmdWxsLmNvbS8nOw0KCXJldHVybk9iamVjdC5zZWFyY2hVcmwgPSAnaHR0cHM6Ly9yZWFkbm92ZWxmdWxsLmNvbS9zZWFyY2g/a2V5d29yZD17cX0mcGFnZT17cH0nOw0KCXJldHVybk9iamVjdC5jaGFwdGVyc1VybCA9ICdodHRwczovL3JlYWRub3ZlbGZ1bGwuY29tL2FqYXgvY2hhcHRlci1vcHRpb24/bm92ZWxJZD17aWR9JmN1cnJlbnRDaGFwdGVySWQ9MSc7DQoJcmV0dXJuT2JqZWN0LnBhbmluYXRpb24gPSB0cnVlOw0KCXJldHVybk9iamVjdC5zZWFyY2hQYWdpbmF0aW9uID0gdHJ1ZTsNCglyZXR1cm5PYmplY3QuaWNvbiA9ICdodHRwczovL3JlYWRub3ZlbGZ1bGwuY29tL2ltZy9mYXZpY29uLmljbyc7DQoJcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzID0gbmV3IFBhcnNlclNlYXJjaFNldHRpbmdzKCk7DQoJcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcyA9IHsNCgkJbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KCQl2YWx1ZXM6IFsNCgkJCW5ldyBsYWJlbFZhbHVlKCdTaG91bmVuJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnSGFyZW0nKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdDb21lZHknKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdNYXJ0aWFsIEFydHMnLCAnTWFydGlhbCtBcnRzJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnU2Nob29sIExpZmUnLCAnU2Nob29sK0xpZmUnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdNeXN0ZXJ5JyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnU2hvdWpvJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnUm9tYW5jZScpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ1NjaS1maScpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ0dlbmRlciBCZW5kZXInLCAnR2VuZGVyK0JlbmRlcicpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ01hdHVyZScpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ0ZhbnRhc3knKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdIb3Jyb3InKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdEcmFtYScpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ1RyYWdlZHknKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdTdXBlcm5hdHVyYWwnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdFY2NoaScpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ1h1YW5odWFuJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnQWR2ZW50dXJlJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnUHN5Y2hvbG9naWNhbCcpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ1hpYW54aWEnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdXdXhpYScpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ0hpc3RvcmljYWwnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdTbGljZSBvZiBMaWZlJywgJ1NsaWNlK29mK0xpZmUnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdMb2xpY29uJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnQWR1bHQnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdKb3NlaScpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ1Nwb3J0cycpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ1NtdXQnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdNZWNoYScpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ1lhb2knKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdTaG91bmVuIEFpJywgJ1Nob3VuZW4rQWknKSwNCgkJXSwNCgl9Ow0KCXJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zb3J0VHlwZXMgPSB7DQoJCW11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCgkJdmFsdWVzOiBbDQoJCQluZXcgbGFiZWxWYWx1ZSgnTGF0ZXN0IFJlbGVhc2UgTm92ZWwnLCAnbGF0ZXN0LXJlbGVhc2Utbm92ZWwnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdIb3QgTm92ZWwnLCAnaG90LW5vdmVsJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnQ29tcGxldGVkIE5vdmVsJywgJ2NvbXBsZXRlZC1ub3ZlbCcpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ01vc3QgUG9wdWxhcicsICdtb3N0LXBvcHVsYXItbm92ZWwnKSwNCgkJXSwNCgl9Ow0KCXJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQoJCXZhciBzZWN0aW9ucyA9IFsNCgkJCW5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCgkJCW5ldyBTZWN0aW9uKCJob3QiLCAiSG90IE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgImhvdC1ub3ZlbCIpKSwNCgkJCW5ldyBTZWN0aW9uKCJjb21wbGV0ZWQiLCAiQ29tcGxldGVkIE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgImNvbXBsZXRlZC1ub3ZlbCIpKSwNCgkJCW5ldyBTZWN0aW9uKCJwb3B1bGFyIiwgIk1vc3QgUG9wdWxhciIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJtb3N0LXBvcHVsYXItbm92ZWwiKSkNCgkJXQ0KCQlyZXR1cm4gc2VjdGlvbnMuZmlsdGVyKHggPT4gIWtleXMgfHwga2V5cy5pbmNsdWRlcyh4Lm5hbWUpKTsNCgl9DQoJcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KCQlpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKSByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmxhdGVzdChwYWdlKTsNCgkJZWxzZSByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LnNlYXJjaChzZWN0aW9uLmZpbHRlciB8fCByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlcigpLCBwYWdlKTsNCgl9DQoJcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIgPSAoKSA9PiB7DQoJCXZhciBmaWx0ZXIgPSBuZXcgRmlsdGVyKCk7DQoJCXJldHVybiBmaWx0ZXI7DQoJfTsNCglyZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSkgPT4gew0KCQl2YXIgZ2VucmVVcmwgPSAiZ2VucmUve2d9P3BhZ2U9e3B9Ii51cmkocmV0dXJuT2JqZWN0LnVybCkucmVwbGFjZSgie3B9IiwgcGFnZS50b1N0cmluZygpKTsNCgkJdmFyIHNvcnRUeXBlVXJsID0gIntzfT9wYWdlPXtwfSIudXJpKHJldHVybk9iamVjdC51cmwpLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQoJCXZhciBxID0gZmlsdGVyLmdlbnJlcy5sZW5ndGggPiAwID8gZ2VucmVVcmwucmVwbGFjZSgie2d9IiwgZmlsdGVyLmdlbnJlc1swXSkgOiAoZmlsdGVyLnNvcnRUeXBlICYmIGZpbHRlci5zb3J0VHlwZSAhPSAnJyA/IHNvcnRUeXBlVXJsLnJlcGxhY2UoIntzfSIsIGZpbHRlci5zb3J0VHlwZSkgOiB1bmRlZmluZWQpOw0KCQl2YXIgcXVlcnkgPSBxIHx8IHJldHVybk9iamVjdC5zZWFyY2hVcmwucmVwbGFjZSgne3F9JywgZmlsdGVyLnRpdGxlIHx8ICIiKS5yZXBsYWNlKCd7cH0nLCBwYWdlLnRvU3RyaW5nKCkpOw0KCQl2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwocXVlcnkpKTsNCgkJdmFyIHJlc3VsdCA9IFtdOw0KCQljb250YWluZXIuZmluZCgnLmxpc3Qtbm92ZWwgLnJvdycpLmZvckVhY2goKHgpID0+IHsNCgkJCWlmICh4LnNlbGVjdCgnaW1nJykuYXR0cigic3JjIikuaGFzVmFsdWUoKSkgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbSh4LnNlbGVjdCgnaW1nJykuYXR0cigic3JjIikudXJsKCkucmVwbGFjZSgvWzAtOV0reFswLTldKy9naSwgIjE1MHgxNzAiKSwgeC5zZWxlY3QoJy5ub3ZlbC10aXRsZSBhJykudGV4dChmYWxzZSksICcnLCB4LnNlbGVjdCgnLm5vdmVsLXRpdGxlIGEnKS5hdHRyKCJocmVmIikudXJsKCksIHJldHVybk9iamVjdC5uYW1lKSwgKTsNCgkJfSk7DQoJCXJldHVybiByZXN1bHQ7DQoJfQ0KCXJldHVybk9iamVjdC5nZXRDaGFwdGVycyA9IGFzeW5jIChub3ZlbFVybCwgaHRtbENvbnRhaW5lcikgPT4gew0KCQl2YXIgY2hhcHRlcnMgPSBbXTsNCgkJdmFyIHVybCA9IHJldHVybk9iamVjdC5jaGFwdGVyc1VybC5yZXBsYWNlKCd7aWR9JywgKGh0bWxDb250YWluZXIuc2VsZWN0KCcjcmF0aW5nJykuYXR0cigiZGF0YS1ub3ZlbC1pZCIpLmhhc1ZhbHVlKCkgPyBodG1sQ29udGFpbmVyLnNlbGVjdCgnI3JhdGluZycpLmF0dHIoImRhdGEtbm92ZWwtaWQiKS50ZXh0KCkgOiBodG1sQ29udGFpbmVyLnNlbGVjdCgnW2RhdGEtbm92ZWwtaWRdJykuYXR0cigiZGF0YS1ub3ZlbC1pZCIpLnRleHQoKSkpOw0KCQl2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwodXJsKSk7DQoJCWNvbnRhaW5lci5maW5kKCdvcHRpb24nKS5mb3JFYWNoKHggPT4gew0KCQkJaWYgKHguYXR0cigidmFsdWUiKS5oYXNWYWx1ZSgpKSBjaGFwdGVycy5wdXNoKG5ldyBDaGFwdGVyKHgudGV4dChmYWxzZSksIHguYXR0cigidmFsdWUiKS51cmwoKSkpOw0KCQl9KTsNCgkJcmV0dXJuIGNoYXB0ZXJzOw0KCX0NCglyZXR1cm5PYmplY3QuZ2V0Tm92ZWwgPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCgkJdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsKSk7DQoJCXZhciBjaGFwdGVycyA9IGF3YWl0IHJldHVybk9iamVjdC5nZXRDaGFwdGVycyhub3ZlbFVybCwgY29udGFpbmVyKTsNCgkJdmFyIGl0ZW0gPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQoJCXZhciBpbmZvID0gY29udGFpbmVyLmZpbmQoJy5pbmZvIGxpJyk7DQoJCWl0ZW0uZ2VucmVzID0gaW5mby53aGVyZSh4ID0+IHguaW5uZXJIVE1MKCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKCJnZW5yZSIpICE9IC0xKS5maW5kKCJhIikudGV4dEFycmF5KCk7DQoJCWl0ZW0uYXV0aG9yID0gaW5mby53aGVyZSh4ID0+IHguaW5uZXJIVE1MKCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKCJhdXRob3IiKSAhPSAtMSkuZmluZCgiYSIpLnRleHQoZmFsc2UpDQoJCWl0ZW0uY29tcGxldGVkID0gaW5mby53aGVyZSh4ID0+IHguaW5uZXJIVE1MKCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKCJzdGF0dXMiKSAhPSAtMSkudGV4dChmYWxzZSk7DQoJCWl0ZW0uYWx0ZXJuYXRpdmVOYW1lcyA9IGluZm8ud2hlcmUoeCA9PiB4LmlubmVySFRNTCgpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigiYWx0ZXJuYXRpdmUgbmFtZXMiKSAhPSAtMSkudGV4dCgpOw0KCQlyZXR1cm4gbmV3IERldGFsaUl0ZW0oY29udGFpbmVyLnNlbGVjdCgnLmJvb2sgaW1nJykuYXR0cigic3JjIikudXJsKCksIGNvbnRhaW5lci5zZWxlY3QoJy50aXRsZScpLnRleHQoZmFsc2UpLCBjb250YWluZXIuc2VsZWN0KCcuZGVzYy10ZXh0JykuY2xlYW5Jbm5lckhUTUwoKSwgbm92ZWxVcmwsIGNoYXB0ZXJzLCBpdGVtLCByZXR1cm5PYmplY3QubmFtZSwgdW5kZWZpbmVkKTsNCgl9DQoJcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKSA9PiB7DQoJCXJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IG5ldyBjbGllbnQoKS5nZXRIdG1sKHVybCkpLnNlbGVjdCgnI2Noci1jb250ZW50JykuY2xlYW5Jbm5lckhUTUwoKTsNCgl9DQoJcmV0dXJuT2JqZWN0LmxhdGVzdCA9IGFzeW5jIChwYWdlKSA9PiB7DQoJCXZhciB1cmwgPSByZXR1cm5PYmplY3QubGF0ZXN0VXJsLnJlcGxhY2UoJ3twfScsIHBhZ2UudG9TdHJpbmcoKSk7DQoJCXZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCgkJdmFyIHJlc3VsdCA9IFtdOw0KCQljb250YWluZXIuZmluZCgnLmxpc3Qtbm92ZWwgLnJvdycpLmZvckVhY2goKHgpID0+IHsNCgkJCWlmICh4LnNlbGVjdCgnaW1nJykuYXR0cigic3JjIikuaGFzVmFsdWUoKSkgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbSh4LnNlbGVjdCgnaW1nJykuYXR0cigic3JjIikudXJsKCkucmVwbGFjZSgvWzAtOV0reFswLTldKy9naSwgIjE1MHgxNzAiKSwgeC5zZWxlY3QoJy5ub3ZlbC10aXRsZSBhJykudGV4dCgpLCAnJywgeC5zZWxlY3QoJy5ub3ZlbC10aXRsZSBhJykuYXR0cigiaHJlZiIpLnVybCgpLCByZXR1cm5PYmplY3QubmFtZSksICk7DQoJCX0pOw0KCQlyZXR1cm4gcmVzdWx0Ow0KCX0NCglyZXR1cm4gcmV0dXJuT2JqZWN0Ow0KfTs=&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5yb3lhbHJvYWQiOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJMYW5ndWFnZSA9ICJlbiI7DQogICAgcmV0dXJuT2JqZWN0Lm5hbWUgPSAnUm95YWxSb2FkJzsNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vd3d3LnJveWFscm9hZC5jb20vZmljdGlvbnMvbGF0ZXN0LXVwZGF0ZXM/cGFnZT17cH0nOw0KICAgIHJldHVybk9iamVjdC51cmwgPSAnaHR0cHM6Ly93d3cucm95YWxyb2FkLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL3d3dy5yb3lhbHJvYWQuY29tL2ZpY3Rpb25zL3NlYXJjaD9wYWdlPXtwfSZ0aXRsZT17cX0nOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly93d3cucm95YWxyb2FkLmNvbS9mYXZpY29uLTE2eDE2LnBuZz92PTIwMjAwMTI1JzsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MgPSBuZXcgUGFyc2VyU2VhcmNoU2V0dGluZ3MoKTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MubXVsdGlTZWxlY3Rpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJBY3Rpb24iLCAiYWN0aW9uIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQWR2ZW50dXJlIiwgImFkdmVudHVyZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkNvbWVkeSIsICJjb21lZHkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJDb250ZW1wb3JhcnkiLCAiY29udGVtcG9yYXJ5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRHJhbWEiLCAiZHJhbWEiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJQc3ljaG9sb2dpY2FsIiwgInBzeWNob2xvZ2ljYWwiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJSb21hbmNlIiwgInJvbWFuY2UiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTYXRpcmUiLCAic2F0aXJlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2NpLUZpIiwgInNjaV9maSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNob3J0IFN0b3J5IiwgIm9uZV9zaG90IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVHJhZ2VkeSIsICJ0cmFnZWR5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRmFudGFzeSIsICJmYW50YXN5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTXlzdGVyeSIsICJteXN0ZXJ5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGlzdG9yaWNhbCIsICJoaXN0b3JpY2FsIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSG9ycm9yIiwgImhvcnJvciIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1hZ2ljIiwgIm1hZ2ljIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQW50aS1IZXJvIExlYWQiLCAiYW50aS1oZXJvX2xlYWQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJBcnRpZmljaWFsIEludGVsbGlnZW5jZSIsICJhcnRpZmljaWFsX2ludGVsbGlnZW5jZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkF0dHJhY3RpdmUgTUMiLCAiYXR0cmFjdGl2ZV9tYyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkN5YmVycHVuayIsICJjeWJlcnB1bmsiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJEdW5nZW9uIiwgImR1bmdlb24iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJEeXN0b3BpYSIsICJkeXN0b3BpYSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkZlbWFsZSBMZWFkIiwgImZlbWFsZV9sZWFkIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRmlyc3QgQ29udGFjdCIsICJGaXJzdF9Db250YWN0IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR2FtZUxpdCIsICJHYW1lTGl0IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR2VuZGVyIEJlbmRlciIsICJnZW5kZXJfYmVuZGVyIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR2VuZXRpY2FsbHkgRW5naW5lZXJlZCIsICJHZW5ldGljYWxseV9FbmdpbmVlcmVkIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR3JpbWRhcmsiLCAiR3JpbWRhcmsiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIYXJkIFNjaS1maSIsICJIYXJkX1NjaV9maSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhhcmVtIiwgImhhcmVtIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGlnaCBGYW50YXN5IiwgImhpZ2hfZmFudGFzeSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkxpdFJQRyIsICJMaXRSUEciKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJMb29wIiwgIkxvb3AiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJMb3cgRmFudGFzeSIsICJsb3dfZmFudGFzeSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1hbGUgTGVhZCIsICJtYWxlX2xlYWQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNYXJ0aWFsIEFydHMiLCAibWFydGlhbF9hcnRzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTXVsdGlwbGUgTGVhZCBDaGFyYWN0ZXJzIiwgIm11dGxpcGxlX2xlYWQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNeXRob3MiLCAibXl0aG9zIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTm9uLUh1bWFuIGxlYWQiLCAibm9uLWh1bWFuX2xlYWQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJQb3J0YWwgRmFudGFzeSAvIElzZWthaSIsICJzdW1tb25lZF9oZXJvIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUG9zdCBBcG9jYWx5cHRpYyIsICJwb3N0X2Fwb2NhbHlwdGljIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUHJvZ3Jlc3Npb24iLCAicHJvZ3Jlc3Npb24iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJSZWFkZXIgaW50ZXJhY3RpdmUiLCAicmVhZGVyX2ludGVyYWN0aXZlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUmVpbmNhcm5hdGlvbiIsICJyZWluY2FybmF0aW9uIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUnVsaW5nIENsYXNzIiwgInJ1bGluZ19jbGFzcyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNjaG9vbCBMaWZlIiwgInNjaG9vbF9saWZlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2VjcmV0IElkZW50aXR5IiwgInNlY3JldF9pZGVudGl0eSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNsaWNlIG9mIExpZmUiLCAic2xpY2Vfb2ZfbGlmZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNvZnQgU2NpLWZpIiwgIlNvZnRfU2NpX2ZpIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU3BhY2UgT3BlcmEiLCAic3BhY2Vfb3BlcmEiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTcG9ydHMiLCAic3BvcnRzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU3RlYW1wdW5rIiwgInN0ZWFtcHVuayIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlN0cmF0ZWd5IiwgInN0cmF0ZWd5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU3Ryb25nIExlYWQiLCAic3Ryb25nX2xlYWQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTdXBlciBIZXJvZXMiLCAic3VwZXJfaGVyb2VzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU3VwZXJuYXR1cmFsIiwgInN1cGVybmF0dXJhbCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlRlY2hub2xvZ2ljYWxseSBFbmdpbmVlcmVkIiwgIlRlY2hub2xvZ2ljYWxseV9FbmdpbmVlcmVkIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVGltZSBUcmF2ZWwiLCAiVGltZV9UcmF2ZWwiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJVcmJhbiBGYW50YXN5IiwgInVyYmFuX2ZhbnRhc3kiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJWaWxsYWlub3VzIExlYWQiLCAidmlsbGFpbm91c19sZWFkIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVmlydHVhbCBSZWFsaXR5IiwgInZpcnR1YWxfcmVhbGl0eSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIldhciBhbmQgTWlsaXRhcnkiLCAid2FyX2FuZF9taWxpdGFyeSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIld1eGlhIiwgInd1eGlhIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiWGlhbnhpYSIsICJ4aWFueGlhIikNCiAgICAgICAgXQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zdGF0dXNlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IHRydWUsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkNvbXBsZXRlZCIsICJDT01QTEVURUQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJPbmdvaW5nIiwgIk9OR09JTkciKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIaWF0dXMiLCAiSElBVFVTIiksDQoNCiAgICAgICAgXQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5sYW5ndWFnZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRmFuIEZpY3Rpb24iLCAiZmFuZmljdGlvbiIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk9yaWdpbmFsIiwgIm9yaWdpbmFsIikNCiAgICAgICAgXQ0KICAgIH0NCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldFNlY3Rpb25zID0gKGtleXMpID0+IHsNCiAgICAgICAgdmFyIHNlY3Rpb25zID0gWw0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImxhdGVzdCIsICJMYXRlc3QgVXBkYXRlIiwgIkxhdGVzdCIsIHRydWUpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImNvbXBsZXRlZCIsICJDb21wbGV0ZWQiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgIkNPTVBMRVRFRCIpKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJvbmdvaW5nIiwgIk9uZ29pbmciLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgIk9OR09JTkciKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigicm9tYW5jZSIsICJSb21hbmNlIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsicm9tYW5jZSJdKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiYWN0aW9uIiwgIkFjdGlvbiIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcihbImFjdGlvbiJdKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibXlzdGVyeSIsICJNeXN0ZXJ5IiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsibXlzdGVyeSJdKSksDQogICAgICAgIF0NCg0KICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmlsdGVyKHggPT4gIWtleXMgfHwga2V5cy5pbmNsdWRlcyh4Lm5hbWUpKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QudHJhbnNsYXRlU2VjdGlvbiA9IGFzeW5jIChzZWN0aW9uLCBwYWdlKSA9PiB7DQogICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmxhdGVzdChwYWdlKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5zZWFyY2goc2VjdGlvbi5maWx0ZXIgfHwgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgcGFnZSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIgPSAoKSA9PiB7DQogICAgICAgIHZhciBmaWx0ZXIgPSBuZXcgRmlsdGVyKCk7DQogICAgICAgIHJldHVybiBmaWx0ZXI7DQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3Quc2VhcmNoVXJsLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSkucmVwbGFjZSgie3F9IiwgZmlsdGVyLnRpdGxlIHx8ICIiKTsNCiAgICAgICAgaWYgKGZpbHRlci5nZW5yZXMubGVuZ3RoID4gMCkNCiAgICAgICAgICAgIHVybCArPSAiJiIgKyBmaWx0ZXIuZ2VucmVzLm1hcCh4ID0+ICJ0YWdzQWRkPSIgKyB4KS5qb2luKCImIikNCg0KICAgICAgICBpZiAoZmlsdGVyLmFjdGl2ZSAmJiBmaWx0ZXIuYWN0aXZlICE9ICIiKQ0KICAgICAgICAgICAgdXJsICs9ICImc3RhdHVzPSIgKyBmaWx0ZXIuYWN0aXZlOw0KDQogICAgICAgIGlmIChmaWx0ZXIubGFuZ3VhZ2UgJiYgZmlsdGVyLmxhbmd1YWdlICE9ICIiKQ0KICAgICAgICAgICAgdXJsICs9ICImdHlwZT0iICsgZmlsdGVyLmxhbmd1YWdlOw0KDQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLmZpY3Rpb24tbGlzdC1pdGVtIikuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoImltZyIpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCIuZmljdGlvbi10aXRsZSIpLnRleHQoKSwNCiAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLmZpY3Rpb24tdGl0bGUgYSIpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldE5vdmVsPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsKSk7DQogICAgICAgIHZhciBjaGFwdGVycyA9IGNvbnRhaW5lci5maW5kKCIjY2hhcHRlcnMgdGJvZHkgdHIiKS5tYXAoeCA9PiB4LnNlbGVjdCgiYSIpKS5maWx0ZXIoeCA9PiB4Lmhhc0VsZW1lbnQoKSkubWFwKHggPT4gbmV3IENoYXB0ZXIoeC50ZXh0KCksIHguYXR0cigiaHJlZiIpLnVybCgpKSk7DQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIHZhciBpbmZvcyA9IGNvbnRhaW5lci5zZWxlY3QoIi5maWN0aW9uLWluZm8gLmNvbC1tZC04Iik7DQoNCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGluZm9zLmZpbmQoIi50YWdzIGEiKS50ZXh0QXJyYXkoKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmF1dGhvciA9IGNvbnRhaW5lci5zZWxlY3QoIi5maWMtdGl0bGUgc3Bhbltwcm9wZXJ0eT1uYW1lXSIpLnRleHQoKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmRlc2NyaXB0aW9uID0gY29udGFpbmVyLnNlbGVjdCgiLmRlc2NyaXB0aW9uIikuY2xlYW5Jbm5lckhUTUwoKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmNvbXBsZXRlZCA9IGNvbnRhaW5lci5zZWxlY3QoIi50YWdzIikuY2xvc2VzdCgiZGl2IikuZmluZCgic3BhbiIpLndoZXJlKHg9PiB4LmlubmVySFRNTCgpLmluZGV4T2YoIkNPTVBMRVRFRCIpICE9IC0xKS5oYXNFbGVtZW50cygpID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIg0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCIudGV4dC1jZW50ZXIgaW1nIikuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCIuZmljLXRpdGxlIGgxIikudGV4dChmYWxzZSksDQogICAgICAgICAgICBub3ZlbFJldmlld3MuZGVzY3JpcHRpb24sDQogICAgICAgICAgICBub3ZlbFVybCwNCiAgICAgICAgICAgIGNoYXB0ZXJzLA0KICAgICAgICAgICAgbm92ZWxSZXZpZXdzLA0KICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUsDQogICAgICAgICAgICB1bmRlZmluZWQsDQogICAgICAgICk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKT0+IHsNCiAgICAgICAgcmV0dXJuIHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgbmV3IGNsaWVudCgpLmdldEh0bWwodXJsKSkuc2VsZWN0KCIuY2hhcHRlci1jb250ZW50IikuY2xlYW5Jbm5lckhUTUwoKTsNCg0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5sYXRlc3Q9IGFzeW5jIChwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3QubGF0ZXN0VXJsLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuc2VsZWN0KCIuZmljdGlvbi1saXN0LWl0ZW0iKS5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbSgNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiaW1nIikuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoIi5maWN0aW9uLXRpdGxlIikudGV4dChmYWxzZSksDQogICAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoIi5maWN0aW9uLXRpdGxlIGEiKS5hdHRyKCJocmVmIikudXJsKCksDQogICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUpKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm4gcmV0dXJuT2JqZWN0Ow0KDQp9Ow==&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5zY3JpYmJsZWh1YiI7DQogICAgcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCiAgICByZXR1cm5PYmplY3QubmFtZSA9ICdTY3JpYmJsZUh1Yic7DQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdFVybCA9ICdodHRwczovL3d3dy5zY3JpYmJsZWh1Yi5jb20vP3BnPXtwfSc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL3d3dy5zY3JpYmJsZWh1Yi5jb20nOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hVcmwgPSAnaHR0cHM6Ly93d3cuc2NyaWJibGVodWIuY29tLz9zPXtxfSZwb3N0X3R5cGU9ZmljdGlvbnBvc3RzJzsNCiAgICByZXR1cm5PYmplY3QucGFuaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFBhZ2luYXRpb24gPSBmYWxzZTsNCiAgICByZXR1cm5PYmplY3QuaWNvbiA9ICdodHRwczovL3d3dy5zY3JpYmJsZWh1Yi5jb20vZmF2aWNvbi5pY28nOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5tdWx0aVNlbGVjdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnNvcnRUeXBlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDaGFwdGVycyBwZXIgV2VlaycsICJmcmVxdWVuY3kiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdEYXRlIEFkZGVkJywgImRhdGVhZGRlZCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0Zhdm9yaXRlcycsICJmYXZvcml0ZXMiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdMYXN0IFVwZGF0ZScsICJsYXN0Y2hwZGF0ZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ051bWJlciBvZiBSYXRpbmdzJywgIm51bW9mcmF0ZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1BhZ2VzJywgInBhZ2VzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUGFnZXZpZXdzJywgInBhZ2V2aWV3cyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1JhdGluZ3MnLCAicmF0aW5ncyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1JlYWRlcnMnLCAicmVhZGVycyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1RvdGFsIFdvcmRzJywgInRvdGFsd29yZHMiKSwNCiAgICAgICAgXSwNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IHRydWUsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkFjdGlvbiIsIDkpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkNvbWVkeSIsIDcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkZhbnRhc3kiLCAxOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGlzdG9yaWNhbCIsIDIxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJMaXRSUEciLCAxMTgwKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNeXN0ZXJ5IiwgOTA5KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTY2ktZmkiLCA5MTIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkFkdWx0IiwgOTAyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJEcmFtYSIsIDkwMyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR2VuZGVyIEJlbmRlciIsIDkwNSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSG9ycm9yIiwgMjIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1hcnRpYWwgQXJ0cyIsIDkwNyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUHN5Y2hvbG9naWNhbCIsIDkxMCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2VpbmVuIiwgOTEzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTdXBlcm5hdHVyYWwiLCA1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJBZHZlbnR1cmUiLCA4KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJFY2NoaSIsIDkwNCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR2lybHMgTG92ZSIsIDg5MiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSXNla2FpIiwgMzcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1hdHVyZSIsIDIwKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJSb21hbmNlIiwgNiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2xpY2Ugb2YgTGlmZSIsIDkxNCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVHJhZ2VkeSIsIDkwMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQm95cyBMb3ZlIiwgODkxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJGYW5maWN0aW9uIiwgMzgpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhhcmVtIiwgMTAxNSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSm9zZWkiLCA5MDYpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1lY2hhIiwgOTA4KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTY2hvb2wgTGlmZSIsIDkxMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU211dCIsIDkxNSksDQoNCiAgICAgICAgXQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zdGF0dXNlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJBbGwiLCAiYWxsIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQ29tcGxldGVkIiwgImNvbXBsZXRlZCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk9uZ29pbmciLCAib25nb2luZyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhpYXR1cyIsICJoaWF0dXMiKQ0KICAgICAgICBdDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldFNlY3Rpb25zID0gKGtleXMpID0+IHsNCiAgICAgICAgdmFyIHNlY3Rpb25zID0gWw0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImxhdGVzdCIsICJMYXRlc3QgVXBkYXRlIiwgIkxhdGVzdCIsIHRydWUpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oInBvcHVsYXIiLCAiUG9wdWxhciIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJwYWdldmlld3MiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiZmF2b3JpdGVzIiwgIkZhdm9yaXRlcyIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJmYXZvcml0ZXMiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiY29tcGxldGVkIiwgIkNvbXBsZXRlZCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCAiY29tcGxldGVkIikpDQogICAgICAgIF0NCg0KICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmlsdGVyKHggPT4gIWtleXMgfHwga2V5cy5pbmNsdWRlcyh4Lm5hbWUpKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QudHJhbnNsYXRlU2VjdGlvbiA9IGFzeW5jIChzZWN0aW9uLCBwYWdlKSA9PiB7DQogICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmxhdGVzdChwYWdlKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5zZWFyY2goc2VjdGlvbi5maWx0ZXIgfHwgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgcGFnZSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIgPSAoKSA9PiB7DQogICAgICAgIHZhciBmaWx0ZXIgPSBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgInBhZ2V2aWV3cyIsIHVuZGVmaW5lZCwgImFsbCIpOw0KICAgICAgICByZXR1cm4gZmlsdGVyOw0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSkgPT4gew0KICAgICAgICB2YXIgc29ydFR5cGVVcmkgPSAiaHR0cHM6Ly93d3cuc2NyaWJibGVodWIuY29tL3Nlcmllcy1maW5kZXIvP3NmPTEmZ2k9e2d9Jm1naT1hbmQmc29ydD17c29ydH0mb3JkZXI9ZGVzYyZjcD17c3RhdHVzfSZwZz0iICsgcGFnZTsNCiAgICAgICAgdmFyIHNvcnRUeXBlVXJsID0gc29ydFR5cGVVcmkucmVwbGFjZSgie2d9IiwgZmlsdGVyLmdlbnJlcy5qb2luKCIsIikpLnJlcGxhY2UoIntzb3J0fSIsIGZpbHRlci5zb3J0VHlwZSkucmVwbGFjZSgie3N0YXR1c30iLCBmaWx0ZXIuYWN0aXZlKTsNCg0KICAgICAgICB2YXIgdXJsID0gZmlsdGVyLnRpdGxlICYmIGZpbHRlci50aXRsZS5sZW5ndGggPiAwID8gcmV0dXJuT2JqZWN0LnNlYXJjaFVybC5yZXBsYWNlKCJ7cX0iLCBmaWx0ZXIudGl0bGUpIDogc29ydFR5cGVVcmw7DQoNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCIuc2VhcmNoX21haW5fYm94IikuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBMaWdodEl0ZW0oDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoImltZyIpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCIuc2VhcmNoX3RpdGxlIikudGV4dChmYWxzZSksDQogICAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoIi5zZWFyY2hfdGl0bGUgYSIpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVycyA9IGFzeW5jIChpZCkgPT4gew0KICAgICAgICBjb25zb2xlLmxvZygic3RyU0lEOiIgKyBpZCkNCiAgICAgICAgdmFyIGh0bWwgPSBhd2FpdCBIdHRwQ2xpZW50LnBvc3RGb3JtKCJodHRwczovL3d3dy5zY3JpYmJsZWh1Yi5jb20vd3AtYWRtaW4vYWRtaW4tYWpheC5waHAiLCB7DQogICAgICAgICAgICBhY3Rpb246ICJ3aV9nZXR0b2NjaHAiLA0KICAgICAgICAgICAgc3RyU0lEOiBwYXJzZUludChpZCksDQogICAgICAgICAgICBzdHJteXBvc3RpZDogMCwNCiAgICAgICAgICAgIHN0ckZpYzogInllcyINCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKEh0dHBDbGllbnQucGFyc2VIdG1sKGh0bWwpKS5maW5kKCJhIikubWFwKHggPT4gbmV3IENoYXB0ZXIoeC50ZXh0KGZhbHNlKSwgeC5hdHRyKCJocmVmIikudXJsKCkpKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Tm92ZWwgPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsKSk7DQogICAgICAgIHZhciBpZCA9IGNvbnRhaW5lci5zZWxlY3QoIiNteXBvc3RpZCIpLm5vZGVWYWx1ZSgpID8gY29udGFpbmVyLnNlbGVjdCgiI215cG9zdGlkIikubm9kZVZhbHVlKCkgOiBub3ZlbFVybC5zcGxpdCgiLyIpW25vdmVsVXJsLnNwbGl0KCIvIikuaW5kZXhPZigic2VyaWVzIikgKyAxXTsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gYXdhaXQgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXJzKGlkIHx8ICIiKTsNCiAgICAgICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAoLyIocmF0aW5nVmFsdWUpIjoiKChcXCJ8W14iXSkqKSIvLCAiaSIpDQogICAgICAgIHZhciByZXMgPSByZWcuZXhlYyhjb250YWluZXIuaW5uZXJIVE1MKCkpOw0KICAgICAgICB2YXIgcmF0ZSA9IGV2YWwoKHJlcyAmJiByZXMubGVuZ3RoID4gMCA/IChyZXMuZmluZEF0KDApIHx8ICIiKS5zcGxpdCgiOiIpLmxhc3QoKSB8fCAiIiA6ICIxIikpOw0KICAgICAgICB2YXIgbm92ZWxSZXZpZXdzID0gbmV3IE5vdmVsUmV2aWV3cygpOw0KICAgICAgICBub3ZlbFJldmlld3MuYXV0aG9yID0gY29udGFpbmVyLnNlbGVjdCgiW3Byb3BlcnR5PSdhdXRob3InXSAuYXV0aF9uYW1lX2ZpYyIpLnRleHQoZmFsc2UpOw0KICAgICAgICBub3ZlbFJldmlld3MuZ2VucmVzID0gY29udGFpbmVyLmZpbmQoIi53aV9maWNfZ2VucmUgYSIpLnRleHRBcnJheSgpOw0KICAgICAgICBub3ZlbFJldmlld3MudXZvdGVzID0gIlJhdGluZzoiICsgcGFyc2VJbnQocmF0ZSA/IHJhdGUgOiAiMSIpLnRvRml4ZWQoMCkgKyAiLzUiOw0KICAgICAgICBub3ZlbFJldmlld3MuY29tcGxldGVkID0gY29udGFpbmVyLnNlbGVjdCgiLndpZGdldF9maWNfc2ltaWxhciIpLnRleHQoZmFsc2UpLmluZGV4T2YoIkNvbXBsZXRlZCIpICE9IC0xID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIjsNCiAgICAgICAgcmV0dXJuIG5ldyBEZXRhbGlJdGVtKA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgiLm5vdmVsLWNvdmVyIGltZyIpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmZpY190aXRsZScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLndpX2ZpY19kZXNjJykuY2xlYW5Jbm5lckhUTUwoKSwNCiAgICAgICAgICAgIG5vdmVsVXJsLA0KICAgICAgICAgICAgY2hhcHRlcnMucmV2ZXJzZSgpLA0KICAgICAgICAgICAgbm92ZWxSZXZpZXdzLA0KICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUsDQogICAgICAgICAgICB1bmRlZmluZWQsDQogICAgICAgICk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IG5ldyBjbGllbnQoKS5nZXRIdG1sKHVybCkpLnNlbGVjdCgiLmNocF9yYXciKS5jbGVhbklubmVySFRNTCgpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5sYXRlc3QgPSBhc3luYyAocGFnZSkgPT4gew0KICAgICAgICB2YXIgdXJsID0gcmV0dXJuT2JqZWN0LmxhdGVzdFVybC5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwodXJsKSk7DQogICAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgICAgY29udGFpbmVyLnNlbGVjdCgiI21haW5fcmVsZWFzZXMgdGQiKS5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbSgNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiaW1nIikuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoIi5mcF90aXRsZSIpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICAgICIiLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCIuZnBfdGl0bGUiKS5hdHRyKCJocmVmIikudXJsKCksDQogICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUpKTsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCg0KfTs=&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS50YXByZWFkIjsNCiAgICByZXR1cm5PYmplY3QuZGV0YWxpSXRlbVR5cGUgPSBEZXRhbGlJdGVtVHlwZS5Ob3ZlbDsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyTGFuZ3VhZ2UgPSAiZW4iOw0KICAgIHJldHVybk9iamVjdC5uYW1lID0gJ1RhcFJlYWQnOw0KICAgIHJldHVybk9iamVjdC5sYXRlc3RVcmwgPSAnaHR0cHM6Ly93d3cudGFwcmVhZC5jb20vYWpheC9ib29rL2xhc3R1cGRhdGVsaXN0JzsNCiAgICByZXR1cm5PYmplY3QudXJsID0gJ2h0dHBzOi8vd3d3LnRhcHJlYWQuY29tLyc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL3d3dy50YXByZWFkLmNvbS9hamF4L3NlYXJjaC9zdG9yeSc7DQogICAgcmV0dXJuT2JqZWN0LnBhbmluYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hQYWdpbmF0aW9uID0gZmFsc2U7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly9zdGF0aWMudGFwcmVhZC5jb20vcGMvaW1hZ2VzL2Zhdmljb24uaWNvJzsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MgPSBuZXcgUGFyc2VyU2VhcmNoU2V0dGluZ3MoKTsNCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQWxsIiwgMCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiV3V4aWEmWGlhbnhpYSIsIDEpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkZhbnRhc3kiLCAyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJSb21hbmNlIiwgMyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTEdCVCsiLCA0MyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVXJiYW4iLCA0NCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR2FtZXMiLCA0NSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRWFzdGVybiIsIDQ2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIb3Jyb3ImVGhyaWxsZXIiLCA0NyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGlzdG9yaWNhbCIsIDc1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTY2ktRmkiLCA3NiksDQoNCiAgICAgICAgXQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJob3Jyb3IiLCAiSG9ycm9yJlRocmlsbGVyIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFs0N10pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJyb21hbmNlIiwgIlJvbWFuY2UiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIoWzNdKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiZmFudGFzeSIsICJGYW50YXN5IiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsyXSkpLA0KICAgICAgICBdDQoNCiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICB2YXIgZmlsdGVyID0gbmV3IEZpbHRlcigpOw0KICAgICAgICByZXR1cm4gZmlsdGVyOw0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0R2VucmUgPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSAiaHR0cHM6Ly93d3cudGFwcmVhZC5jb20vYWpheC9jYXRlZ29yeS9kZXRhaWwiOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIHZhciBkYXRhID0gYXdhaXQgSHR0cENsaWVudC5wb3N0Rm9ybSh1cmwsIHsgY2F0ZUlkOiBmaWx0ZXIuZ2VucmVzWzBdLCBwYWdlTm86IHBhZ2UgfSk7DQogICAgICAgIGlmIChkYXRhICYmIGRhdGEucmVzdWx0ICYmIGRhdGEucmVzdWx0LmJvb2tMaXN0KSB7DQogICAgICAgICAgICBkYXRhLnJlc3VsdC5ib29rTGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbShhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoYXdhaXQgcmV0dXJuT2JqZWN0LmdldE5vdmVsKGl0ZW0uYm9va0lkLCB0cnVlKSkuaW1hZ2UNCiAgICAgICAgICAgICAgICB9LCBpdGVtLmJvb2tOYW1lLCBpdGVtLmRlc2NyaXB0aW9uLCBpdGVtLmJvb2tJZCwgcmV0dXJuT2JqZWN0Lm5hbWUpKQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaCA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCiAgICAgICAgaWYgKGZpbHRlci5nZW5yZXMubGVuZ3RoID4gMCkNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QuZ2V0R2VucmUoZmlsdGVyLCBwYWdlKTsNCg0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIHZhciBkYXRhID0gYXdhaXQgSHR0cENsaWVudC5wb3N0Rm9ybShyZXR1cm5PYmplY3Quc2VhcmNoVXJsLCB7IHNlYXJjaFRleHQ6IGZpbHRlci50aXRsZSB8fCAiIiwgc3RvcnlUeXBlOiAxLCBwYWdlTm86IHBhZ2UgfSk7DQogICAgICAgIGlmIChkYXRhICYmIGRhdGEucmVzdWx0ICYmIGRhdGEucmVzdWx0LnN0b3J5TGlzdCkgew0KICAgICAgICAgICAgZGF0YS5yZXN1bHQuc3RvcnlMaXN0LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChhd2FpdCByZXR1cm5PYmplY3QuZ2V0Tm92ZWwoaXRlbS5zdG9yeUlkLCB0cnVlKSkuaW1hZ2UNCiAgICAgICAgICAgICAgICB9LCBpdGVtLnN0b3J5TmFtZSwgIiIsIGl0ZW0uc3RvcnlJZCwgcmV0dXJuT2JqZWN0Lm5hbWUpKQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVycyA9IGFzeW5jIChib29rSWQpID0+IHsNCiAgICAgICAgdmFyIGRhdGEgPSBhd2FpdCBIdHRwQ2xpZW50LnBvc3RGb3JtKCJodHRwczovL3d3dy50YXByZWFkLmNvbS9hamF4L2Jvb2svY29udGVudHMiLCB7IGJvb2tJZDogYm9va0lkIH0pOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGlmIChkYXRhICYmIGRhdGEucmVzdWx0ICYmIGRhdGEucmVzdWx0LmNoYXB0ZXJMaXN0KQ0KICAgICAgICAgICAgZGF0YS5yZXN1bHQuY2hhcHRlckxpc3QuZm9yRWFjaChpdGVtID0+IHsNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXcgQ2hhcHRlcihpdGVtLmNoYXB0ZXJOYW1lLCAoaXRlbS5ib29rSWQgKyAiLyIgKyBpdGVtLmNoYXB0ZXJJZCkudXJpKCJodHRwczovL3d3dy50YXByZWFkLmNvbS9hamF4L2Jvb2svY2hhcHRlciIpKSkNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQoNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Tm92ZWwgPSBhc3luYyAobm92ZWxVcmwsIGlnbm9yZWNoYXB0ZXJzKSA9PiB7DQogICAgICAgIG5vdmVsVXJsID0gcGFyc2VJbnQobm92ZWxVcmwpLnRvU3RyaW5nKCk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbChub3ZlbFVybC50b1N0cmluZygpLnVyaSgiaHR0cHM6Ly93d3cudGFwcmVhZC5jb20vYm9vay9kZXRhaWwvIiksIGlnbm9yZWNoYXB0ZXJzKSk7DQogICAgICAgIHZhciBjaGFwdGVycyA9ICFpZ25vcmVjaGFwdGVycyA/IGF3YWl0IHJldHVybk9iamVjdC5nZXRDaGFwdGVycyhub3ZlbFVybCkgOiBbXTsNCiAgICAgICAgdmFyIG5vdmVsUmV2aWV3cyA9IG5ldyBOb3ZlbFJldmlld3MoKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGNvbnRhaW5lci5maW5kKCIuYmFzZS1pbmZvIC5ib29rLWNhdGFsb2cgLnR4dCIpLnRleHRBcnJheSgpOw0KICAgICAgICBub3ZlbFJldmlld3MuYXV0aG9yID0gY29udGFpbmVyLnNlbGVjdCgiLmF1dGhvciAubmFtZSIpLnRleHQoZmFsc2UpOw0KICAgICAgICBub3ZlbFJldmlld3MudXZvdGVzID0gY29udGFpbmVyLnNlbGVjdCgiLnNjb3JlIikudGV4dCgpICsgIiAvIDUiOw0KICAgICAgICBub3ZlbFJldmlld3MuY29tcGxldGVkID0gY29udGFpbmVyLnNlbGVjdCgiLmJhc2UtaW5mbyAuYm9vay1zdGF0ZSAudHh0IikudGV4dChmYWxzZSkgPT09ICJDb21wbGV0ZWQiID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIjsNCiAgICAgICAgcmV0dXJuIG5ldyBEZXRhbGlJdGVtKA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmJvb2staW1nIGltZycpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmJvb2stbmFtZScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmRlc2MnKS5jbGVhbklubmVySFRNTCgpLA0KICAgICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgICBjaGFwdGVycywNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICAgICAgdW5kZWZpbmVkLA0KICAgICAgICApOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICB2YXIgdXJsQ29udGVudCA9IHVybC5zcGxpdCgiLyIpOw0KICAgICAgICB2YXIgYm9va0lkID0gdXJsQ29udGVudFt1cmxDb250ZW50Lmxlbmd0aCAtIDJdOw0KICAgICAgICB2YXIgY2hhcHRlcklkID0gdXJsQ29udGVudFt1cmxDb250ZW50Lmxlbmd0aCAtIDFdOw0KICAgICAgICBjb25zb2xlLmxvZygiYm9va0lkOiIgKyBib29rSWQpDQogICAgICAgIGNvbnNvbGUubG9nKCJjaGFwdGVySWQ6IiArIGNoYXB0ZXJJZCkNCiAgICAgICAgdmFyIGRhdGEgPSBhd2FpdCBuZXcgY2xpZW50KCkucG9zdEZvcm0oImh0dHBzOi8vd3d3LnRhcHJlYWQuY29tL2FqYXgvYm9vay9jaGFwdGVyIiwgeyBib29rSWQ6IGJvb2tJZCwgY2hhcHRlcklkOiBjaGFwdGVySWQgfSkNCiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5yZXN1bHQpDQogICAgICAgICAgICByZXR1cm4gZGF0YS5yZXN1bHQuY29udGVudDsNCiAgICAgICAgcmV0dXJuICJTb21ldGhpbmcgd2VudCB3cm9uZyI7DQoNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0ID0gYXN5bmMgKHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHVybCA9IHJldHVybk9iamVjdC5sYXRlc3RVcmw7DQogICAgICAgIHZhciBkYXRhID0gYXdhaXQgSHR0cENsaWVudC5wb3N0Rm9ybSh1cmwsIHsgYW1vdW10OiAwLCBwYWdlTm86IHBhZ2UgfSk7DQogICAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5yZXN1bHQgJiYgZGF0YS5yZXN1bHQpIHsNCiAgICAgICAgICAgIGRhdGEucmVzdWx0LmZvckVhY2goaXRlbSA9PiB7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbShhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoYXdhaXQgcmV0dXJuT2JqZWN0LmdldE5vdmVsKGl0ZW0uYm9va0lkLCB0cnVlKSkuaW1hZ2UNCiAgICAgICAgICAgICAgICB9LCBpdGVtLnRpdGxlLCAiIiwgaXRlbS5ib29rSWQsIHJldHVybk9iamVjdC5uYW1lKSkNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm4gcmV0dXJuT2JqZWN0Ow0KfTs=&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS53dXhpYXdvcmxkIjsNCiAgICByZXR1cm5PYmplY3QuZGV0YWxpSXRlbVR5cGUgPSBEZXRhbGlJdGVtVHlwZS5Ob3ZlbDsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyTGFuZ3VhZ2UgPSAiZW4iOw0KICAgIHJldHVybk9iamVjdC5uYW1lID0gJ1d1eGlhd29ybGQnOw0KICAgIHJldHVybk9iamVjdC5sYXRlc3RVcmwgPSAnaHR0cHM6Ly93d3cud3V4aWF3b3JsZC5jb20vdXBkYXRlcyc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL3d3dy53dXhpYXdvcmxkLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL3d3dy53dXhpYXdvcmxkLmNvbS9hcGkvbm92ZWxzL3NlYXJjaCc7DQogICAgcmV0dXJuT2JqZWN0LnBhbmluYXRpb24gPSBmYWxzZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly93d3cud3V4aWF3b3JsZC5jb20vZmF2aWNvbi0zMngzMi5wbmc/dj1qd0VrS1h3OFBZJzsNCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5tdWx0aVNlbGVjdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcyA9DQogICAgew0KICAgICAgbXVsdGlTZWxlY3Rpb246IHRydWUsDQogICAgICB2YWx1ZXM6IFsNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0FjdGlvbicpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQ2hlYXQgU3lzdGVtcycpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQ29va2luZycpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWxjaGVteScpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQ3JhZnRpbmcnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NvbWVkeScpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRmFudGFzeScpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnSGFyZW0nKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01hdHVyZScpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnS2luZ2RvbSBCdWlsZGluZycpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTW9kZXJuIFNldHRpbmcnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ015c3RlcnknKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1BvbGl0aWNhbCBJbnRyaWd1ZScpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUGV0cycpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUG9zdC1hcG9jYWx5cHRpYycpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUm9tYW5jZScpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRmVtYWxlIFByb3RhZ29uaXN0JyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTY2ktZmknKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1RocmlsbGVyJyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTdXBlcnBvd2VycycpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVHJhZ2VkeScpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVmlydHVhbCBSZWFsaXR5JyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdYaWFueGlhJyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdXdXhpYScpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWHVhbmh1YW4nKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0VzcG9ydHMnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0N1bHRpdmF0aW9uJyksDQogICAgICBdLA0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MubGFuZ3VhZ2VzID0NCiAgICB7DQogICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICB2YWx1ZXM6IFsNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0FueScpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQ2hpbmVzZScpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRW5nbGlzaCcpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnS29yZWFuJyksDQogICAgICBdLA0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3Muc3RhdHVzZXMgPQ0KICAgIHsNCiAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgIHZhbHVlczogWw0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQW55JywgbnVsbCksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdPbmdvaW5nJywgdHJ1ZSksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDb21wbGV0ZWQnLCBmYWxzZSksDQogICAgICBdLA0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3Muc29ydFR5cGVzID0NCiAgICB7DQogICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICB2YWx1ZXM6IFsNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ05hbWUnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1BvcHVsYXInKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NoYXB0ZXJzJyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdOZXcnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1JhdGluZycpLA0KICAgICAgXSwNCiAgICB9Ow0KDQoNCiAgICByZXR1cm5PYmplY3QuZ2V0U2VjdGlvbnMgPSAoa2V5cykgPT4gew0KICAgICAgICB2YXIgc2VjdGlvbnMgPSBbDQogICAgICAgICAgbmV3IFNlY3Rpb24oImxhdGVzdCIsICJMYXRlc3QgVXBkYXRlIiwgIkxhdGVzdCIsIHRydWUpLA0KICAgICAgICAgIG5ldyBTZWN0aW9uKCJuZXciLCAiTmV3IE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBIdHRwQ2xpZW50LmNsb25lSXRlbShyZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlcigpLCB7IHNvcnRUeXBlOiAiTmV3IiB9KSksDQogICAgICAgICAgbmV3IFNlY3Rpb24oInBvcHVsYXIiLCAiUG9wdWxhciBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgSHR0cENsaWVudC5jbG9uZUl0ZW0ocmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgeyBzb3J0VHlwZTogIlBvcHVsYXIiIH0pKSwNCiAgICAgICAgICBuZXcgU2VjdGlvbigiY29tcGxldGVkIiwgIkNvbXBsZXRlZCBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgSHR0cENsaWVudC5jbG9uZUl0ZW0ocmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgeyBhY3RpdmU6IGZhbHNlIH0pKQ0KICAgICAgICBdDQogICAgDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgICAgfQ0KICAgIA0KICAgICAgcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QubGF0ZXN0KHBhZ2UpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5zZWFyY2goc2VjdGlvbi5maWx0ZXIgfHwgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgcGFnZSk7DQogICAgICB9DQogICAgDQogICAgICByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlciA9ICgpID0+IHsNCiAgICAgICAgdmFyIGZpbHRlciA9IG5ldyBGaWx0ZXIoKTsNCiAgICAgICAgZmlsdGVyLmxhbmd1YWdlID0gcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmxhbmd1YWdlcy52YWx1ZXMuZmluZEF0KDApLnZhbHVlOw0KICAgICAgICBmaWx0ZXIuc29ydFR5cGUgPSByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3Muc29ydFR5cGVzLnZhbHVlcy5maW5kQXQoMCkudmFsdWU7DQogICAgICAgIGZpbHRlci5hY3RpdmUgPSByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3Muc3RhdHVzZXMudmFsdWVzLmZpbmRBdCgwKS52YWx1ZTsNCiAgICAgICAgcmV0dXJuIGZpbHRlcjsNCiAgICAgIH0NCiAgICANCiAgICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKT0+IHsNCiAgICAgICAgdmFyIGRhdGEgPSBhd2FpdCBIdHRwQ2xpZW50LnBvc3RKc29uKHJldHVybk9iamVjdC5zZWFyY2hVcmwsIGZpbHRlcik7DQogICAgICAgIHJldHVybiBkYXRhICYmIGRhdGEuaXRlbXMNCiAgICAgICAgICA/IGRhdGEuaXRlbXMuZmlsdGVyKCh4KSA9PiAheC5zbmVha1BlZWspLm1hcCgNCiAgICAgICAgICAgICh4KSA9Pg0KICAgICAgICAgICAgICBuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgIHguY292ZXJVcmwsDQogICAgICAgICAgICAgICAgeC5uYW1lLA0KICAgICAgICAgICAgICAgIHguc3lub3BzaXMsDQogICAgICAgICAgICAgICAgeC5zbHVnLnVyaSgnaHR0cHM6Ly93d3cud3V4aWF3b3JsZC5jb20vbm92ZWwvJyksIHJldHVybk9iamVjdC5uYW1lDQogICAgICAgICAgICAgICksDQogICAgICAgICAgKQ0KICAgICAgICAgIDogW107DQogICAgICB9DQogICAgDQogICAgICByZXR1cm5PYmplY3QuZ2V0Tm92ZWw9IGFzeW5jIChub3ZlbFVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwpKTsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcubm92ZWwtY29udGVudCAuY2hhcHRlci1pdGVtIGEnKS5mb3JFYWNoKCh4KSA9PiB7DQogICAgICAgICAgY2hhcHRlcnMucHVzaCgNCiAgICAgICAgICAgIG5ldyBDaGFwdGVyKA0KICAgICAgICAgICAgICB4LnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICB4LmF0dHIoImhyZWYiKS51cmwoKQ0KICAgICAgICAgICAgKSwNCiAgICAgICAgICApOw0KICAgICAgICB9KTsNCiAgICANCiAgICAgICAgdmFyIG5vdmVsUmV2aWV3cyA9IG5ldyBOb3ZlbFJldmlld3MoKTsNCiAgICANCiAgICAgICAgdmFyIG5vZGUgPSBjb250YWluZXIuc2VsZWN0KCIubm92ZWwtYm9keSIpOw0KICAgIA0KICAgICAgICBub3ZlbFJldmlld3MuZ2VucmVzID0gY29udGFpbmVyLmZpbmQoJy5nZW5yZXMgYScpLnRleHRBcnJheSgpOw0KICAgICAgICB2YXIgYXV0aG9yID0gbm9kZS5zZWxlY3QoImR0OmNvbnRhaW5zKEF1dGhvcikiKQ0KICAgICAgICBub3ZlbFJldmlld3MuYXV0aG9yID0gYXV0aG9yLmNsb3Nlc3QoImRpdiIpLmZpbmQoImRkIikudGV4dChmYWxzZSk7DQogICAgICAgIHJldHVybiBuZXcgRGV0YWxpSXRlbSgNCiAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcuaW1nLXRodW1ibmFpbCcpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy5ub3ZlbC1ib2R5IGgyJykudGV4dChmYWxzZSksDQogICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5ub3ZlbC1ib3R0b20gPmRpdicpLmVxKDEpLmNsZWFuSW5uZXJIVE1MKCksDQogICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgY2hhcHRlcnMsDQogICAgICAgICAgbm92ZWxSZXZpZXdzLA0KICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICApOw0KICAgICAgfQ0KICAgIA0KICAgICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXI9IGFzeW5jICh1cmwpID0+IHsNCiAgICAgICAgcmV0dXJuIHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgbmV3IGNsaWVudCgpLmdldEh0bWwodXJsKSkuc2VsZWN0KCcjY2hhcHRlci1jb250ZW50JykuY2xlYW5Jbm5lckhUTUwoKTsNCiAgICAgIH0NCiAgICANCiAgICAgIHJldHVybk9iamVjdC5sYXRlc3Q9IGFzeW5jIChwYWdlKSA9PnsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHJldHVybk9iamVjdC5sYXRlc3RVcmwpKTsNCiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5maW5kKCcuc2VjdGlvbi1jb250ZW50IC50aXRsZSBhJykubWFwKCh4KSA9PiB7DQogICAgICAgICAgcmV0dXJuIG5ldyBMaWdodEl0ZW0oYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgdmFyIGVsZW0gPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh4LmF0dHIoJ2hyZWYnKS51cmwoKSwgdHJ1ZSkpDQogICAgICAgICAgICByZXR1cm4gZWxlbS5zZWxlY3QoIi5pbWctdGh1bWJuYWlsIikuYXR0cigic3JjIikudXJsKCk7DQogICAgICAgICAgfSwgeC50ZXh0KGZhbHNlKSwgJycsIHguYXR0cignaHJlZicpLnVybCgpLCByZXR1cm5PYmplY3QubmFtZSk7DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCn07&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS53dXhpYXdvcmxkX3NpdGUiOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJMYW5ndWFnZSA9ICJlbiI7DQogICAgcmV0dXJuT2JqZWN0Lm5hbWUgPSAnV3V4aWF3b3JsZC5TaXRlJzsNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vd3V4aWF3b3JsZC5zaXRlL3BhZ2Uve3B9Lyc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL3d1eGlhd29ybGQuc2l0ZSc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL3d1eGlhd29ybGQuc2l0ZS93cC1hZG1pbi9hZG1pbi1hamF4LnBocCc7DQogICAgcmV0dXJuT2JqZWN0LnBhbmluYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hQYWdpbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3QuaWNvbiA9ICdodHRwczovL3d1eGlhd29ybGQuYi1jZG4ubmV0L3dwLWNvbnRlbnQvdXBsb2Fkcy8yMDE5LzA0L2Zhdmljb24tMS5pY28nOw0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzID0gbmV3IFBhcnNlclNlYXJjaFNldHRpbmdzKCk7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLm11bHRpU2VsZWN0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MuZ2VucmVzID0NCiAgICB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBY3Rpb24nLCAiYWN0aW9uIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWR1bHQnLCAiYWR1bHQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJEcmFtYSIsICJkcmFtYSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkVjY2hpIiwgImVjY2hpIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWR2ZW50dXJlJywgImFkdmVudHVyZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkdlbmRlciBCZW5kZXIiLCAiZ2VuZGVyLWJlbmRlciIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhpc3RvcmljYWwiLCAiaGlzdG9yaWNhbCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhvcnJvciIsICJob3Jyb3IiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJJc2VrYWkiLCAiaXNla2FpIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSm9zZWkiLCAiam9zZWkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJMR0JUKyIsICJsZ2J0IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWFnaWNhbCBSZWFsaXNtIiwgIm1hZ2ljYWwtcmVhbGlzbSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1hbmh3YSIsICJtYW5od2EiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNYXJ0aWFsIEFydHMiLCAibWFydGlhbC1hcnRzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWF0dXJlIiwgIm1hdHVyZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1lY2hhIiwgIm1lY2hhIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUHN5Y2hvbG9naWNhbCIsICJwc3ljaG9sb2dpY2FsIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUmVpbmNhcm5hdGlvbiIsICJyZWluY2FybmF0aW9uIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2Nob29sIExpZmUiLCAic2Nob29sLWxpZmUiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTZWluZW4iLCAic2VpbmVuIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2hvdWpvIiwgInNob3VqbyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNob3Vqby1BaSIsICJzaG91am8tYWkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTaG91bmVuIiwgInNob3VuZW4iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTaG91bmVuLUFpIiwgInNob3VuZW4tYWkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTbGljZSBvZiBMaWZlIiwgInNsaWNlLW9mLWxpZmUiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTbXV0IiwgInNtdXQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTdXBlcm5hdHVyYWwiLCAic3VwZXJuYXR1cmFsIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVGhyaWxsZXIiLCAidGhyaWxsZXIiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJUZWVuIiwgInRlZW4iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJWaWRlbyBHYW1lcyIsICJ2aWRlby1nYW1lcyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIldlYmNvbWljcyIsICJ3ZWJjb21pY3MiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDb21lZHknLCAiY29tZWR5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRmFudGFzeScsICJmYW50YXN5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnSGFyZW0nLCAiaGFyZW0tbm92ZWwiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdZYW9pJywgInlhb2kiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJZdXJpIiwgInl1cmkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdLaW5nZG9tIEJ1aWxkaW5nJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTW9kZXJuIFNldHRpbmcnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNeXN0ZXJ5JywgIm15c3RlcnkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdSb21hbmNlJywgInJvbWFuY2UiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTY2ktZmknLCAic2NpLWZpIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVHJhZ2VkeScsICJ0cmFnZWR5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVmlydHVhbCBSZWFsaXR5JyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWGlhbnhpYScsICJ4aWFueGlhIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnV3V4aWEnLCAid3V4aWEiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdYdWFuaHVhbicsICJ4dWFuaHVhbiIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1Nwb3J0cycsICJzcG9ydHMiKSwNCiAgICAgICAgXSwNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnN0YXR1c2VzID0NCiAgICB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnT25nb2luZycsICJvbi1nb2luZyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NvbXBsZXRlZCcsICJlbmQiKSwNCiAgICAgICAgXSwNCiAgICB9Ow0KDQoNCiAgICByZXR1cm5PYmplY3QuZ2V0U2VjdGlvbnMgPSAoa2V5cykgPT4gew0KICAgICAgICB2YXIgc2VjdGlvbnMgPSBbDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibGF0ZXN0IiwgIkxhdGVzdCBVcGRhdGUiLCAiTGF0ZXN0IiwgdHJ1ZSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibWFuZ2EiLCAiQ29taWNzIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsid2ViY29taWNzIl0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJhY3Rpb24iLCAiQWN0aW9uIE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsiYWN0aW9uIl0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJhZHVsdCIsICJBZHVsdCBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcihbImFkdWx0Il0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJyb21hbmNlIiwgIlJvbWFuY2UgTm92ZWwiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIoWyJyb21hbmNlIl0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJkcmFtYSIsICJEcmFtYSBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcihbImRyYW1hIl0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJjb21wbGV0ZWQiLCAiQ29tcGxldGVkIE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsICJlbmQiKSkNCiAgICAgICAgXQ0KDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC50cmFuc2xhdGVTZWN0aW9uID0gYXN5bmMgKHNlY3Rpb24sIHBhZ2UpID0+IHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpDQogICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5zZWFyY2goc2VjdGlvbi5maWx0ZXIgfHwgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgcGFnZSk7DQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcikNCiAgICAgICAgICAgIHJldHVybiBbXTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICByZXR1cm4gbmV3IEZpbHRlcigpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRUeXBlID0gKHVybCkgPT4gew0KICAgICAgICB2YXIgdXJsID0gdXJsLnRvTG93ZXJDYXNlKCk7DQogICAgICAgIGlmICh1cmwuaW5kZXhPZigibWFuZ2EiKSAhPSAtMSB8fCB1cmwuaW5kZXhPZigiY29taWMiKSAhPSAtMSB8fCB1cmwuaW5kZXhPZigiY29taWNzIikgIT0gLTEgfHwgdXJsLmluZGV4T2YoIndlYmNvbWljcyIpICE9IC0xKQ0KICAgICAgICAgICAgcmV0dXJuIERldGFsaUl0ZW1UeXBlLk1hbmFnYTsNCiAgICAgICAgcmV0dXJuIERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRCeUdlbnJlcyA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICB2YXIgYWR2YW5jZWRTZWFjaFVybCA9ICJodHRwczovL3d1eGlhd29ybGQuc2l0ZS9wYWdlLyIrcGFnZSsiLz9zPSZwb3N0X3R5cGU9d3AtbWFuZ2Eme2d9Jm9wJmF1dGhvciZhcnRpc3QmcmVsZWFzZSZhZHVsdCZ7c30iDQogICAgICAgIGlmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDApDQogICAgICAgICAgICBhZHZhbmNlZFNlYWNoVXJsID0gYWR2YW5jZWRTZWFjaFVybC5yZXBsYWNlKCJ7Z30iLCBmaWx0ZXIuZ2VucmVzLm1hcCh4ID0+ICJnZW5yZSU1QiU1RD0iICt4KS5qb2luKCImIikpDQogICAgICAgIGVsc2UgYWR2YW5jZWRTZWFjaFVybCA9IGFkdmFuY2VkU2VhY2hVcmwucmVwbGFjZSgiJntnfSIsICIiKQ0KDQogICAgICAgIGlmIChmaWx0ZXIuYWN0aXZlICYmIGZpbHRlci5hY3RpdmUgIT0gIiIpDQogICAgICAgICAgICBhZHZhbmNlZFNlYWNoVXJsID0gYWR2YW5jZWRTZWFjaFVybC5yZXBsYWNlKCJ7c30iLCBmaWx0ZXIuYWN0aXZlKTsNCiAgICAgICAgZWxzZSBhZHZhbmNlZFNlYWNoVXJsID0gYWR2YW5jZWRTZWFjaFVybC5yZXBsYWNlKCIme3N9IiwgIiIpOw0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwoYWR2YW5jZWRTZWFjaFVybCkpOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLmMtdGFicy1pdGVtX19jb250ZW50IikuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKA0KICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0oDQogICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCIudGFiLXRodW1iIGltZyIpLmF0dHIoInNyYyB8IHNyY3NldCIpLnVybCgpLA0KICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnRhYi10aHVtYiBhIikuYXR0cigidGl0bGUiKS50ZXh0KCksDQogICAgICAgICAgICAgICAgICAgICIiLA0KICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnRhYi10aHVtYiBhIikuYXR0cigiaHJlZiIpLnVybCgpLA0KICAgICAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0LmdldFR5cGUoeC5zZWxlY3QoIi50YWItdGh1bWIgYSIpLmF0dHIoImhyZWYiKS51cmwoKSkNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICApDQogICAgICAgIH0pDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQoNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoIWZpbHRlci50aXRsZSkNCiAgICAgICAgZmlsdGVyLnRpdGxlID0iIjsNCiAgICAgICAgaWYgKChmaWx0ZXIudGl0bGUuaXNFbXB0eU9yU3BhY2VzKCkpICYmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDAgfHwgKCFmaWx0ZXIuYWN0aXZlICYmIGZpbHRlci5hY3RpdmUgIT0gIiIpKSkNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QuZ2V0QnlHZW5yZXMoZmlsdGVyLCBwYWdlKTsNCg0KICAgICAgICBpZiAoZmlsdGVyLnRpdGxlLmlzRW1wdHlPclNwYWNlcygpKQ0KICAgICAgICAgICAgcmV0dXJuIFtdOw0KDQoNCiAgICAgICAgdmFyIGpzb24gPSBhd2FpdCBIdHRwQ2xpZW50LnBvc3RGb3JtKHJldHVybk9iamVjdC5zZWFyY2hVcmwsIHsgYWN0aW9uOiAid3AtbWFuZ2Etc2VhcmNoLW1hbmdhIiwgdGl0bGU6IGZpbHRlci50aXRsZSB9KTsNCg0KICAgICAgICBpZiAoanNvbiAmJiBqc29uLmRhdGEgJiYganNvbi5kYXRhLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHJldHVybiBqc29uLmRhdGEubWFwKHggPT4gew0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgICAgICBhc3luYyAoKSA9PiAoYXdhaXQgcmV0dXJuT2JqZWN0LmdldE5vdmVsKHgudXJsLnVyaShyZXR1cm5PYmplY3QudXJsKSwgdHJ1ZSkpLmltYWdlLA0KICAgICAgICAgICAgICAgICAgICB4LnRpdGxlLA0KICAgICAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICAgICAgeC51cmwudXJpKHJldHVybk9iamVjdC51cmwpLA0KICAgICAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0LmdldFR5cGUoeC50eXBlIHx8IHgudXJsKQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIFtdOw0KDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXJzID0gYXN5bmMgKGNvbnRhaW5lcikgPT4gew0KICAgICAgICB2YXIgdXJsID0gImh0dHBzOi8vd3V4aWF3b3JsZC5zaXRlL3dwLWFkbWluL2FkbWluLWFqYXgucGhwIjsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gY29udGFpbmVyLnNlbGVjdCgiLmxpc3RpbmctY2hhcHRlcnNfd3JhcCIpLmhhc0VsZW1lbnQoKSAmJiBjb250YWluZXIuZmluZCgiLmxpc3RpbmctY2hhcHRlcnNfd3JhcCBhIikubGVuZ3RoKCkgPiAxID8gY29udGFpbmVyLmZpbmQoIi5saXN0aW5nLWNoYXB0ZXJzX3dyYXAgYSIpIDogcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LnBvc3RGb3JtKHVybCwgeyBhY3Rpb246ICJtYW5nYV9nZXRfY2hhcHRlcnMiLCBtYW5nYTogY29udGFpbmVyLnNlbGVjdCgiLnJhdGluZy1wb3N0LWlkIikuYXR0cigidmFsdWUiKS50ZXh0KCkgfSkpLmZpbmQoImEiKTsNCiAgICAgICAgcmV0dXJuIGNoYXB0ZXJzLm1hcCgoeCkgPT4gew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGFwdGVyKA0KICAgICAgICAgICAgICAgIHgudGV4dChmYWxzZSksDQogICAgICAgICAgICAgICAgeC5hdHRyKCJocmVmIikudXJsKCkNCiAgICAgICAgICAgICk7DQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXROb3ZlbCA9IGFzeW5jIChub3ZlbFVybCwgaWdub3JlQ2hhcHRlcnMpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsLCBpZ25vcmVDaGFwdGVycykpOw0KICAgICAgICB2YXIgY2hhcHRlcnMgPSBbXTsNCiAgICAgICAgaWYgKCFpZ25vcmVDaGFwdGVycykgew0KICAgICAgICAgICAgY2hhcHRlcnMgPSBhd2FpdCByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlcnMoY29udGFpbmVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIGlmICghaWdub3JlQ2hhcHRlcnMpIHsNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cy51dm90ZXMgPSBjb250YWluZXIuc2VsZWN0KCIudm90ZS1kZXRhaWxzIikucmVtb3ZlKCdbcHJvcGVydHk9Iml0ZW1SZXZpZXdlZCJdJykudGV4dChmYWxzZSk7DQogICAgICAgICAgICBub3ZlbFJldmlld3MuYXV0aG9yID0gY29udGFpbmVyLmZpbmQoIi5hdXRob3ItY29udGVudCBhIikudGV4dChmYWxzZSk7DQogICAgICAgICAgICBub3ZlbFJldmlld3MuZ2VucmVzID0gY29udGFpbmVyLmZpbmQoIi5nZW5yZXMtY29udGVudCBhIikudGV4dEFycmF5KCk7DQogICAgICAgICAgICBub3ZlbFJldmlld3MuY29tcGxldGVkID0gY29udGFpbmVyLmZpbmQoIi5wb3N0LWNvbnRlbnRfaXRlbSIpLndoZXJlKHggPT4geC5pbm5lckhUTUwoKS5pbmRleE9mKCJDb21wbGV0ZWQiKSAhPSAtMSkuaGFzRWxlbWVudCgpID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIjsNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cy5kZXNjcmlwdGlvbiA9IGNvbnRhaW5lci5zZWxlY3QoIi5kZXNjcmlwdGlvbi1zdW1tYXJ5IikuY2xlYW5Jbm5lckhUTUwoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBuZXcgRGV0YWxpSXRlbSgNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy5zdW1tYXJ5X2ltYWdlIGltZycpLmF0dHIoInNyYyB8IHNyY3NldCIpLnVybCgpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLnBvc3QtdGl0bGUnKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cy5kZXNjcmlwdGlvbiB8fCAiIiwNCiAgICAgICAgICAgIG5vdmVsVXJsLA0KICAgICAgICAgICAgY2hhcHRlcnMucmV2ZXJzZSgpLA0KICAgICAgICAgICAgbm92ZWxSZXZpZXdzLA0KICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUsDQogICAgICAgICAgICAiIiwNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5nZXRUeXBlKG5vdmVsVXJsKQ0KICAgICAgICApOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBuZXcgY2xpZW50KCkuZ2V0SHRtbCh1cmwpKS5yZW1vdmUoInNjcmlwdCIpLnJlbW92ZSgic3R5bGUiKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9ICIiOw0KICAgICAgICBpZiAocmV0dXJuT2JqZWN0LmdldFR5cGUodXJsKSA9PT0gRGV0YWxpSXRlbVR5cGUuTWFuYWdhKQ0KICAgICAgICAgICAgcmVzdWx0ID0gY29udGFpbmVyLmZpbmQoIi5yZWFkaW5nLWNvbnRlbnQgaW1nIikubWFwKHggPT4geC5hdHRyKCJzcmMiKS5oYXNWYWx1ZSgpID8geC5hdHRyKCJzcmMiKS51cmwoKSA6ICIiKS5maWx0ZXIoeCA9PiAheC5pc0VtcHR5T3JTcGFjZXMoKSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJlc3VsdCA9IGNvbnRhaW5lci5zZWxlY3QoIi5yZWFkaW5nLWNvbnRlbnQiKS5jbGVhbklubmVySFRNTCgpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5sYXRlc3QgPSBhc3luYyAocGFnZSkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwocmV0dXJuT2JqZWN0LmxhdGVzdFVybC5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpKSk7DQoNCiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5maW5kKCIucGFnZS1pdGVtLWRldGFpbCIpLm1hcCh4ID0+IHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJpbWciKS5hdHRyKCJzcmMgfCBzcmNzZXQiKS51cmwoKSwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnBvc3QtdGl0bGUgYSIpLnRleHQoKSwNCiAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnBvc3QtdGl0bGUgYSIpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QuZ2V0VHlwZSh4LnNlbGVjdCgiLnBvc3QtdGl0bGUgYSIpLmF0dHIoImhyZWYiKS51cmwoKSkNCiAgICAgICAgICAgICkNCiAgICAgICAgfSkNCiAgICB9DQoNCg0KICAgIHJldHVybiByZXR1cm5PYmplY3Q7DQp9Ow==&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS56aW5ub3ZlbCI7DQogICAgcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCiAgICByZXR1cm5PYmplY3QubmFtZSA9ICdaaW5Ob3ZlbCc7DQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdFVybCA9ICdodHRwczovL3ppbm5vdmVsLmNvbS9wYWdlL3twfS8nOw0KICAgIHJldHVybk9iamVjdC51cmwgPSAnaHR0cHM6Ly96aW5ub3ZlbC5jb20vJzsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoVXJsID0gJyc7DQogICAgcmV0dXJuT2JqZWN0LnBhbmluYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hQYWdpbmF0aW9uID0gZmFsc2U7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly96aW5ub3ZlbC5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMjAvMDcvY3JvcHBlZC1VbnRpdGxlZC0yLTMyeDMyLmpwZyc7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzID0gbmV3IFBhcnNlclNlYXJjaFNldHRpbmdzKCk7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IHRydWUsDQogICAgICAgIHZhbHVlczogW10sDQogICAgfTsNCg0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnNvcnRUeXBlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IHRydWUsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ09uZ29pbmcnLCAnb24tZ29pbmcnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDb21wbGV0ZWQgTm92ZWwnLCAnZW5kJyksDQogICAgICAgIF0sDQogICAgfTsNCg0KDQogICAgcmV0dXJuT2JqZWN0LmxvYWRTZXR0aW5ncyA9IGFzeW5jICgpID0+IHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChyZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MuZ2VucmVzLnZhbHVlcy5sZW5ndGggPD0gMCkgew0KICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCgiaHR0cHM6Ly96aW5ub3ZlbC5jb20vP3M9JnBvc3RfdHlwZT13cC1tYW5nYSIpKQ0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCIjc2VhcmNoLWFkdmFuY2VkIC5jaGVja2JveC1ncm91cCAuY2hlY2tib3giKS5mb3JFYWNoKGEgPT4gew0KICAgICAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MuZ2VucmVzLnZhbHVlcy5wdXNoKG5ldyBsYWJlbFZhbHVlKGEuZmluZCgibGFiZWwiKS50ZXh0KCksIGEuZmluZCgiaW5wdXQiKS5hdHRyKCJ2YWx1ZSIpLnRleHQoKSkpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldFNlY3Rpb25zID0gKGtleXMpID0+IHsNCiAgICAgICAgdmFyIHNlY3Rpb25zID0gWw0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImxhdGVzdCIsICJMYXRlc3QgVXBkYXRlIiwgIkxhdGVzdCIsIHRydWUpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImFjdGlvbiIsICJBY3Rpb24gTm92ZWwiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIoWyJhY3Rpb24iXSkpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oInJvbWFuY2UiLCAiUm9tYW5jZSBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcihbInJvbWFuY2UiXSkpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oIm9uZ29pbmciLCAiT25nb2luZyBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJlbmQiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiY29tcGxldGVkIiwgIkNvbXBsZXRlZCBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJlbmQiKSkNCg0KICAgICAgICBdDQoNCiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQogICAgfQ0KDQogICAgdHJhbnNsYXRlU2VjdGlvbiA9IGFzeW5jIChzZWN0aW9uLCBwYWdlKSA9PiB7DQogICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmxhdGVzdChwYWdlKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5zZWFyY2goc2VjdGlvbi5maWx0ZXIgfHwgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgcGFnZSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIgPSAoKSA9PiB7DQogICAgICAgIHZhciBmaWx0ZXIgPSBuZXcgRmlsdGVyKCk7DQogICAgICAgIHJldHVybiBmaWx0ZXI7DQogICAgfQ0KICAgIC8vaHR0cHM6Ly96aW5ub3ZlbC5jb20vP3M9e3N9JnBvc3RfdHlwZT13cC1tYW5nYSZnZW5yZSU1QiU1RD1hY3Rpb24mZ2VucmUlNUIlNUQ9YWR2ZW50dXJlJm9wPSZhdXRob3I9JmFydGlzdD0mcmVsZWFzZT0mYWR1bHQ9JnN0YXR1cyU1QiU1RD1lbmQmc3RhdHVzJTVCJTVEPW9uLWdvaW5nDQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaCA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHVybCA9ICJodHRwczovL3ppbm5vdmVsLmNvbS8/cz0iICsoZmlsdGVyLnRpdGxlIHx8ICIiKSsiJnBvc3RfdHlwZT13cC1tYW5nYSZ7Z2VucmV9Jm9wPSZhdXRob3I9JmFydGlzdD0mcmVsZWFzZT0mYWR1bHQ9JntzdGF0dXN9Ig0KICAgICAgICBpZiAoZmlsdGVyLmdlbnJlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgie2dlbnJlfSIsIGZpbHRlci5nZW5yZXMubWFwKHggPT4gImdlbnJlJTVCJTVEPSIreCkuam9pbigiJiIpKTsNCiAgICAgICAgfSBlbHNlIHVybCA9IHVybC5yZXBsYWNlKCIme2dlbnJlfSIsICIiKTsNCg0KICAgICAgICBpZiAoZmlsdGVyLnNvcnRUeXBlICYmIGZpbHRlci5zb3J0VHlwZS5sZW5ndGggPiAxKQ0KICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIntzdGF0dXN9IiwgInN0YXR1cyU1QiU1RD0iICtmaWx0ZXIuc29ydFR5cGUpOw0KICAgICAgICBlbHNlIHVybCA9IHVybC5yZXBsYWNlKCIme3N0YXR1c30iLCAiIik7DQoNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW10NCiAgICAgICAgY29udGFpbmVyLmZpbmQoJy5jLXRhYnMtaXRlbSAucm93JykuZm9yRWFjaCgoeCkgPT4gew0KICAgICAgICAgICAgcmVzdWx0LnB1c2goDQogICAgICAgICAgICAgICAgbmV3IExpZ2h0SXRlbSh4LmZpbmQoImltZyIpLmF0dHIoImRhdGEtc3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCcucG9zdC10aXRsZSBhJykudGV4dChmYWxzZSksDQogICAgICAgICAgICAgICAgICAgICcnLA0KICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLnBvc3QtdGl0bGUgYScpLmF0dHIoImhyZWYiKS51cmwoKSwgcmV0dXJuT2JqZWN0Lm5hbWUNCiAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldE5vdmVsID0gYXN5bmMgKG5vdmVsVXJsKSA9PiB7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbChub3ZlbFVybCkpOw0KICAgICAgICB2YXIgY2hhcHRlcnMgPSBjb250YWluZXIuZmluZCgiLmxpc3RpbmctY2hhcHRlcnNfd3JhcCBsaSBhIikubWFwKHggPT4gbmV3IENoYXB0ZXIoeC50ZXh0KGZhbHNlKSwgeC5hdHRyKCJocmVmIikudXJsKCkpKS5yZXZlcnNlKCkNCiAgICAgICAgdmFyIG5vdmVsUmV2aWV3cyA9IG5ldyBOb3ZlbFJldmlld3MoKTsNCg0KICAgICAgICBub3ZlbFJldmlld3MuZ2VucmVzID0gY29udGFpbmVyLmZpbmQoIi5nZW5yZXMtY29udGVudCBhIikubWFwKHggPT4geC50ZXh0KGZhbHNlKSk7DQogICAgICAgIG5vdmVsUmV2aWV3cy5hdXRob3IgPSBjb250YWluZXIuZmluZCgiLmF1dGhvci1jb250ZW50IGEiKS5tYXAoeCA9PiB4LnRleHQoZmFsc2UpKS5qb2luKCIsICIpOw0KICAgICAgICBub3ZlbFJldmlld3MudXZvdGVzID0gY29udGFpbmVyLnNlbGVjdCgiLnBvc3QtcmF0aW5nIC50b3RhbF92b3RlcyIpLnRleHQoZmFsc2UpICsgIiAvIDUiOw0KICAgICAgICBub3ZlbFJldmlld3MuY29tcGxldGVkID0gY29udGFpbmVyLnNlbGVjdCgiLnBvc3Qtc3RhdHVzIC5wb3N0LWNvbnRlbnRfaXRlbSAuc3VtbWFyeS1jb250ZW50IikudGV4dChmYWxzZSkgPT09ICJDb21wbGV0ZWQiID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIjsNCg0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcuc3VtbWFyeV9pbWFnZSBpbWcnKS5hdHRyKCJkYXRhLXNyYyIpLnVybCgpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLnBvc3QtdGl0bGUnKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy5kZXNjcmlwdGlvbi1zdW1tYXJ5JykuY2xlYW5Jbm5lckhUTUwoKSwNCiAgICAgICAgICAgIG5vdmVsVXJsLA0KICAgICAgICAgICAgY2hhcHRlcnMsDQogICAgICAgICAgICBub3ZlbFJldmlld3MsDQogICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgIHVuZGVmaW5lZCwNCiAgICAgICAgKTsNCiAgICB9DQoNCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICByZXR1cm4gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBuZXcgY2xpZW50KCkuZ2V0SHRtbCh1cmwpKS5zZWxlY3QoJy5yZWFkaW5nLWNvbnRlbnQnKS5jbGVhbklubmVySFRNTCgpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5sYXRlc3QgPSBhc3luYyAocGFnZSkgPT4gew0KICAgICAgICB2YXIgdXJsID0gcmV0dXJuT2JqZWN0LmxhdGVzdFVybC5yZXBsYWNlKCd7cH0nLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwodXJsKSk7DQogICAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgICAgY29udGFpbmVyLmZpbmQoJy5wYWdlLWNvbnRlbnQtbGlzdGluZyAucGFnZS1pdGVtLWRldGFpbCcpLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgIGlmICh4LnNlbGVjdCgnaW1nJykuYXR0cigic3JjIikuaGFzVmFsdWUoKSkNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgNCiAgICAgICAgICAgICAgICAgICAgbmV3IExpZ2h0SXRlbSh4LmZpbmQoImltZyIpLmF0dHIoImRhdGEtc3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLnBvc3QtdGl0bGUgYScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICAgICAgICAgICAgJycsDQogICAgICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLnBvc3QtdGl0bGUgYScpLmF0dHIoImhyZWYiKS51cmwoKSwgcmV0dXJuT2JqZWN0Lm5hbWUNCiAgICAgICAgICAgICAgICAgICAgKSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCn07