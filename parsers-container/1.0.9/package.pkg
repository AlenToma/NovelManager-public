KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50KSA9PiB7DQogICAgdmFyIHJldHVybk9iamVjdCA9IHt9Ow0KICAgIHJldHVybk9iamVjdC5pZCA9ICIxLmFsbG5vdmVsIjsNCiAgICByZXR1cm5PYmplY3QuZGV0YWxpSXRlbVR5cGUgPSBEZXRhbGlJdGVtVHlwZS5Ob3ZlbDsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyTGFuZ3VhZ2UgPSAiZW4iOw0KICAgIHJldHVybk9iamVjdC5uYW1lID0gJ0FsbE5vdmVsJzsNCiAgICByZXR1cm5PYmplY3QuZGlzcGxheU5hbWUgPSByZXR1cm5PYmplY3QubmFtZTsNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vYWxsbm92ZWwubmV0Lyc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL2FsbG5vdmVsLm5ldC8nOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hVcmwgPSAnaHR0cHM6Ly9hbGxub3ZlbC5uZXQvc2VhcmNoLnBocD9rZXl3b3JkPXtxfSc7DQogICAgcmV0dXJuT2JqZWN0LnBhbmluYXRpb24gPSBmYWxzZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly9hbGxub3ZlbC5uZXQvbWVkaWEvZmF2aWNvbi5wbmcnOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJSb21hbmNlIiwgInJvbWFuY2UuaHRtbD9wYWdlPXtwfSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkFkdmVudHVyZSIsICJhZHZlbnR1cmUuaHRtbD9wYWdlPXtwfSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlRocmlsbGVyIiwgInRocmlsbGVyLmh0bWw/cGFnZT17cH0iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJGYW50YXN5IiwgImZhbnRhc3kuaHRtbD9wYWdlPXtwfSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIllvdW5nIEFkdWx0IiwgInlvdW5nLWFkdWx0Lmh0bWw/cGFnZT17cH0iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNeXN0ZXJ5IiwgIm15c3RlcnkuaHRtbD9wYWdlPXtwfSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhpc3RvcmljYWwiLCAiaGlzdG9yaWNhbC5odG1sP3BhZ2U9e3B9IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSG9ycm9yIiwgImhvcnJvci5odG1sP3BhZ2U9e3B9IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2NpZW5jZSBGaWN0aW9uIiwgInNjaWVuY2UtZmljdGlvbi5odG1sP3BhZ2U9e3B9IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSHVtb3JvdXMiLCAiaHVtb3JvdXMuaHRtbD9wYWdlPXtwfSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkNocmlzdGlhbiIsICJjaHJpc3RpYW4uaHRtbD9wYWdlPXtwfSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIldlc3Rlcm4iLCAid2VzdGVybi5odG1sP3BhZ2U9e3B9IikNCiAgICAgICAgXQ0KICAgIH0NCiAgICByZXR1cm5PYmplY3QuZ2V0U2VjdGlvbnMgPSAoa2V5cykgPT4gew0KICAgICAgICB2YXIgc2VjdGlvbnMgPSBbDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibGF0ZXN0IiwgIkxhdGVzdCBVcGRhdGUiLCAiTGF0ZXN0IiwgdHJ1ZSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigicm9tYW5jZSIsICJSb21hbmNlIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsicm9tYW5jZS5odG1sP3BhZ2U9e3B9Il0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJ5b3VuZy1hZHVsdCIsICJZb3VuZyBBZHVsdCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcihbInlvdW5nLWFkdWx0Lmh0bWw/cGFnZT17cH0iXSkpLA0KICAgICAgICBdDQoNCiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICB2YXIgZmlsdGVyID0gbmV3IEZpbHRlcigpOw0KICAgICAgICByZXR1cm4gZmlsdGVyOw0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoIWZpbHRlci50aXRsZSkNCiAgICAgICAgICAgIGZpbHRlci50aXRsZSA9ICIiOw0KICAgICAgICBpZiAoZmlsdGVyLmdlbnJlcy5sZW5ndGggPD0gMCAmJiBmaWx0ZXIudGl0bGUgPT0gIiIpDQogICAgICAgICAgICByZXR1cm4gW107DQogICAgICAgIHZhciB1cmwgPSBmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDAgPyBmaWx0ZXIuZ2VucmVzWzBdLnRvU3RyaW5nKCkudXJpKHJldHVybk9iamVjdC51cmwpLnJlcGxhY2UoIntwfSIsIHBhZ2UpIDogcmV0dXJuT2JqZWN0LnNlYXJjaFVybC5yZXBsYWNlKCJ7cX0iLCBmaWx0ZXIudGl0bGUpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW10NCiAgICAgICAgcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwodXJsKSkuZmluZCgiLmxpc3Qtbm92ZWwgYSIpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJpbWciKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnRpdGxlLWhvbWUtbm92ZWwiKS50ZXh0KCksDQogICAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgICAgeC5hdHRyKCJocmVmIikudXJsKCksDQogICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUpKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Tm92ZWwgPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCg0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwpKTsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gY29udGFpbmVyLmZpbmQoIi5saXN0LXBhZ2Utbm92ZWwgYSIpLm1hcCh4ID0+IG5ldyBDaGFwdGVyKHgudGV4dChmYWxzZSksIHguYXR0cigiaHJlZiIpLnVybCgpKSk7DQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIHZhciBpbmZvID0gY29udGFpbmVyLmZpbmQoIi5saXN0LWluZm8iKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGluZm8uZXEoMSkuZmluZCgiYSIpLnRleHRBcnJheSgpOw0KICAgICAgICBub3ZlbFJldmlld3MuYXV0aG9yID0gaW5mby5lcSgwKS5zZWxlY3QoImEiKS50ZXh0KGZhbHNlKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLnV2b3RlcyA9IGluZm8uZXEoMikuc2VsZWN0KCJzcGFuIikuaGFzRWxlbWVudCgpID8gaW5mby5lcSgyKS5zZWxlY3QoInNwYW4iKS50ZXh0KGZhbHNlKSArICIgVmlld3MiIDogIiI7DQogICAgICAgIHJldHVybiBuZXcgRGV0YWxpSXRlbSgNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoIi5yb3cgaW1nIikuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCIuZGV0YWlsLW5vdmVsIGgxIikudGV4dChmYWxzZSksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCIuZGVzLW5vdmVsIikuY2xlYW5Jbm5lckhUTUwoKSwNCiAgICAgICAgICAgIG5vdmVsVXJsLA0KICAgICAgICAgICAgY2hhcHRlcnMsDQogICAgICAgICAgICBub3ZlbFJldmlld3MsDQogICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgIHVuZGVmaW5lZCwNCiAgICAgICAgKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlciA9IGFzeW5jICh1cmwpID0+IHsNCiAgICAgICAgcmV0dXJuIHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgbmV3IGNsaWVudCgpLmdldEh0bWwodXJsKSkucmVtb3ZlKCIuYWQtY29udGFpbmVyIikuc2VsZWN0KCIuY29udGVudF9ub3ZlbCIpLmNsZWFuSW5uZXJIVE1MKCk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdCA9IGFzeW5jIChwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3QubGF0ZXN0VXJsLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLmxpc3Qtbm92ZWwgYSIpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJpbWciKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnRpdGxlLWhvbWUtbm92ZWwiKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICB4LmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIHJldHVybiByZXR1cm5PYmplY3Q7DQp9Ow==&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5ib3hub3ZlbCI7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCiAgICByZXR1cm5PYmplY3QubmFtZSA9ICdCb3hOb3ZlbCc7DQogICAgcmV0dXJuT2JqZWN0LmRpc3BsYXlOYW1lID0gcmV0dXJuT2JqZWN0Lm5hbWU7DQogICAgcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdFVybCA9ICdodHRwczovL2JveG5vdmVsLmNvbS9wYWdlL3twfSc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL2JveG5vdmVsLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICcnOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly9ib3hub3ZlbC5jb20vd3AtY29udGVudC91cGxvYWRzLzIwMTgvMDQvYm94LWljb24tMTUweDE1MC5wbmcnOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgXSwNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LmxvYWRTZXR0aW5ncyA9IGFzeW5jICgpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKCJodHRwczovL2JveG5vdmVsLmNvbS8/cz0mcG9zdF90eXBlPXdwLW1hbmdhIikpOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLmNoZWNrYm94LWdyb3VwIC5jaGVja2JveCIpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MuZ2VucmVzLnZhbHVlcy5wdXNoKG5ldyBsYWJlbFZhbHVlKHguc2VsZWN0KCJsYWJlbCIpLnRleHQoKSwgeC5zZWxlY3QoImlucHV0IikuYXR0cigidmFsdWUiKS50ZXh0KCkpKTsNCiAgICAgICAgfSkNCiAgICB9DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnNvcnRUeXBlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdMYXRlc3QgUmVsZWFzZSBOb3ZlbCcsICdsYXRlc3QnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdSZWxldmFuY2UnLCAnJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUmF0aW5nJywgJ3JhdGluZycpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1RyZW5kaW5nJywgJ3RyZW5kaW5nJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTW9zdCBWaWV3cycsICd2aWV3cycpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ05ldycsICduZXctbWFuZ2EnKSwNCiAgICAgICAgXSwNCiAgICB9Ow0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJuZXciLCAiTmV3IE5vdmVscyIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJuZXctbWFuZ2EiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiTW9zdCBWaWV3cyIsICJNb3N0IFZpZXdzIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgInZpZXdzIikpLA0KICAgICAgICBdDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgIH0NCiAgICByZXR1cm5PYmplY3QudHJhbnNsYXRlU2VjdGlvbiA9IGFzeW5jIChzZWN0aW9uLCBwYWdlKSA9PiB7DQogICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QubGF0ZXN0KHBhZ2UpOw0KICAgICAgICBlbHNlIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCiAgICByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlciA9ICgpID0+IHsNCiAgICAgICAgdmFyIGZpbHRlciA9IG5ldyBGaWx0ZXIoKTsNCiAgICAgICAgcmV0dXJuIGZpbHRlcjsNCiAgICB9Ow0KDQogICAgLy9odHRwczovL2JveG5vdmVsLmNvbS9wYWdlLzIvP3MmcG9zdF90eXBlPXdwLW1hbmdhJmdlbnJlJTVCMCU1RD1hY3Rpb24mZ2VucmUlNUIxJTVEPWFkdmVudHVyZSZvcCZhdXRob3ImYXJ0aXN0JnJlbGVhc2UmYWR1bHQmbV9vcmRlcmJ5PWxhdGVzdA0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSBgaHR0cHM6Ly9ib3hub3ZlbC5jb20vcGFnZS8ke3BhZ2V9Lz9zPSR7ZmlsdGVyLnRpdGxlIHx8ICIifSZwb3N0X3R5cGU9d3AtbWFuZ2Eme2dlbnJlfSZvcCZhdXRob3ImYXJ0aXN0JnJlbGVhc2UmYWR1bHQmbV9vcmRlcmJ5PSR7ZmlsdGVyLnNvcnRUeXBlIHx8ICIifWANCiAgICAgICAgaWYgKGZpbHRlci5nZW5yZXMgJiYgZmlsdGVyLmdlbnJlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgie2dlbnJlfSIsIGZpbHRlci5nZW5yZXMubWFwKHggPT4gImdlbnJlJTVCMCU1RD0iICsgeCkuam9pbigiJiIpKQ0KICAgICAgICB9IGVsc2UgdXJsID0gdXJsLnJlcGxhY2UoIiZ7Z2VucmV9IiwgIiIpDQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgnLnRhYi1jb250ZW50LXdyYXAgLmMtdGFicy1pdGVtIC50YWItdGh1bWIgYScpLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoJ2ltZycpLmF0dHIoInNyYyIpLnVybCgpLCB4LmF0dHIoInRpdGxlIikudGV4dCgpLCAnJywgeC5hdHRyKCJocmVmIikudXJsKCksIHJldHVybk9iamVjdC5uYW1lKSk7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCiAgICByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlcnMgPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHZhciBjaGFwdGVycyA9IFtdOw0KICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5wb3N0Rm9ybSgiYWpheC9jaGFwdGVycyIudXJpKG5vdmVsVXJsKSwge2tleTogInRlc3QifSkpOw0KICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5saXN0aW5nLWNoYXB0ZXJzX3dyYXAgYScpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICAgICAgY2hhcHRlcnMucHVzaChuZXcgQ2hhcHRlcih4LnRleHQoZmFsc2UpLCB4LmF0dHIoImhyZWYiKS51cmwoKSkpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICByZXR1cm4gY2hhcHRlcnMucmV2ZXJzZSgpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhlKQ0KICAgICAgICAgICAgdGhyb3cgZQ0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybk9iamVjdC5nZXROb3ZlbCA9IGFzeW5jIChub3ZlbFVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwpKTsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gYXdhaXQgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXJzKG5vdmVsVXJsKTsNCiAgICAgICAgdmFyIGl0ZW0gPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIGl0ZW0uZ2VucmVzID0gY29udGFpbmVyLmZpbmQoIi5nZW5yZXMtY29udGVudCBhIikudGV4dEFycmF5KCk7DQogICAgICAgIGl0ZW0uYXV0aG9yID0gY29udGFpbmVyLmZpbmQoIi5hdXRob3ItY29udGVudCBhIikudGV4dChmYWxzZSkNCiAgICAgICAgaXRlbS5jb21wbGV0ZWQgPSAiU3RhdHVzOiIgKyBjb250YWluZXIuZmluZCgiLnBvc3Qtc3RhdHVzIC5wb3N0LWNvbnRlbnRfaXRlbSIpLmxhc3QoKS5zZWxlY3QoIi5zdW1tYXJ5LWNvbnRlbnQiKS50ZXh0KGZhbHNlKQ0KICAgICAgICBpdGVtLnV2b3RlcyA9ICJSYXRpbmc6IiArIGNvbnRhaW5lci5zZWxlY3QoIi50b3RhbF92b3RlcyIpLnRleHQoZmFsc2UpICsgIi81IjsNCiAgICAgICAgcmV0dXJuIG5ldyBEZXRhbGlJdGVtKGNvbnRhaW5lci5zZWxlY3QoJy5zdW1tYXJ5X2ltYWdlIGltZycpLmF0dHIoInNyYyIpLnVybCgpLCBjb250YWluZXIuc2VsZWN0KCcucG9zdC10aXRsZSBoMScpLnRleHQoZmFsc2UpLCBjb250YWluZXIuc2VsZWN0KCcuc3VtbWFyeV9fY29udGVudCcpLmNsZWFuSW5uZXJIVE1MKCksIG5vdmVsVXJsLCBjaGFwdGVycywgaXRlbSwgcmV0dXJuT2JqZWN0Lm5hbWUsIHVuZGVmaW5lZCk7DQogICAgfQ0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICByZXR1cm4gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBuZXcgY2xpZW50KCkuZ2V0SHRtbCh1cmwpKS5zZWxlY3QoJy5yZWFkaW5nLWNvbnRlbnQnKS5jbGVhbklubmVySFRNTCgpOw0KICAgIH0NCiAgICByZXR1cm5PYmplY3QubGF0ZXN0ID0gYXN5bmMgKHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHVybCA9IHJldHVybk9iamVjdC5sYXRlc3RVcmwucmVwbGFjZSgne3B9JywgcGFnZS50b1N0cmluZygpKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcucGFnZS1saXN0aW5nLWl0ZW0gLnJvdycpLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoJ2ltZycpLmF0dHIoInNyYyIpLnVybCgpLCB4LnNlbGVjdCgnLnBvc3QtdGl0bGUgYScpLnRleHQoKSwgJycsIHguc2VsZWN0KCcucG9zdC10aXRsZSBhJykuYXR0cigiaHJlZiIpLnVybCgpLCByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCn07&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50KSA9PiB7DQogICAgdmFyIHJldHVybk9iamVjdCA9IHt9Ow0KICAgIHJldHVybk9iamVjdC5pZCA9ICIxLmNvbXJhZGVtYW8iOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIHJldHVybk9iamVjdC5uYW1lID0gJ0NvbXJhZGVtYW8nOw0KICAgIHJldHVybk9iamVjdC5kaXNwbGF5TmFtZSA9ICJHb29nbGUgVHJhbnNsYXRlZCBub3ZlbHMiOw0KICAgIHJldHVybk9iamVjdC5sYXRlc3RVcmwgPSAnaHR0cHM6Ly9jb21yYWRlbWFvLmNvbS9wYWdlL3twfS8nOw0KICAgIHJldHVybk9iamVjdC51cmwgPSAnaHR0cHM6Ly9jb21yYWRlbWFvLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL2NvbXJhZGVtYW8uY29tL3BhZ2Uve3B9Lz9zPXtxfSZwb3N0X3R5cGU9bm92ZWwnOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9zMi9mYXZpY29ucz9kb21haW49aHR0cHM6Ly9jb21yYWRlbWFvLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzID0gbmV3IFBhcnNlclNlYXJjaFNldHRpbmdzKCk7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MuZ2VucmVzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0FjdGlvbicpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NvbWVkeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0ZhbnRhc3knKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdIYXJlbScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01hdHVyZScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ015c3RlcnknKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdSb21hbmNlJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2NpLWZpJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVHJhZ2VkeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1hpYW54aWEnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdXdXhpYScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1h1YW5odWFuJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWR2ZW50dXJlJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU3VwZXJuYXR1cmFsJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRHJhbWEnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNYXJ0aWFsIEFydHMnLCAiTWFydGlhbC1BcnRzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2VpbmVuJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUHN5Y2hvbG9naWNhbCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1NsaWNlIG9mIExpZmUnLCAic2xpY2Utb2YtbGlmZSIpLA0KICAgICAgICBdLA0KICAgIH07DQoNCg0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnNvcnRUeXBlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDaGluZXNlJywgJ2NoaW5lc2UnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdKYXBhbmVzZScsICdqYXBhbmVzZScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0tvcmVhbicsICdrb3JlYW4nKSwNCiAgICAgICAgXSwNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnN0YXR1c2VzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkNvbXBsZXRlIiwgImNvbXBsZXRlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiT25Hb2luZyIsICJvbi1nb2luZyIpDQogICAgICAgIF0NCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0U2VjdGlvbnMgPSAoa2V5cykgPT4gew0KICAgICAgICB2YXIgc2VjdGlvbnMgPSBbDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibGF0ZXN0IiwgIkxhdGVzdCBVcGRhdGUiLCAiTGF0ZXN0IiwgdHJ1ZSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiY29tcGxldGVkIiwgIkNvbXBsZXRlZCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCAiY29tcGxldGUiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiY2hpbmVzZSIsICJDaGluZXNlIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgImNoaW5lc2UiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiamFwYW5lc2UiLCAiSmFwYW5lc2UiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAiamFwYW5lc2UiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigia29yZWFuIiwgIktvcmVhbiIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJrb3JlYW4iKSkNCiAgICAgICAgXQ0KDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC50cmFuc2xhdGVTZWN0aW9uID0gYXN5bmMgKHNlY3Rpb24sIHBhZ2UpID0+IHsNCiAgICAgICAgaWYgKHNlY3Rpb24uaWRlbnRpZmllciA9PSAiTGF0ZXN0IikNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QubGF0ZXN0KHBhZ2UpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LnNlYXJjaChzZWN0aW9uLmZpbHRlciB8fCByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlcigpLCBwYWdlKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlciA9ICgpID0+IHsNCiAgICAgICAgdmFyIGZpbHRlciA9IG5ldyBGaWx0ZXIoKTsNCiAgICAgICAgcmV0dXJuIGZpbHRlcjsNCiAgICB9DQoNCg0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciBzb3J0VHlwZVVyaSA9ICJodHRwczovL2NvbXJhZGVtYW8uY29tL210eXBlL3tzfS9wYWdlL3twfS8iDQogICAgICAgIHZhciBzb3J0VHlwZVVybCA9IHNvcnRUeXBlVXJpLnJlcGxhY2UoIntzfSIsIGZpbHRlci5zb3J0VHlwZSkucmVwbGFjZSgie3B9IiwgcGFnZS50b1N0cmluZygpKTsNCg0KICAgICAgICB2YXIgdXJsID0gZmlsdGVyLnNvcnRUeXBlICYmIGZpbHRlci5zb3J0VHlwZSAhPSAiIiA/IHNvcnRUeXBlVXJsIDogcmV0dXJuT2JqZWN0LnNlYXJjaFVybC5yZXBsYWNlKCd7cX0nLCBmaWx0ZXIudGl0bGUgfHwgIiIpLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIGlmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCAmJiBmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDApDQogICAgICAgICAgICB1cmwgPSAoImdlbnJlLyIgKyBmaWx0ZXIuZ2VucmVzWzBdICsgIi9wYWdlL3twfSIpLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSkudXJpKHJldHVybk9iamVjdC51cmwpOw0KICAgICAgICBlbHNlDQogICAgICAgIGlmIChmaWx0ZXIuYWN0aXZlICYmICghZmlsdGVyLnNvcnRUeXBlIHx8IGZpbHRlci5zb3J0VHlwZSA9PSAiIikpDQogICAgICAgICAgICB1cmwgPSAoInN0YXR1cy8iICsgZmlsdGVyLmFjdGl2ZSArICIvcGFnZS97cH0iKS5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpLnVyaShyZXR1cm5PYmplY3QudXJsKTsNCg0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwodXJsKSk7DQogICAgICAgIHZhciBteWJveCA9IGNvbnRhaW5lci5zZWxlY3QoIi5teWJveCIpLmhhc0VsZW1lbnQoKTsNCiAgICAgICAgdmFyIGl0ZW0gPSAhbXlib3ggPyBjb250YWluZXIuZmluZCgic2VjdGlvbiAuY29sdW1ucyIpIDogY29udGFpbmVyLmZpbmQoIi5teWJveCBsaSIpOw0KDQogICAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgICAgaXRlbS5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgdmFyIGEgPSBteWJveCA/IHguc2VsZWN0KCJoMyBhIikgOiB4LmZpbmQoImEiKS5sYXN0KCk7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJpbWciKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICBhLnRleHQoZmFsc2UpLCAiIiwNCiAgICAgICAgICAgICAgICBhLmF0dHIoImhyZWYiKS51cmwoKSwgcmV0dXJuT2JqZWN0Lm5hbWUpKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlcnMgPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHZhciByZXN1bHQgPSB7fTsNCiAgICAgICAgdmFyIHBhZ2UgPSAxOw0KDQogICAgICAgIHdoaWxlICh0cnVlKSB7DQoNCiAgICAgICAgICAgIHZhciBwVXJsID0gKCIvcGFnZS97cGFnZX0vIikudXJpKHVybCk7DQogICAgICAgICAgICB2YXIgaXRlbSA9IHJldHVybk9iamVjdC5wYXJzZXIucmVuZGVyQ291bnRlckNhbGxzKHBhZ2UsIHBVcmwpOw0KICAgICAgICAgICAgcGFnZSA9IGl0ZW0ucGFnZTsNCiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChpdGVtLnByb21pc2VzKTsNCiAgICAgICAgICAgIHZhciBicmVha0l0ID0gZmFsc2U7DQoNCiAgICAgICAgICAgIHZhbHVlcy5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgICAgIGlmICghYnJlYWtJdCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKHgpLmZpbmQoInRib2R5IHRyIHRoIGEiKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpdGVtcy5oYXNFbGVtZW50cygpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVha0l0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHRBID0gaXRlbXMucmVkdWNlKChhcnIsIHgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFyclt4LnRleHQoKSArIHguYXR0cigiaHJlZiIpLnVybCgpXSA9IG5ldyBDaGFwdGVyKHgudGV4dChmYWxzZSksIHguYXR0cigiaHJlZiIpLnVybCgpKTsNCiAgICAgICAgICAgICAgICAgICAgfSwge30pOw0KDQogICAgICAgICAgICAgICAgICAgIGlmIChyZXR1cm5PYmplY3QucGFyc2VyLnZhbGlkYXRlQ2hhcHRlcnMocmVzdWx0QSwgcmVzdWx0KSA9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtJdCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICBpZiAoYnJlYWtJdCkNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICB9DQogICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHJlc3VsdCk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldE5vdmVsID0gYXN5bmMgKG5vdmVsVXJsLCBiYXNpY0luZm8pID0+IHsNCg0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwsIGJhc2ljSW5mbykpOw0KICAgICAgICB2YXIgY2hhcHRlcnMgPSBiYXNpY0luZm8gPT09IHRydWUgPyBbXSA6IGF3YWl0IHJldHVybk9iamVjdC5nZXRDaGFwdGVycyhub3ZlbFVybCk7DQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIGlmICghYmFzaWNJbmZvKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHZhciBub2RlID0gY29udGFpbmVyLmZpbmQoIiNOb3ZlbEluZm8gPiBwIik7DQoNCiAgICAgICAgICAgICAgICBub3ZlbFJldmlld3MuZ2VucmVzID0gbm9kZS5lcSgxKS5maW5kKCJhIikubWFwKHggPT4geC50ZXh0KCkpOw0KICAgICAgICAgICAgICAgIG5vdmVsUmV2aWV3cy5hdXRob3IgPSBub2RlLmVxKDIpLnNlbGVjdCgiYSIpLnRleHQoKTsNCiAgICAgICAgICAgICAgICBub3ZlbFJldmlld3MuY29tcGxldGVkID0gbm9kZS5sYXN0KCkuc2VsZWN0KCJhIikudGV4dCgpID09PSAiQ29tcGxldGUiID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIjsNCiAgICAgICAgICAgICAgICBub3ZlbFJldmlld3MuYXV0aG9yVXJsID0gbm9kZS5lcSgyKS5zZWxlY3QoImEiKS5hdHRyKCJocmVmIikudGV4dCgpOw0KDQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcjTm92ZWxJbmZvIGltZycpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgndGl0bGUnKS50ZXh0KCkucmVwbGFjZSgiQ29tcmFkZSBNYW8iLCAiIikucmVwbGFjZSgiLSIsICIiKS50cmltKCksDQogICAgICAgICAgICBjb250YWluZXIuZmluZCgnI05vdmVsSW5mbyAuY29sdW1ucyAuY29sdW1uJykubGFzdCgpLmNsZWFuSW5uZXJIVE1MKCksDQogICAgICAgICAgICBub3ZlbFVybCwNCiAgICAgICAgICAgIGNoYXB0ZXJzLnJldmVyc2UoKSwNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICAgICAgdW5kZWZpbmVkLA0KICAgICAgICApDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IG5ldyBjbGllbnQoKS5nZXRIdG1sKHVybCkpLnNlbGVjdCgiI2NvbnRlbnQiKS5jbGVhbklubmVySFRNTCgpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5sYXRlc3QgPSBhc3luYyAocGFnZSkgPT4gew0KICAgICAgICB2YXIgdXJsID0gcmV0dXJuT2JqZWN0LmxhdGVzdFVybC5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwodXJsKSk7DQogICAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgICAgY29udGFpbmVyLmZpbmQoInRib2R5ID4gdHIgPiB0aDpmaXJzdC1jaGlsZCA+IGEiKS5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbShhc3luYyAoKSA9PiAoYXdhaXQgcmV0dXJuT2JqZWN0LmdldE5vdmVsKHguYXR0cigiaHJlZiIpLnVybCgpLCB0cnVlKSkuaW1hZ2UsDQogICAgICAgICAgICAgICAgeC50ZXh0KGZhbHNlKSwgIiIsIHguYXR0cigiaHJlZiIpLnVybCgpLCByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm4gcmV0dXJuT2JqZWN0Ow0KfTs=&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50KSA9PiB7DQogICAgY29uc3QgcmV0dXJuT2JqZWN0PSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5rb2xub3ZlbCI7DQogICAgcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImFyIjsNCiAgICByZXR1cm5PYmplY3QubmFtZSA9ICdLb2xOb3ZlbCc7DQogICAgcmV0dXJuT2JqZWN0LmRpc3BsYXlOYW1lID0gcmV0dXJuT2JqZWN0Lm5hbWU7DQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdFVybCA9ICdodHRwOi8va29sbm92ZWwuY29tL3Nlcmllcz9wYWdlPXtwfSZzdGF0dXM9JnR5cGU9Jm9yZGVyPXVwZGF0ZSc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICJodHRwczovL2tvbG5vdmVsLmNvbSI7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICJodHRwczovL2tvbG5vdmVsLmNvbS9zZXJpZXM/cGFnZT17cH0mb3JkZXI9IjsNCiAgICByZXR1cm5PYmplY3QucGFuaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFBhZ2luYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5pY29uID0gJ2h0dHBzOi8va29sbm92ZWwuY29tL3dwLWNvbnRlbnQvdXBsb2Fkcy8yMDE5LzA2L2Nyb3BwZWQt2KPZitmC2YjZhi0xLTEtMTUweDE1MC5wbmcnOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJXdXhpYSIsICd3dXhpYScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlhpYW54aWEiLCAieGlhbnhpYSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlhVQU5IVUFOIiwgInh1YW5odWFuIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2KPYtdmE2YrYqSIsICJvcmlnaW5hbCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItij2YPYtNmGIiwgImFjdGlvbiIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItil2KvYp9ix2KkiLCAiZXhjaXRlbWVudCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItil2YbYqtmC2KfZhCDYp9mE2Ykg2LnYp9mE2YUg2KPYrtixIiwgImlzZWthaSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItil2YrYqti02YoiLCAiZXRjaGkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLYp9mE2K7Zitin2YQg2KfZhNi52YTZhdmKIiwgInNjaS1maSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItio2YjZhNmK2LPZiiIsICJwb2xpY3kiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLYqtin2LHZitiu2YoiLCAiaGlzdG9yaWNhbCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItiq2YLZhdi1INi02K7YtdmK2KfYqiIsICJycGciKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLYrNix2YrZhdipIiwgImNyaW1lIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2KzZiNiz2YkiLCAiam9zZWkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLYrdix2YrZhSIsICJoYXJlbSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItit2YrYp9ipINmF2K/Ysdiz2YrYqSIsICJzY2hvb2wtbGlmZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItiu2KfYsdmC2Kkg2YTZhNi32KjZiti52KkiLCAic3VwZXJuYXR1cmFsIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2K7Zitin2YTZiiIsICJmYW50YXN5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2K/Ysdin2YXYpyIsICJkcmFtYSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItix2LnYqCIsICJob3Jyb3IiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLYsdmI2YXYp9mG2LPZiiIsICJyb21hbnRpYyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItiz2K3YsSIsICJtYWdpYyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItiz2YrZhtmGIiwgInNlbmVuIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2LTYsdmK2K3YqSDZhdmGINin2YTYrdmK2KfYqSIsICJzbGljZS1vZi1saWZlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2LTZiNmG2YrZhiIsICJzaG9uZW4iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLYtdmK2YbZiiIsICJjaGluZXNlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2LrZhdmI2LYiLCAibXlzdGVyaWVzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2YHZhtmI2YYg2KfZhNmC2KrYp9mEIiwgIm1hcnRpYWwtYXJ0cyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItmC2YjZiSDYrtin2LHZgtipIiwgInN1cGVycG93ZXIiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLZg9mI2LHZiiIsICJrb3JlYW4iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLZg9mI2YXZitiv2YkiLCAiY29tZWR5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2YXYo9iz2KfZiNmKIiwgInRyYWdlZHkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLZhdinINio2LnYryDYp9mE2YPYp9ix2KvYqSIsICJhZnRlci10aGUtZGlzYXN0ZXIiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLZhdi62KfZhdix2KkiLCAiYWR2ZW50dXJlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgi2YXZitmD2KciLCAibWVjaGFuaWNhbCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItmG2KfYttisIiwgIm1hdHVyZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoItmG2YHYs9mKIiwgInBzeWNob2xvZ2ljYWwiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCLZitin2KjYp9mG2YoiLCAiamFwYW5lc2UiKSwNCg0KDQogICAgICAgIF0sDQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zdGF0dXNlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IHRydWUsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ09uR29pbmcnLCAnb25nb2luZycpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hpYXR1cycsICdoaWF0dXMnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDb21wbGV0ZWQnLCAnY29tcGxldGVkJyksDQogICAgICAgIF0sDQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJjb21wbGV0ZWQiLCAiQ29tcGxldGVkIE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsICJjb21wbGV0ZWQiKSkNCiAgICAgICAgXQ0KDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC50cmFuc2xhdGVTZWN0aW9uID0gYXN5bmMgKHNlY3Rpb24sIHBhZ2UpID0+IHsNCiAgICAgICAgaWYgKHNlY3Rpb24uaWRlbnRpZmllciA9PSAiTGF0ZXN0IikNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QubGF0ZXN0KHBhZ2UpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LnNlYXJjaChzZWN0aW9uLmZpbHRlciB8fCByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlcigpLCBwYWdlKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlciA9ICgpID0+IHsNCiAgICAgICAgdmFyIGZpbHRlciA9IG5ldyBGaWx0ZXIoKTsNCiAgICAgICAgcmV0dXJuIGZpbHRlcjsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSkgPT4gew0KICAgICAgICB2YXIgdXJsID0gcmV0dXJuT2JqZWN0LnNlYXJjaFVybC5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICBpZiAoZmlsdGVyLnRpdGxlICYmICFmaWx0ZXIudGl0bGUuaXNFbXB0eU9yU3BhY2VzKCkpDQogICAgICAgICAgICB1cmwgKz0gIiZzPSIgKyBmaWx0ZXIudGl0bGU7DQogICAgICAgIGlmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDApDQogICAgICAgICAgICB1cmwgKz0gIiYiICsgZmlsdGVyLmdlbnJlcy5tYXAoeCA9PiAiZ2VucmVbXT0iICsgeCkuam9pbigiJiIpOw0KICAgICAgICBpZiAoZmlsdGVyLmFjdGl2ZSAmJiBmaWx0ZXIuYWN0aXZlLmxlbmd0aCA+IDApDQogICAgICAgICAgICB1cmwgKz0gIiZzdGF0dXM9IiArIGZpbHRlci5hY3RpdmU7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgnLmxpc3R1cGQgYScpLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgIGlmICh4LnNlbGVjdCgnaW1nJykuYXR0cigic3JjIikuaGFzVmFsdWUoKSkNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgNCiAgICAgICAgICAgICAgICAgICAgbmV3IExpZ2h0SXRlbSh4LnNlbGVjdCgnaW1nJykuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLm50aXRsZScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICAgICAgICAgICAgJycsDQogICAgICAgICAgICAgICAgICAgICAgICB4LmF0dHIoImhyZWYiKS51cmwoKSwgcmV0dXJuT2JqZWN0Lm5hbWUNCiAgICAgICAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXROb3ZlbCA9IGFzeW5jIChub3ZlbFVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwpKTsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gY29udGFpbmVyLmZpbmQoIi5lcGxpc3RlciBsaSBhIikubWFwKHggPT4gbmV3IENoYXB0ZXIoeC5zZWxlY3QoIi5lcGwtbnVtIikudGV4dChmYWxzZSkgKyAiICIgKyB4LnNlbGVjdCgiLmVwbC10aXRsZSIpLnRleHQoZmFsc2UpLCB4LmF0dHIoImhyZWYiKS51cmwoKSkpDQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIHZhciBpbmZvcyA9IGNvbnRhaW5lci5maW5kKCIubmluZm8iKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGNvbnRhaW5lci5maW5kKCIuZ2VueGVkIGEiKS5tYXAoeCA9PiB4LnRleHQoZmFsc2UpKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmF1dGhvciA9IGluZm9zLmVxKDApLmZpbmQoIi5pbmZvLWNvbnRlbnQgLnNwZSBzcGFuIikuZXEoMikuZmluZCgiYSIpLnRleHRBcnJheSgpLmpvaW4oIiwiKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLnV2b3RlcyA9IGNvbnRhaW5lci5zZWxlY3QoIi5yYXRpbmcgc3Ryb25nIikudGV4dCgpLm51bWJlcigpICsgIiAvIDEwIjsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmNvbXBsZXRlZCA9IGNvbnRhaW5lci5maW5kKCIuaW5mby1jb250ZW50IC5zcGUgc3BhbiIpLmVxKDApLnJlbW92ZSgiYiIpLnRleHQoZmFsc2UpID09PSAiQ29tcGxldGVkIiA/ICJTdGF0dXM6Q29tcGxldGVkIiA6ICJTdGF0dXM6T25nb2luZyI7DQoNCiAgICAgICAgcmV0dXJuIG5ldyBEZXRhbGlJdGVtKA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLnRodW1iIGltZycpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmVudHJ5LXRpdGxlJykudGV4dChmYWxzZSksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcuZW50cnktY29udGVudCcpLmNsZWFuSW5uZXJIVE1MKCksDQogICAgICAgICAgICBub3ZlbFVybCwNCiAgICAgICAgICAgIGNoYXB0ZXJzLnJldmVyc2UoKSwNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICAgICAgdW5kZWZpbmVkLA0KICAgICAgICApOw0KICAgIH0NCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IG5ldyBjbGllbnQoKS5nZXRIdG1sKHVybCkpLnNlbGVjdCgnLmVudHJ5LWNvbnRlbnQnKS5jbGVhbklubmVySFRNTCgpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5sYXRlc3QgPSBhc3luYyAocGFnZSkgPT4gew0KICAgICAgICB2YXIgdXJsID0gcmV0dXJuT2JqZWN0LmxhdGVzdFVybC5yZXBsYWNlKCd7cH0nLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICB2YXIgaHRtbCA9YXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCk7DQogICAgICAgIGNvbnNvbGUubG9nKGh0bWwpDQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGh0bWwpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcubGlzdHVwZCBhJykuZm9yRWFjaCgoeCkgPT4gew0KICAgICAgICAgICAgaWYgKHguc2VsZWN0KCdpbWcnKS5hdHRyKCJzcmMiKS5oYXNWYWx1ZSgpKQ0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKA0KICAgICAgICAgICAgICAgICAgICBuZXcgTGlnaHRJdGVtKHguc2VsZWN0KCdpbWcnKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCcubnRpdGxlJykudGV4dChmYWxzZSksDQogICAgICAgICAgICAgICAgICAgICAgICAnJywNCiAgICAgICAgICAgICAgICAgICAgICAgIHguYXR0cigiaHJlZiIpLnVybCgpLCByZXR1cm5PYmplY3QubmFtZQ0KICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCn07&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50KSA9PiB7DQogICAgY29uc3QgcmV0dXJuT2JqZWN0ID0ge307DQogICAgcmV0dXJuT2JqZWN0LmlkID0gIjEubGlnaHRub3ZlbHB1YiI7DQogICAgcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCiAgICByZXR1cm5PYmplY3QubmFtZSA9ICdMaWdodE5vdmVsUHViJzsNCiAgICByZXR1cm5PYmplY3QuZGlzcGxheU5hbWUgPSAiTGlnaHQtTm92ZWwiOw0KICAgIHJldHVybk9iamVjdC5sYXRlc3RVcmwgPSAnaHR0cHM6Ly93d3cubGlnaHRub3ZlbHB1Yi5jb20vYnJvd3NlL2FsbC91cGRhdGVkL2FsbC97cH0nOw0KICAgIHJldHVybk9iamVjdC51cmwgPSAnaHR0cHM6Ly93d3cubGlnaHRub3ZlbHB1Yi5jb20nOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hVcmwgPSAnaHR0cHM6Ly93d3cubGlnaHRub3ZlbHB1Yi5jb20vbG53c2VhcmNobGl2ZT9pbnB1dENvbnRlbnQ9e3F9JzsNCiAgICByZXR1cm5PYmplY3QucGFuaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFBhZ2luYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5pY29uID0gJ2h0dHBzOi8vc3RhdGljLmxpZ2h0bm92ZWxwdWIuY29tL2NvbnRlbnQvaW1nL2xpZ2h0bm92ZWxwdWIvYXBwbGUtdG91Y2gtaWNvbi5wbmcnOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5tdWx0aVNlbGVjdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IHRydWUsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkFjdGlvbiIsIDEpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkFkdWx0IiwgNDgpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkFkdmVudHVyZSIsIDIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkNvbWVkeSIsIDEyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJDb250ZW1wb3JhcnkgUm9tYW5jZSIsIDU5KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJEcmFtYSIsIDMpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkVhc3Rlcm4gRmFudGFzeSIsIDU4KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJFY2NoaSIsIDExKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJGYW50YXN5IiwgNCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRmFudGFzeSBSb21hbmNlIiwgNjApLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkdlbmRlciBCZW5kZXIiLCA1MiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGFyZW0iLCA1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIaXN0b3JpY2FsIiwgNDYpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhvcnJvciIsIDQ0KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJKb3NlaSIsIDIzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJMb2xpY29uIiwgNTEpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1hZ2ljYWwgUmVhbGlzbSIsIDU3KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNYXJ0aWFsIEFydHMiLCA2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNYXR1cmUiLCA3KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNZWNoYSIsIDQ1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNeXN0ZXJ5IiwgMTQpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlBzeWNob2xvZ2ljYWwiLCAxOCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUm9tYW5jZSIsIDgpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNjaG9vbCBMaWZlIiwgMjEpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNjaS1maSIsIDE5KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTZWluZW4iLCA0OSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2hvdWpvIiwgNDcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNob3VqbyBBaSIsIDYxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTaG91bmVuIiwgNDMpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNob3VuZW4gQWkiLCA1MyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2xpY2Ugb2YgTGlmZSIsIDEzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTbXV0IiwgNTYpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNwb3J0cyIsIDUwKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTdXBlcm5hdHVyYWwiLCAxNiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVHJhZ2VkeSIsIDkpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlZpZGVvIEdhbWVzIiwgNTUpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIld1eGlhIiwgNDIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlhpYW54aWEiLCAyMCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiWHVhbmh1YW4iLCAxMCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiWWFvaSIsIDU0KQ0KICAgICAgICBdDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnN0YXR1c2VzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogdHJ1ZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQ29tcGxldGVkIiwgMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiT25nb2luZyIsIDIpLA0KICAgICAgICBdDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmxhbmd1YWdlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IHRydWUsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkNoaW5lc2UgTm92ZWwiLCA0KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJLb3JlYW4gTm92ZWwiLCA1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJMaWdodCBOb3ZlbCIsIDYpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkxpZ2h0IE5vdmVsIChKUCkiLCA5KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJMaWdodCBOb3ZlbCAoS1IpIiwgMTApLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlB1Ymxpc2hlZCBOb3ZlbCAoQ04pIiwgMTEpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlB1Ymxpc2hlZCBOb3ZlbCAoS1IpIiwgOCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiV2ViIE5vdmVsIiwgNyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiV2ViIE5vdmVsIChDTikiLCAxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJXZWIgTm92ZWwgKEpQKSIsIDMpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIldlYiBOb3ZlbCAoS1IpIiwgMikNCiAgICAgICAgXQ0KICAgIH0NCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldFNlY3Rpb25zID0gKGtleXMpID0+IHsNCiAgICAgICAgdmFyIHNlY3Rpb25zID0gWw0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImxhdGVzdCIsICJMYXRlc3QgVXBkYXRlIiwgIkxhdGVzdCIsIHRydWUpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oInJvbWFuY2UiLCAiUm9tYW5jZSIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcihbOF0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJhY3Rpb24iLCAiQWN0aW9uIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsxXSkpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oIm15c3RlcnkiLCAiTXlzdGVyeSIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcihbMTRdKSksDQogICAgICAgIF0NCg0KICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmlsdGVyKHggPT4gIWtleXMgfHwga2V5cy5pbmNsdWRlcyh4Lm5hbWUpKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QudHJhbnNsYXRlU2VjdGlvbiA9IGFzeW5jIChzZWN0aW9uLCBwYWdlKSA9PiB7DQogICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmxhdGVzdChwYWdlKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5zZWFyY2goc2VjdGlvbi5maWx0ZXIgfHwgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgcGFnZSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIgPSAoKSA9PiB7DQogICAgICAgcmV0dXJuIG5ldyBGaWx0ZXIoKTsNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LmdldEdlbnJlcyA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHVybCA9ICJodHRwczovL3d3dy5saWdodG5vdmVscHViLmNvbS9zZWFyY2hhZHY/Y3RnY29uPWFuZCZ0YWdjb249YW5kJnJhdGNvbj1taW4mcmF0aW5nPTAmc29ydD1zZGF0ZSZwYWdlTm89IiArIHBhZ2U7DQogICAgICAgIGlmIChmaWx0ZXIuYWN0aXZlKQ0KICAgICAgICAgICAgdXJsID0gdXJsICsgIiZzdGF0dXM9IiArIGZpbHRlci5hY3RpdmU7DQogICAgICAgIGlmIChmaWx0ZXIubGFuZ3VhZ2UgJiYgZmlsdGVyLmxhbmd1YWdlICE9ICIiKQ0KICAgICAgICAgICAgdXJsID0gdXJsICsgIiZnZW5yZXR5cGVzPSIgKyBmaWx0ZXIubGFuZ3VhZ2U7DQoNCiAgICAgICAgaWYgKGZpbHRlci5nZW5yZXMubGVuZ3RoID4gMCkNCiAgICAgICAgICAgIHVybCA9IHVybCArICImY2F0ZWdvcmllcz0iICsgZmlsdGVyLmdlbnJlcy5qb2luKCIlMkMiKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCIubm92ZWwtaXRlbSIpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKHguc2VsZWN0KCJpbWciKS5hdHRyKCJkYXRhLXNyYyB8IHNyYyIpLnVybCgpLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCIubm92ZWwtdGl0bGUgYSIpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICAgICIiLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCIubm92ZWwtdGl0bGUgYSIpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIGlmICghZmlsdGVyLnRpdGxlKQ0KICAgICAgICAgICAgZmlsdGVyLnRpdGxlID0gIiI7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3Quc2VhcmNoVXJsLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSkucmVwbGFjZSgie3F9IiwgZmlsdGVyLnRpdGxlKTsNCiAgICAgICAgaWYgKGZpbHRlci5nZW5yZXMubGVuZ3RoID4gMCB8fCBmaWx0ZXIubGFuZ3VhZ2UgIT0gIiIgfHwgZmlsdGVyLmFjdGl2ZSkNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QuZ2V0R2VucmVzKGZpbHRlciwgcGFnZSk7DQogICAgICAgIHZhciBjb250YWluZXIgPSBhd2FpdCBIdHRwQ2xpZW50LkdldEpzb24odXJsKTsNCiAgICAgICAgdmFyIGh0bWwgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGNvbnRhaW5lci5yZXN1bHR2aWV3LnRvSHRtbCgpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBodG1sLmZpbmQoIi5ub3ZlbC1pdGVtIikuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoImltZyIpLmF0dHIoImRhdGEtc3JjIHwgc3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoIi5ub3ZlbC10aXRsZSIpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICAgICIiLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJhIikuYXR0cigiaHJlZiIpLnVybCgpLA0KICAgICAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lKSk7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXJzID0gYXN5bmMgKG5vdmVsVXJsKSA9PiB7DQogICAgICAgIHZhciBwYWdlID0gMTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IHt9Ow0KICAgICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICAgICAgdmFyIHVybCA9IG5vdmVsVXJsICsgIi9wYWdlLXtwYWdlfSI7DQogICAgICAgICAgICB2YXIgaXRlbSA9IHJldHVybk9iamVjdC5wYXJzZXIucmVuZGVyQ291bnRlckNhbGxzKHBhZ2UsIHVybCk7DQogICAgICAgICAgICBwYWdlID0gaXRlbS5wYWdlOw0KICAgICAgICAgICAgdmFyIHZhbHVlcyA9IGF3YWl0IFByb21pc2UuYWxsKGl0ZW0ucHJvbWlzZXMpOw0KICAgICAgICAgICAgdmFyIGJyZWFrSXQgPSBmYWxzZTsNCg0KICAgICAgICAgICAgdmFsdWVzLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICAgICAgaWYgKCFicmVha0l0KSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoeCkuZmluZCgiLmNoYXB0ZXItbGlzdCBhIik7DQogICAgICAgICAgICAgICAgICAgIGlmICghaXRlbXMuaGFzRWxlbWVudHMoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtJdCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0QSA9IGl0ZW1zLnJlZHVjZSgoYXJyLCB4KSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBhcnJbeC5hdHRyKCJ0aXRsZSIpLnRleHQoKSArIHguYXR0cigiaHJlZiIpLnVybCgpXSA9IG5ldyBDaGFwdGVyKHguYXR0cigidGl0bGUiKS50ZXh0KCksIHguYXR0cigiaHJlZiIpLnVybCgpKTsNCiAgICAgICAgICAgICAgICAgICAgfSwge30pOw0KDQogICAgICAgICAgICAgICAgICAgIGlmIChyZXR1cm5PYmplY3QucGFyc2VyLnZhbGlkYXRlQ2hhcHRlcnMocmVzdWx0QSwgcmVzdWx0KSA9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtJdCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0pDQoNCiAgICAgICAgICAgIGlmIChicmVha0l0KQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMocmVzdWx0KTsNCg0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXROb3ZlbCA9IGFzeW5jIChub3ZlbFVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwpKTsNCiAgICAgICAgdmFyIGNoYXB0ZXJVcmwgPSBjb250YWluZXIuc2VsZWN0KCIuY2hhcHRlci1sYXRlc3QtY29udGFpbmVyIikuYXR0cigiaHJlZiIpLnVybCgpOw0KICAgICAgICBpZiAoIWNoYXB0ZXJVcmwgfHwgY2hhcHRlclVybCA9PSAiIikNCiAgICAgICAgICAgIGNoYXB0ZXJVcmwgPSBub3ZlbFVybDsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gYXdhaXQgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXJzKGNoYXB0ZXJVcmwpOw0KICAgICAgICB2YXIgbm92ZWxSZXZpZXdzID0gbmV3IE5vdmVsUmV2aWV3cygpOw0KICAgICAgICB2YXIgaW5mbyA9IGNvbnRhaW5lci5zZWxlY3QoIi5ub3ZlbC1pbmZvIik7DQogICAgICAgIG5vdmVsUmV2aWV3cy5nZW5yZXMgPSBpbmZvLmZpbmQoIi5jYXRlZ29yaWVzIGEiKS50ZXh0QXJyYXkoKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmF1dGhvciA9IGluZm8uc2VsZWN0KCIuYXV0aG9yIGEiKS50ZXh0KGZhbHNlKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLnV2b3RlcyA9ICJSYXRpbmc6IiArIGNvbnRhaW5lci5zZWxlY3QoIi5yYXRpbmctc3RhciBzdHJvbmciKS50ZXh0KGZhbHNlKSArICIvNSI7DQogICAgICAgIG5vdmVsUmV2aWV3cy5kZXNjcmlwdGlvbiA9IGNvbnRhaW5lci5zZWxlY3QoIiNpbmZvIC5zdW1tYXJ5IikuY2xlYW5Jbm5lckhUTUwoKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmNvbXBsZXRlZCA9IGluZm8udGV4dChmYWxzZSkgPT09ICJDb21wbGV0ZWQiID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIjsNCg0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCIuY292ZXIgaW1nIikuYXR0cigiZGF0YS1zcmMgfCBzcmMiKS51cmwoKSwNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoIi5ub3ZlbC10aXRsZSIpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgbm92ZWxSZXZpZXdzLmRlc2NyaXB0aW9uLA0KICAgICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgICBjaGFwdGVycywNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICAgICAgdW5kZWZpbmVkLA0KICAgICAgICApDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IG5ldyBjbGllbnQoKS5nZXRIdG1sKHVybCkpLnNlbGVjdCgiI2NoYXB0ZXItY29udGFpbmVyIikuY2xlYW5Jbm5lckhUTUwoKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0ID0gYXN5bmMgKHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHVybCA9IHJldHVybk9iamVjdC5sYXRlc3RVcmwucmVwbGFjZSgie3B9IiwgcGFnZS50b1N0cmluZygpKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCIubm92ZWwtaXRlbSIpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKHguc2VsZWN0KCIubm92ZWwtY292ZXIgaW1nIikuYXR0cigiZGF0YS1zcmMgfCBzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLm5vdmVsLXRpdGxlIikudGV4dCgpLA0KICAgICAgICAgICAgICAgICIiLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCIuY292ZXItd3JhcCBhIikuYXR0cigiaHJlZiIpLnVybCgpLA0KICAgICAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lKSk7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIHJldHVybiByZXR1cm5PYmplY3Q7DQoNCn07&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5tYW5nYW5lbG8iOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk1hbmFnYTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyTGFuZ3VhZ2UgPSAiZW4iOw0KICAgIHJldHVybk9iamVjdC5uYW1lID0gJ01hbmdhbkVsbyc7DQogICAgcmV0dXJuT2JqZWN0LmRpc3BsYXlOYW1lID0gIk1hbmdhLVNlY3RvciI7DQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdFVybCA9ICdodHRwczovL21hbmdhbmVsby5jb20vZ2VucmUtYWxsL3twfSc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL21hbmdhbmVsby5jb20vJzsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoVXJsID0gJ2h0dHBzOi8vbWFuZ2FuZWxvLmNvbS9hZHZhbmNlZF9zZWFyY2g/cz1hbGwmcGFnZT17cH0nOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly9tYW5nYW5lbG8uY29tL2Zhdmljb24ucG5nJzsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MgPSBuZXcgUGFyc2VyU2VhcmNoU2V0dGluZ3MoKTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MubXVsdGlTZWxlY3Rpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWN0aW9uJywgMiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWR1bHQnLCAzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBZHZlbnR1cmUnLCA0KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDb21lZHknLCA2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDb29raW5nJywgNyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRG91amluc2hpJywgOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRHJhbWEnLCAxMCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRWNjaGknLCAxMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRmFudGFzeScsIDEyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdHZW5kZXIgYmVuZGVyJywgMTMpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hhcmVtJywgMTQpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hpc3RvcmljYWwnLCAxNSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnSG9ycm9yJywgMTYpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0lzZWthaScsIDQ1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdKb3NlaScsIDE3KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNYW5odWEnLCA0NCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTWFuaHdhJywgNDMpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01hcnRpYWwgYXJ0cycsIDE5KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNYXR1cmUnLCAyMCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTWVjaGEnLCAyMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTWVkaWNhbCcsIDIyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNeXN0ZXJ5JywgMjQpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ09uZSBzaG90JywgMjUpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1BzeWNob2xvZ2ljYWwnLCAyNiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUm9tYW5jZScsIDI3KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTY2hvb2wgbGlmZScsIDI4KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTY2kgZmknLCAyOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2VpbmVuJywgMzApLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1Nob3VqbycsIDMxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTaG91am8gYWknLCAzMiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2hvdW5lbicsIDMzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTaG91bmVuIGFpJywgMzQpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1NsaWNlIG9mIGxpZmUnLCAzNSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU211dCcsIDM2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTcG9ydHMnLCAzNyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU3VwZXJuYXR1cmFsJywgMzgpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1RyYWdlZHknLCAzOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnV2VidG9vbnMnLCA0MCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWWFvaScsIDQxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdZdXJpJywgNDIpLA0KICAgICAgICBdLA0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3Muc29ydFR5cGVzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0xhdGVzdCBSZWxlYXNlJywgJycpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ05ld2VzdCcsICduZXdlc3QnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdUb3AgdmlldycsICd0b3B2aWV3JyksDQogICAgICAgIF0sDQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zdGF0dXNlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJDb21wbGV0ZWQiLCAiY29tcGxldGVkIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgib25nb2luZyIsICJvbmdvaW5nIikNCiAgICAgICAgXQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJob3QiLCAiTmV3ZXN0IiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgIm5ld2VzdCIpKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJjb21wbGV0ZWQiLCAiQ29tcGxldGVkIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsICJjb21wbGV0ZWQiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigicG9wdWxhciIsICJNb3N0IFBvcHVsYXIiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAidG9wdmlldyIpKQ0KICAgICAgICBdDQoNCiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICB2YXIgZmlsdGVyID0gbmV3IEZpbHRlcigpOw0KICAgICAgICByZXR1cm4gZmlsdGVyOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3Quc2VhcmNoVXJsLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIGlmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDApDQogICAgICAgICAgICB1cmwgPSAoIiZnX2k9XyIgKyBmaWx0ZXIuZ2VucmVzLmpvaW4oIl8iKSkudXJpKHVybCk7DQogICAgICAgIGlmIChmaWx0ZXIuc29ydFR5cGUgJiYgZmlsdGVyLnNvcnRUeXBlICE9ICIiKQ0KICAgICAgICAgICAgdXJsID0gKCImb3JieT0iICsgZmlsdGVyLnNvcnRUeXBlKS51cmkodXJsKTsNCiAgICAgICAgaWYgKGZpbHRlci5hY3RpdmUgJiYgZmlsdGVyLmFjdGl2ZSAhPSAiIikNCiAgICAgICAgICAgIHVybCA9ICgiJnN0cz0iICsgZmlsdGVyLmFjdGl2ZSkudXJpKHVybCk7DQogICAgICAgIGlmIChmaWx0ZXIudGl0bGUgJiYgZmlsdGVyLnRpdGxlLnRyaW0oKS5sZW5ndGggPiAwKQ0KICAgICAgICAgICAgdXJsID0gKCIma2V5dz0iICsgZmlsdGVyLnRpdGxlLnJlcGxhY2UoL1sgXS9nLCAiXyIpKS51cmkodXJsKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcuY29udGVudC1nZW5yZXMtaXRlbScpLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgIGlmICh4LnNlbGVjdCgnLmdlbnJlcy1pdGVtLWltZyBpbWcnKS5hdHRyKCJzcmMiKS5oYXNWYWx1ZSgpKQ0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKA0KICAgICAgICAgICAgICAgICAgICBuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgICAgICAgICAgeC5zZWxlY3QoJy5nZW5yZXMtaXRlbS1pbWcgaW1nJykuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLmdlbnJlcy1pdGVtLWltZycpLmF0dHIoInRpdGxlIikudGV4dCgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgJycsDQogICAgICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLmdlbnJlcy1pdGVtLWltZycpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lDQogICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldE5vdmVsID0gYXN5bmMgKG5vdmVsVXJsKSA9PiB7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbChub3ZlbFVybCkpOw0KDQogICAgICAgIHZhciBpdGVtID0gbmV3IE5vdmVsUmV2aWV3cygpOw0KICAgICAgICB2YXIgdGJJbmZvID0gY29udGFpbmVyLmZpbmQoIi52YXJpYXRpb25zLXRhYmxlSW5mbyB0ciIpDQogICAgICAgIGlmICh0YkluZm8ubGVuZ3RoKCkgPiAzKQ0KICAgICAgICAgICAgaXRlbS5nZW5yZXMgPSB0YkluZm8uZXEoMykuZmluZCgiLnRhYmxlLXZhbHVlIGEiKS5tYXAoeCA9PiB4LnRleHQoZmFsc2UpKTsNCiAgICAgICAgZWxzZSBpZiAodGJJbmZvLmxlbmd0aCgpID09IDMpDQogICAgICAgICAgICBpdGVtLmdlbnJlcyA9IHRiSW5mby5lcSgyKS5maW5kKCIudGFibGUtdmFsdWUgYSIpLm1hcCh4ID0+IHgudGV4dChmYWxzZSkpOw0KICAgICAgICBpdGVtLmRlc2NyaXB0aW9uID0gY29udGFpbmVyLnNlbGVjdCgiLnBhbmVsLXN0b3J5LWluZm8tZGVzY3JpcHRpb24iKS50ZXh0KGZhbHNlKQ0KDQogICAgICAgIGl0ZW0udXZvdGVzID0gY29udGFpbmVyLnNlbGVjdCgiZW1bdHlwZW9mPSd2OlJhdGluZyddIikudGV4dChmYWxzZSkucmVtb3ZlTmV3TGluZSgiICIpOw0KICAgICAgICBpdGVtLmFsdGVybmF0aXZlTmFtZXMgPSB0YkluZm8ubGVuZ3RoKCkgPiAzID8gdGJJbmZvLmVxKDApLnNlbGVjdCgiI2VkaXRhc3NvY2lhdGVkIikudGV4dChmYWxzZSkgOiAiIjsNCiAgICAgICAgaWYgKHRiSW5mby5sZW5ndGgoKSA+IDMpDQogICAgICAgICAgICBpdGVtLmF1dGhvciA9IHRiSW5mby5lcSgxKS5zZWxlY3QoIi50YWJsZS12YWx1ZSIpLnRleHQoZmFsc2UpOw0KICAgICAgICBlbHNlIGlmICh0YkluZm8ubGVuZ3RoKCkgPiAwKQ0KICAgICAgICAgICAgaXRlbS5hdXRob3IgPSB0YkluZm8uZXEoMCkuc2VsZWN0KCIudGFibGUtdmFsdWUiKS50ZXh0KGZhbHNlKTsNCiAgICAgICAgaXRlbS5sYW5nID0gIiI7DQogICAgICAgIGlmICh0YkluZm8ubGVuZ3RoKCkgPiAzKQ0KICAgICAgICAgICAgaXRlbS5jb21wbGV0ZWQgPSB0YkluZm8uZXEoMikudGV4dChmYWxzZSkucmVtb3ZlTmV3TGluZSgiICIpOw0KICAgICAgICBlbHNlIGlmICh0YkluZm8ubGVuZ3RoKCkgPT0gMykNCiAgICAgICAgICAgIGl0ZW0uY29tcGxldGVkID0gdGJJbmZvLmVxKDEpLnRleHQoZmFsc2UpLnJlbW92ZU5ld0xpbmUoIiAiKTsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gY29udGFpbmVyLmZpbmQoIi5yb3ctY29udGVudC1jaGFwdGVyIGEiKS5tYXAoeCA9PiBuZXcgQ2hhcHRlcih4LnRleHQoZmFsc2UpLCB4LmF0dHIoImhyZWYiKS51cmwoKSkpOw0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcuaW5mby1pbWFnZSBpbWcnKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy5zdG9yeS1pbmZvLXJpZ2h0IGgxJykudGV4dChmYWxzZSksDQogICAgICAgICAgICBpdGVtLmRlc2NyaXB0aW9uLA0KICAgICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgICBjaGFwdGVycy5yZXZlcnNlKCksDQogICAgICAgICAgICBpdGVtLA0KICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUsDQogICAgICAgICAgICB1bmRlZmluZWQsDQogICAgICAgICk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IG5ldyBjbGllbnQoKS5nZXRIdG1sKHVybCkpLmZpbmQoIi5jb250YWluZXItY2hhcHRlci1yZWFkZXIgaW1nIikubWFwKHggPT4geC5hdHRyKCJzcmMiKS51cmwoKSkuZmlsdGVyKHggPT4geCAmJiB4ICE9ICIiKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0ID0gYXN5bmMgKHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHVybCA9IHJldHVybk9iamVjdC5sYXRlc3RVcmwucmVwbGFjZSgne3B9JywgcGFnZS50b1N0cmluZygpKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcuY29udGVudC1nZW5yZXMtaXRlbScpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICBpZiAoeC5zZWxlY3QoJy5nZW5yZXMtaXRlbS1pbWcgaW1nJykuYXR0cigic3JjIikuaGFzVmFsdWUoKSkNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgNCiAgICAgICAgICAgICAgICAgICAgbmV3IExpZ2h0SXRlbSgNCiAgICAgICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCIuZ2VucmVzLWl0ZW0taW1nIGltZyIpLmF0dHIoInNyYyIpLnRleHQoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCIuZ2VucmVzLWl0ZW0taW1nIikuYXR0cigidGl0bGUiKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICcnLA0KICAgICAgICAgICAgICAgICAgICAgICAgeC5zZWxlY3QoJy5nZW5yZXMtaXRlbS1pbWcnKS5hdHRyKCJocmVmIikudXJsKCksDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZQ0KICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCn07&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50KSA9PiB7DQogICAgY29uc3QgcmV0dXJuT2JqZWN0ID0ge307DQogICAgcmV0dXJuT2JqZWN0LmlkID0gIjEubXRsbm92ZWwiOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJMYW5ndWFnZSA9ICJlbiI7DQogICAgcmV0dXJuT2JqZWN0Lm5hbWUgPSAnTXRsTm92ZWwnOw0KICAgIHJldHVybk9iamVjdC5kaXNwbGF5TmFtZSA9IHJldHVybk9iamVjdC5uYW1lOw0KICAgIHJldHVybk9iamVjdC5sYXRlc3RVcmwgPSAnaHR0cHM6Ly93d3cubXRsbm92ZWwuY29tL3dwLWFkbWluL2FkbWluLWFqYXgucGhwP2FjdGlvbj1yY250X3VwZGF0ZSZ2aWV3X2FsbD15ZXMmbW9yZUl0ZW1zUGFnZUluZGV4PXtwfSZfX2FtcF9zb3VyY2Vfb3JpZ2luPWh0dHBzJTNBJTJGJTJGd3d3Lm10bG5vdmVsLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL3d3dy5tdGxub3ZlbC5jb20nOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hVcmwgPSAnaHR0cHM6Ly93d3cubXRsbm92ZWwuY29tL3dwLWFkbWluL2FkbWluLWFqYXgucGhwP2FjdGlvbj1hdXRvc3VnZ2VzdCZxPXtxfSZtb3JlSXRlbXNQYWdlSW5kZXg9e3B9Jl9fYW1wX3NvdXJjZV9vcmlnaW49aHR0cHMlM0ElMkYlMkZ3d3cubXRsbm92ZWwuY29tJzsNCiAgICByZXR1cm5PYmplY3QucGFuaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFBhZ2luYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5pY29uID0gJ2h0dHBzOi8vd3d3Lm10bG5vdmVsLm5ldC90aGVtZXMvbXRsbm92ZWwvaW1hZ2VzL210bG5vdmVsLTMyLmljbyc7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzID0gbmV3IFBhcnNlclNlYXJjaFNldHRpbmdzKCk7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLm11bHRpU2VsZWN0aW9uID0gZmFsc2U7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBY3Rpb24nKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBZHVsdCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NvbWVkeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0FkdmVudHVyZScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0RyYW1hJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRWNjaGknKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdFcmNpeXVhbicpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0Zhbi1GaWN0aW9uJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRmFudGFzeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0dhbWUnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdHZW5kZXIgQmVuZGVyJywgImdlbmRlci1iZW5kZXIiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdIYXJlbScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hpc3RvcmljYWwnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdIb3Jyb3InKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdKb3NlaScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01hcnRpYWwgQXJ0cycsICJtYXJ0aWFsLWFydHMiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNYXR1cmUnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNZWNoYScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01pbGl0YXJ5JyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTXlzdGVyeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1BzeWNob2xvZ2ljYWwnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdSb21hbmNlJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2Nob29sIExpZmUnLCAnc2Nob29sLWxpZmUnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTY2ktZmknKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTZWluZW4nKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTaG91am8nKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTaG91am8gQWknLCAic2hvdWpvLWFpIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2hvdW5lbicpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1Nob3VuZW4gQWknLCAic2hvdW5lbi1haSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1NsaWNlIG9mIExpZmUnLCAic2xpY2Utb2YtbGlmZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1NtdXQnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTcG9ydHMnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTdXBlcm5hdHVyYWwnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdUcmFnZWR5JyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVHdvLWRpbWVuc2lvbmFsJywgInR3by1kaW1lbnNpb25hbC1ub3ZlbCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1VyYmFuIExpZmUnLCAidXJiYW4tZmljdGlvbiIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1d1eGlhJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWGlhbnhpYScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1h1YW5odWFuJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWWFvaScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1l1cmknKSwNCg0KICAgICAgICBdLA0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3Muc3RhdHVzZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQ29tcGxldGVkJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRHJvcHBlZCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hpYXR1cycpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0luY29tcGxldGUnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdPbmdvaW5nJyksDQogICAgICAgIF0sDQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJjb21wbGV0ZWQiLCAiQ29tcGxldGVkIE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsICJjb21wbGV0ZWQiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigib25nb2luZyIsICJPbmdvaW5nIE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsICJvbmdvaW5nIikpLA0KICAgICAgICBdDQoNCiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICB2YXIgZmlsdGVyID0gbmV3IEZpbHRlcigpOw0KICAgICAgICByZXR1cm4gZmlsdGVyOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRCeUdlbnJlcyA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgdmFyIGdlbnJlVXJsID0gImdlbnJlL3tnfS9wYWdlL3twfS8iLnVyaShyZXR1cm5PYmplY3QudXJsKS5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgdmFyIHN0YXR1c1VybCA9ICJzdGF0dXMve3N9L3BhZ2Uve3B9LyIudXJpKHJldHVybk9iamVjdC51cmwpLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgICAgICB2YXIgcSA9DQogICAgICAgICAgICAgICAgZmlsdGVyLmdlbnJlcy5sZW5ndGggPiAwID8NCiAgICAgICAgICAgICAgICBnZW5yZVVybC5yZXBsYWNlKCJ7Z30iLCBmaWx0ZXIuZ2VucmVzWzBdLnRvTG93ZXJDYXNlKCkpIDoNCiAgICAgICAgICAgICAgICBmaWx0ZXIuYWN0aXZlICYmIGZpbHRlci5hY3RpdmUgIT0gJycgPw0KICAgICAgICAgICAgICAgIHN0YXR1c1VybC5yZXBsYWNlKCJ7c30iLCBmaWx0ZXIuYWN0aXZlLnRvTG93ZXJDYXNlKCkpIDoNCiAgICAgICAgICAgICAgICB1bmRlZmluZWQ7DQogICAgICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwocSB8fCAiIikpOw0KICAgICAgICAgICAgdmFyIGRhdGEgPSBjb250YWluZXIuZmluZCgnLmJveCcpOw0KICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICAgICAgZGF0YS5mb3JFYWNoKCh4KSA9PiB7DQogICAgICAgICAgICAgICAgdmFyIGhyZWYgPSB4LnNlbGVjdCgiLmxpc3QtYSIpLmF0dHIoImhyZWYiKS50ZXh0KCkNCiAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSBjb250YWluZXIuZmluZCgiLmxpc3QtdGl0bGUiKS53aGVyZSh4ID0+IHguYXR0cigiaHJlZiIpLnRleHQoKSA9PSBocmVmKS50ZXh0KCk7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goDQogICAgICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoJy5saXN0LWltZycpLmF0dHIoJ3NyYycpLnVybCgpLCB0aXRsZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICcnLA0KICAgICAgICAgICAgICAgICAgICAgICAgaHJlZi51cmkocmV0dXJuT2JqZWN0LnVybCksIHJldHVybk9iamVjdC5uYW1lDQogICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIH0pOw0KDQoNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5sb2coZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSkgPT4gew0KDQogICAgICAgIGlmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDAgfHwgKGZpbHRlci5hY3RpdmUgJiYgZmlsdGVyLmFjdGl2ZSAhPSAiIikpDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmdldEJ5R2VucmVzKGZpbHRlciwgcGFnZSk7DQoNCiAgICAgICAgaWYgKCFmaWx0ZXIudGl0bGUgfHwgZmlsdGVyLnRpdGxlLmxlbmd0aCA8PSAwKQ0KICAgICAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgICB2YXIganNvbkRhdGEgPSBhd2FpdCBIdHRwQ2xpZW50LkdldEpzb24ocmV0dXJuT2JqZWN0LnNlYXJjaFVybC5yZXBsYWNlKCJ7cX0iLCBmaWx0ZXIudGl0bGUgfHwgIiIpLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGlmIChqc29uRGF0YS5pdGVtcyAmJiBqc29uRGF0YS5pdGVtcy5sZW5ndGggPiAwKQ0KICAgICAgICAgICAganNvbkRhdGEuaXRlbXMuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoeC5yZXN1bHRzICYmIHgucmVzdWx0cy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIHgucmVzdWx0cy5mb3JFYWNoKGl0ZW0gPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IExpZ2h0SXRlbShpdGVtLnRodW1ibmFpbCwgaXRlbS50aXRsZS5odG1sVGV4dChmYWxzZSksICIiLCBpdGVtLnBlcm1hbGluay51cmkocmV0dXJuT2JqZWN0LnVybCkgfHwgIiIsIHJldHVybk9iamVjdC5uYW1lKQ0KICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXJzID0gYXN5bmMgKG5vdmVsVXJsKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSAiY2hhcHRlci1saXN0LyIudXJpKG5vdmVsVXJsKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICByZXR1cm4gY29udGFpbmVyLmZpbmQoIi5jaC1saXN0IGEiKS5tYXAoeCA9PiBuZXcgQ2hhcHRlcih4LnRleHQoZmFsc2UpLCB4LmF0dHIoImhyZWYiKS51cmwoKSkpLnJldmVyc2UoKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Tm92ZWwgPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsKSk7DQogICAgICAgIHZhciBjaGFwdGVycyA9IGF3YWl0IHJldHVybk9iamVjdC5nZXRDaGFwdGVycyhub3ZlbFVybCk7DQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIG5vdmVsUmV2aWV3cy5nZW5yZXMgPSBjb250YWluZXIuZmluZCgiI2N1cnJlbnRnZW4gYSIpLnRleHRBcnJheSgpOw0KICAgICAgICBub3ZlbFJldmlld3MudXZvdGVzID0gY29udGFpbmVyLnNlbGVjdCgiLnJhdGluZy1pbmZvIHN0cm9uZyIpLnRleHQoZmFsc2UpICsgIiAvIDUiOw0KICAgICAgICBub3ZlbFJldmlld3MuY29tcGxldGVkID0gY29udGFpbmVyLnNlbGVjdCgiI2N1cnJlbnRzdGF0dXMiKS50ZXh0KGZhbHNlKSA9PT0gIkNvbXBsZXRlZCIgPyAiU3RhdHVzOkNvbXBsZXRlZCIgOiAiU3RhdHVzOiIgKyBjb250YWluZXIuc2VsZWN0KCIjY3VycmVudHN0YXR1cyIpLnRleHQoZmFsc2UpOw0KICAgICAgICB2YXIgdHIgPSBjb250YWluZXIuc2VsZWN0KCIjcGFuZWxub3ZlbGluZm8gLmluZm8iKS5maW5kKCJ0ciIpOw0KICAgICAgICBpZiAodHIgIT09IG51bGwgJiYgdHIgJiYgdHIubGVuZ3RoKCkgPiAwKQ0KICAgICAgICAgICAgbm92ZWxSZXZpZXdzLmF1dGhvciA9IHRyLmVxKHRyLmxlbmd0aCgpIC0gMSkuc2VsZWN0KCJhIikudGV4dEFycmF5KCkuam9pbigiLCIpOw0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcubWFpbi10bWInKS5hdHRyKCdzcmMnKS51cmwoKSwNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy5lbnRyeS10aXRsZScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmRlc2MnKS5jbGVhbklubmVySFRNTCgpLA0KICAgICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgICBjaGFwdGVycywNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICAgICAgdW5kZWZpbmVkLA0KICAgICAgICApOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBuZXcgY2xpZW50KCkuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5zZWxlY3QoJy5wb3N0LWNvbnRlbnQgLnBhcicpLmNsZWFuSW5uZXJIVE1MKCk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdCA9IGFzeW5jIChwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3QubGF0ZXN0VXJsLnJlcGxhY2UoJ3twfScsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBqc29uRGF0YSA9IGF3YWl0IEh0dHBDbGllbnQuR2V0SnNvbih1cmwpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGlmIChqc29uRGF0YS5pdGVtcyAmJiBqc29uRGF0YS5pdGVtcy5sZW5ndGggPiAwKQ0KICAgICAgICAgICAganNvbkRhdGEuaXRlbXMuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgICAgICB2YXIgbG5rID0gKHgubm92ZWxfcGVybWFsaW5rIHx8ICIiKS50b0h0bWwoKS5xdWVyeVNlbGVjdG9yKCJhIik7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goDQogICAgICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0oeC50bWIsIChsbmsuaW5uZXJUZXh0IHx8ICIiKSwgIiIsIGxuay5nZXRBdHRyaWJ1dGUoImhyZWYiKS51cmkocmV0dXJuT2JqZWN0LnVybCksIHJldHVybk9iamVjdC5uYW1lKQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgIH0pDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCg0KfTs=&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5ub3ZlbGZ1bGwiOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJMYW5ndWFnZSA9ICJlbiI7DQogICAgcmV0dXJuT2JqZWN0Lm5hbWUgPSAnTm92ZWxGdWxsJzsNCiAgICByZXR1cm5PYmplY3QuZGlzcGxheU5hbWUgPSAiTm92ZWwtRnVsbHkiOw0KICAgIHJldHVybk9iamVjdC5sYXRlc3RVcmwgPSAnaHR0cHM6Ly9ub3ZlbGZ1bGwuY29tL2xhdGVzdC1yZWxlYXNlLW5vdmVsP3BhZ2U9e3B9JzsNCiAgICByZXR1cm5PYmplY3QudXJsID0gJ2h0dHBzOi8vbm92ZWxmdWxsLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL25vdmVsZnVsbC5jb20vc2VhcmNoP2tleXdvcmQ9e3F9JnBhZ2U9e3B9JzsNCiAgICByZXR1cm5PYmplY3QuY2hhcHRlcnNVcmwgPSAnaHR0cHM6Ly9ub3ZlbGZ1bGwuY29tL2FqYXgtY2hhcHRlci1vcHRpb24/bm92ZWxJZD17aWR9JzsNCiAgICByZXR1cm5PYmplY3QucGFuaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFBhZ2luYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5pY29uID0gJ2h0dHBzOi8vbm92ZWxmdWxsLmNvbS93ZWIvaW1hZ2VzL2Zhdmljb24uaWNvJzsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MgPSBuZXcgUGFyc2VyU2VhcmNoU2V0dGluZ3MoKTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MuZ2VucmVzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1Nob3VuZW4nKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdIYXJlbScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NvbWVkeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01hcnRpYWwgQXJ0cycsICdNYXJ0aWFsK0FydHMnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTY2hvb2wgTGlmZScsICdTY2hvb2wrTGlmZScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ015c3RlcnknKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTaG91am8nKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdSb21hbmNlJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2NpLWZpJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnR2VuZGVyIEJlbmRlcicsICdHZW5kZXIrQmVuZGVyJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTWF0dXJlJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRmFudGFzeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hvcnJvcicpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0RyYW1hJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVHJhZ2VkeScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1N1cGVybmF0dXJhbCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0VjY2hpJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWHVhbmh1YW4nKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBZHZlbnR1cmUnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdQc3ljaG9sb2dpY2FsJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWGlhbnhpYScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1d1eGlhJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnSGlzdG9yaWNhbCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1NsaWNlIG9mIExpZmUnLCAnU2xpY2Urb2YrTGlmZScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0xvbGljb24nKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBZHVsdCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0pvc2VpJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU3BvcnRzJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU211dCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01lY2hhJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWWFvaScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1Nob3VuZW4gQWknLCAnU2hvdW5lbitBaScpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0vhu7MgVMOtY2ggVsawxqFuZyBU4buNYScsICdL4buzK1TDrWNoK1bGsMahbmcrVOG7jWEnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNVCcpLA0KICAgICAgICBdLA0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zb3J0VHlwZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTGF0ZXN0IFJlbGVhc2UgTm92ZWwnLCAnbGF0ZXN0LXJlbGVhc2Utbm92ZWwnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdIb3QgTm92ZWwnLCAnaG90LW5vdmVsJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQ29tcGxldGVkIE5vdmVsJywgJ2NvbXBsZXRlZC1ub3ZlbCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01vc3QgUG9wdWxhcicsICdtb3N0LXBvcHVsYXInKSwNCiAgICAgICAgXSwNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0U2VjdGlvbnMgPSAoa2V5cykgPT4gew0KICAgICAgICB2YXIgc2VjdGlvbnMgPSBbDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibGF0ZXN0IiwgIkxhdGVzdCBVcGRhdGUiLCAiTGF0ZXN0IiwgdHJ1ZSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiaG90IiwgIkhvdCBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJob3Qtbm92ZWwiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiY29tcGxldGVkIiwgIkNvbXBsZXRlZCBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJjb21wbGV0ZWQtbm92ZWwiKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigicG9wdWxhciIsICJNb3N0IFBvcHVsYXIiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAibW9zdC1wb3B1bGFyIikpDQogICAgICAgIF0NCg0KICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmlsdGVyKHggPT4gIWtleXMgfHwga2V5cy5pbmNsdWRlcyh4Lm5hbWUpKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QudHJhbnNsYXRlU2VjdGlvbiA9IGFzeW5jIChzZWN0aW9uLCBwYWdlKSA9PiB7DQogICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmxhdGVzdChwYWdlKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5zZWFyY2goc2VjdGlvbi5maWx0ZXIgfHwgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgcGFnZSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIgPSAoKSA9PiB7DQogICAgICAgIHJldHVybiBuZXcgRmlsdGVyKCk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaCA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIGdlbnJlVXJsID0gImdlbnJlL3tnfT9wYWdlPXtwfSIudXJpKHJldHVybk9iamVjdC51cmwpLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBzb3J0VHlwZVVybCA9ICJ7c30/cGFnZT17cH0iLnVyaShyZXR1cm5PYmplY3QudXJsKS5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICB2YXIgcSA9IGZpbHRlci5nZW5yZXMubGVuZ3RoID4gMCA/IGdlbnJlVXJsLnJlcGxhY2UoIntnfSIsIGZpbHRlci5nZW5yZXNbMF0pIDogKChmaWx0ZXIuc29ydFR5cGUgJiYgZmlsdGVyLnNvcnRUeXBlICE9ICcnID8gc29ydFR5cGVVcmwucmVwbGFjZSgie3N9IiwgZmlsdGVyLnNvcnRUeXBlKSA6IHVuZGVmaW5lZCkpOw0KICAgICAgICB2YXIgcXVlcnkgPSBxIHx8IHJldHVybk9iamVjdC5zZWFyY2hVcmwucmVwbGFjZSgne3F9JywgZmlsdGVyLnRpdGxlIHx8ICIiKS5yZXBsYWNlKCd7cH0nLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwocXVlcnkpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgnLmxpc3QtdHJ1eWVuIC5yb3cnKS5mb3JFYWNoKCh4KSA9PiB7DQogICAgICAgICAgICBpZiAoeC5zZWxlY3QoJ2ltZycpLmF0dHIoInNyYyIpLmhhc1ZhbHVlKCkpDQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goDQogICAgICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0obmV3IEltYWdlSGFuZGxlcihyZXR1cm5PYmplY3QudXJsLCB4LnNlbGVjdCgnLnRydXllbi10aXRsZSBhJykuYXR0cigiaHJlZiIpLnVybCgpLCAiLmJvb2sgaW1nIiksDQogICAgICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLnRydXllbi10aXRsZSBhJykudGV4dChmYWxzZSksDQogICAgICAgICAgICAgICAgICAgICAgICAnJywNCiAgICAgICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCcudHJ1eWVuLXRpdGxlIGEnKS5hdHRyKCJocmVmIikudXJsKCksIHJldHVybk9iamVjdC5uYW1lDQogICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlcnMgPSBhc3luYyAobm92ZWxVcmwsIGh0bWxDb250YWluZXIpID0+IHsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gW107DQogICAgICAgIHZhciB1cmwgPSAiaHR0cHM6Ly9ub3ZlbGZ1bGwuY29tL2FqYXgtY2hhcHRlci1vcHRpb24/bm92ZWxJZD17aWR9Ii5yZXBsYWNlKCJ7aWR9IiwNCiAgICAgICAgICAgIGh0bWxDb250YWluZXIuc2VsZWN0KCIjcmF0aW5nIikuYXR0cigiZGF0YS1ub3ZlbC1pZCIpLmhhc1ZhbHVlKCkgPw0KICAgICAgICAgICAgaHRtbENvbnRhaW5lci5zZWxlY3QoIiNyYXRpbmciKS5hdHRyKCJkYXRhLW5vdmVsLWlkIikudGV4dCgpIDoNCiAgICAgICAgICAgIGh0bWxDb250YWluZXIuc2VsZWN0KCJbZGF0YS1ub3ZlbC1pZF0iKS5hdHRyKCJkYXRhLW5vdmVsLWlkIikudGV4dCgpKTsNCg0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwodXJsKSk7DQoNCiAgICAgICAgY29udGFpbmVyLmZpbmQoJ29wdGlvbicpLmZvckVhY2goYSA9PiB7DQogICAgICAgICAgICB2YXIgYVVybCA9IGEuYXR0cigidmFsdWUiKS51cmwoKTsNCiAgICAgICAgICAgIHZhciB0aXRsZSA9IGEudGV4dChmYWxzZSk7DQogICAgICAgICAgICBpZiAodXJsICYmIHVybCAhPT0gJycpIGNoYXB0ZXJzLnB1c2gobmV3IENoYXB0ZXIodGl0bGUsIGFVcmwpKTsNCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuIGNoYXB0ZXJzOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXROb3ZlbCA9IGFzeW5jIChub3ZlbFVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwpKTsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gYXdhaXQgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXJzKG5vdmVsVXJsLCBjb250YWluZXIpOw0KICAgICAgICB2YXIgbm92ZWxSZXZpZXdzID0gbmV3IE5vdmVsUmV2aWV3cygpOw0KICAgICAgICB2YXIgaW5mb3MgPSBjb250YWluZXIuZmluZCgiLmluZm8gPiBkaXYiKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGluZm9zLmVxKDIpLmZpbmQoImEiKS5tYXAoeCA9PiB4LnRleHQoZmFsc2UpKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmF1dGhvciA9IGluZm9zLmVxKDApLmZpbmQoImEiKS50ZXh0KGZhbHNlKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLnV2b3RlcyA9IGNvbnRhaW5lci5zZWxlY3QoIi5jb2wtaW5mby1kZXNjID4gLmRlc2MgPiAuc21hbGwgc3Ryb25nOmZpcnN0LWNoaWxkIHNwYW4iKS50ZXh0KGZhbHNlKSArICIgLyAxMCI7DQogICAgICAgIG5vdmVsUmV2aWV3cy5jb21wbGV0ZWQgPSBpbmZvcy5sYXN0KCkuc2VsZWN0KCJhIikudGV4dChmYWxzZSkgPT09ICJDb21wbGV0ZWQiID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIjsNCg0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcuYm9vayBpbWcnKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy50aXRsZScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmRlc2MtdGV4dCcpLmNsZWFuSW5uZXJIVE1MKCksDQogICAgICAgICAgICBub3ZlbFVybCwNCiAgICAgICAgICAgIGNoYXB0ZXJzLA0KICAgICAgICAgICAgbm92ZWxSZXZpZXdzLA0KICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUsDQogICAgICAgICAgICB1bmRlZmluZWQsDQogICAgICAgICk7DQogICAgfQ0KDQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlciA9IGFzeW5jICh1cmwpID0+IHsNCiAgICAgICAgcmV0dXJuIHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgbmV3IGNsaWVudCgpLmdldEh0bWwodXJsKSkuc2VsZWN0KCcjY2hhcHRlci1jb250ZW50JykuY2xlYW5Jbm5lckhUTUwoKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0ID0gYXN5bmMgKHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHVybCA9IHJldHVybk9iamVjdC5sYXRlc3RVcmwucmVwbGFjZSgne3B9JywgcGFnZS50b1N0cmluZygpKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcubGlzdC10cnV5ZW4gLnJvdycpLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgIGlmICh4LnNlbGVjdCgnaW1nJykuYXR0cigic3JjIikuaGFzVmFsdWUoKSkNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgNCiAgICAgICAgICAgICAgICAgICAgbmV3IExpZ2h0SXRlbSgNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJbWFnZUhhbmRsZXIocmV0dXJuT2JqZWN0LnVybCwgeC5zZWxlY3QoJy50cnV5ZW4tdGl0bGUgYScpLmF0dHIoImhyZWYiKS51cmwoKSwgIi5ib29rIGltZyIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgeC5zZWxlY3QoJy50cnV5ZW4tdGl0bGUgYScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICAgICAgICAgICAgJycsDQogICAgICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLnRydXllbi10aXRsZSBhJykuYXR0cigiaHJlZiIpLnVybCgpLCByZXR1cm5PYmplY3QubmFtZQ0KICAgICAgICAgICAgICAgICAgICApKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm4gcmV0dXJuT2JqZWN0Ow0KDQp9Ow==&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5ub3ZlbGhhbGwiOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJMYW5ndWFnZSA9ICJlbiI7DQogICAgcmV0dXJuT2JqZWN0Lm5hbWUgPSAnTm92ZWxIYWxsJzsNCiAgICByZXR1cm5PYmplY3QuZGlzcGxheU5hbWUgPSAiTm92ZWwtQ2hhbm5lbCINCiAgICByZXR1cm5PYmplY3QuZGV0YWxpSXRlbVR5cGUgPSBEZXRhbGlJdGVtVHlwZS5Ob3ZlbDsNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vd3d3Lm5vdmVsaGFsbC5jb20vbGFzdHVwZGF0ZS17cH0uaHRtbCc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL3d3dy5ub3ZlbGhhbGwuY29tLyc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL3d3dy5ub3ZlbGhhbGwuY29tL2luZGV4LnBocD9zPXNvJm1vZHVsZT1ib29rJmtleXdvcmQ9e3F9JzsNCiAgICByZXR1cm5PYmplY3QucGFuaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFBhZ2luYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5pY29uID0gJ2h0dHBzOi8vd3d3Lm5vdmVsaGFsbC5jb20vZmF2aWNvbi5pY28nOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgIF0sDQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5sb2FkU2V0dGluZ3MgPSBhc3luYyAoKSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAocmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcy52YWx1ZXMubGVuZ3RoIDw9IDApIHsNCiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwocmV0dXJuT2JqZWN0LnVybCkpDQogICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoIi5kcm9wZG93bi1tZW51IGEiKS53aGVyZSh4ID0+IHguYXR0cigiaHJlZiIpLmF0dFZhbHVlKCkuaW5kZXhPZigiZ2VucmUiKSAhPT0gLTEpLmZvckVhY2goYSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMudmFsdWVzLnB1c2gobmV3IGxhYmVsVmFsdWUoYS50ZXh0KGZhbHNlKSwgYS5hdHRyKCJocmVmIikudXJsKCkpKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5sb2coKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zb3J0VHlwZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQ29tcGxldGVkJywgJ2NvbXBsZXRlZC17cH0uaHRtbCcpLA0KICAgICAgICBdLA0KICAgIH07DQogICAgcmV0dXJuT2JqZWN0LmdldFNlY3Rpb25zID0gKGtleXMpID0+IHsNCiAgICAgICAgdmFyIHNlY3Rpb25zID0gWw0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImxhdGVzdCIsICJMYXRlc3QgVXBkYXRlIiwgIkxhdGVzdCIsIHRydWUpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImNvbXBsZXRlZCIsICJDb21wbGV0ZWQgTm92ZWwiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAnY29tcGxldGVkLXtwfS5odG1sJykpLA0KICAgICAgICBdDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgIH0NCiAgICByZXR1cm5PYmplY3QudHJhbnNsYXRlU2VjdGlvbiA9IGFzeW5jIChzZWN0aW9uLCBwYWdlKSA9PiB7DQogICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QubGF0ZXN0KHBhZ2UpOw0KICAgICAgICBlbHNlIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCiAgICByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlciA9ICgpID0+IHsNCiAgICAgICAgdmFyIGZpbHRlciA9IG5ldyBGaWx0ZXIoKTsNCiAgICAgICAgcmV0dXJuIGZpbHRlcjsNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LmdldEdlbnJlcyA9IGFzeW5jIChmaWx0ZXIpID0+IHsNCiAgICAgICAgdmFyIHVybCA9IGZpbHRlci5nZW5yZXNbMF07DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5maW5kKCcuYm9vay1pbmZvJykubWFwKCh4KSA9PiB7DQogICAgICAgICAgICByZXR1cm4gbmV3IExpZ2h0SXRlbSh4LmNsb3Nlc3QoImxpIikuc2VsZWN0KCIuYm9vay1pbWcgaW1nIikuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoJ2EnKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgICAgICAnJywNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgnYScpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgfSk7DQoNCg0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQoNCiAgICAgICAgaWYgKGZpbHRlci5nZW5yZXMgJiYgZmlsdGVyLmdlbnJlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmdldEdlbnJlcyhmaWx0ZXIpOw0KICAgICAgICB9DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3Quc2VhcmNoVXJsOw0KICAgICAgICBpZiAoZmlsdGVyLnNvcnRUeXBlICYmIGZpbHRlci5zb3J0VHlwZS5sZW5ndGggPiAwKQ0KICAgICAgICAgICAgdXJsID0gZmlsdGVyLnNvcnRUeXBlLnVyaShyZXR1cm5PYmplY3QudXJsKTsNCg0KICAgICAgICB2YXIgdXJsID0gdXJsLnJlcGxhY2UoIntxfSIsIGZpbHRlci50aXRsZSB8fCAiIikucmVwbGFjZSgie3B9IiwgcGFnZSk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgnLmNvbnRhaW5lciB0YWJsZSB0cicpLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgIHZhciBhID0geC5maW5kKCJ0ZCIpLmVxKDApLnNlbGVjdCgiYSIpLmF0dHIoImhyZWYiKS50ZXh0KCkuaW5kZXhPZigiZ2VucmUiKSA9PT0gLTEgPyB4LmZpbmQoInRkIikuZXEoMCkuc2VsZWN0KCJhIikgOiB4LmZpbmQoInRkIikuZXEoMSkuc2VsZWN0KCJhIik7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKG5ldyBJbWFnZUhhbmRsZXIocmV0dXJuT2JqZWN0LnVybCwgYS5hdHRyKCJocmVmIikudXJsKCksICIuYm9vay1pbWcgaW1nIiksIGEudGV4dChmYWxzZSksICcnLCBhLmF0dHIoImhyZWYiKS51cmwoKSwgcmV0dXJuT2JqZWN0Lm5hbWUpKTsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldE5vdmVsID0gYXN5bmMgKG5vdmVsVXJsKSA9PiB7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbChub3ZlbFVybCkpOw0KICAgICAgICB2YXIgY2hhcHRlcnMgPSBjb250YWluZXIuZmluZCgiI21vcmVsaXN0IGxpIGEiKS5tYXAoeCA9PiBuZXcgQ2hhcHRlcih4LnRleHQoZmFsc2UpLCB4LmF0dHIoImhyZWYiKS51cmwoKSkpOw0KICAgICAgICB2YXIgaXRlbSA9IG5ldyBOb3ZlbFJldmlld3MoKTsNCg0KICAgICAgICBpdGVtLmdlbnJlcyA9IGNvbnRhaW5lci5maW5kKCIuYm9vay1pbmZvIC5yZWQiKS50ZXh0QXJyYXkoKTsNCiAgICAgICAgaXRlbS5hdXRob3IgPSBjb250YWluZXIuZmluZCgiLmJvb2staW5mbyAuYmx1ZSIpLndoZXJlKHggPT4geC5pbm5lckhUTUwoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoImF1dGhvciIpICE9IC0xKS5lcSgwKS5yZW1vdmUoInAiKS50ZXh0KGZhbHNlKS5yZXBsYWNlKC9hdXRob3I6L2dpLCAiIik7DQogICAgICAgIGl0ZW0uY29tcGxldGVkID0gY29udGFpbmVyLmZpbmQoIi5ib29rLWluZm8gLmJsdWUiKS53aGVyZSh4ID0+IHguaW5uZXJIVE1MKCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKCJzdGF0dXMiKSAhPSAtMSkudGV4dChmYWxzZSkucmVwbGFjZSgvc3RhdHVzOi9naSwgIiIpOw0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oY29udGFpbmVyLnNlbGVjdCgnLmJvb2staW1nIGltZycpLmF0dHIoInNyYyIpLnVybCgpDQogICAgICAgICAgICAsIGNvbnRhaW5lci5zZWxlY3QoJy5ib29rLWluZm8gaDEnKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKCcuaW50cm8gPiBzcGFuJykucmVtb3ZlKCIuYmx1ZSIpLmxhc3QoKS5jbGVhbklubmVySFRNTCgpLA0KICAgICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgICBjaGFwdGVycywNCiAgICAgICAgICAgIGl0ZW0sDQogICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgIHVuZGVmaW5lZCk7DQogICAgfQ0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICByZXR1cm4gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBuZXcgY2xpZW50KCkuZ2V0SHRtbCh1cmwpKS5zZWxlY3QoJy5lbnRyeS1jb250ZW50JykuY2xlYW5Jbm5lckhUTUwoKTsNCiAgICB9DQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdCA9IGFzeW5jIChwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3QubGF0ZXN0VXJsLnJlcGxhY2UoJ3twfScsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcuY29udGFpbmVyIHRhYmxlIHRyJykuZm9yRWFjaCgoeCkgPT4gew0KICAgICAgICAgICAgdmFyIGEgPSB4LmZpbmQoInRkIikuZXEoMSkuc2VsZWN0KCJhIik7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKG5ldyBJbWFnZUhhbmRsZXIocmV0dXJuT2JqZWN0LnVybCwgYS5hdHRyKCJocmVmIikudXJsKCksICIuYm9vay1pbWcgaW1nIiksIGEudGV4dChmYWxzZSksICcnLCBhLmF0dHIoImhyZWYiKS51cmwoKSwgcmV0dXJuT2JqZWN0Lm5hbWUpKTsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KICAgIHJldHVybiByZXR1cm5PYmplY3Q7DQp9Ow==&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5ub3ZlbG9ubGluZWZ1bGwiOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJMYW5ndWFnZSA9ICJlbiI7DQogICAgcmV0dXJuT2JqZWN0Lm5hbWUgPSAnTm92ZWxPbmxpbmVGdWxsJzsNCiAgICByZXR1cm5PYmplY3QuZGlzcGxheU5hbWUgPSAiTm92ZWwtT25saW5lIg0KICAgIHJldHVybk9iamVjdC5sYXRlc3RVcmwgPSAnaHR0cHM6Ly9ub3ZlbG9ubGluZWZ1bGwuY29tL25vdmVsX2xpc3Q/dHlwZT1sYXRlc3QmY2F0ZWdvcnk9YWxsJnN0YXRlPWFsbCZwYWdlPXtwfSc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL25vdmVsb25saW5lZnVsbC5jb20vJzsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoVXJsID0gJ2h0dHBzOi8vbm92ZWxvbmxpbmVmdWxsLmNvbS9zZWFyY2hfbm92ZWxzL3txfT9wYWdlPXtwfSc7DQogICAgcmV0dXJuT2JqZWN0LnBhbmluYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hQYWdpbmF0aW9uID0gZmFsc2U7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly9ub3ZlbG9ubGluZWZ1bGwuY29tL3RoZW1lcy9ob21lL2ltYWdlcy9mYXZpY29uLnBuZyc7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzID0gbmV3IFBhcnNlclNlYXJjaFNldHRpbmdzKCk7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLm11bHRpU2VsZWN0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MuZ2VucmVzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkFsbCIsICJhbGwiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJDaGluZXNlIiwgMyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRW5nbGlzaCIsIDYpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIktvcmVhbiIsIDEzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJPcmlnaW5hbCIsIDE5KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJBY3Rpb24iLCAxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJBZHZlbnR1cmUiLCAyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJDb21lZHkiLCA0KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJEcmFtYSIsIDUpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkZhbnRhc3kiLCA3KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJHZW5kZXIgQmVuZGVyIiwgOCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGFyZW0iLCA5KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIaXN0b3JpY2FsIiwgMTApLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhvcnJvciIsIDExKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJKb3NlaSIsIDEyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJMb2xpY29uIiwgMTQpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1hcnRpYWwgQXJ0cyIsIDE1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNYXR1cmUiLCAxNiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWVjaGEiLCAxNyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTXlzdGVyeSIsIDE4KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJQc3ljaG9sb2dpY2FsIiwgMjApLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlJlaW5jYXJuYXRpb24iLCAyMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUm9tYW5jZSIsIDIyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTY2hvb2wgTGlmZSIsIDIzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTY2ktZmkiLCAyNCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2VpbmVuIiwgMjUpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNob3RhY29uIiwgMjYpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNob3VqbyIsIDI3KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTaG91am8gQWkiLCAyOCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2hvdW5lbiIsIDI5KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTaG91bmVuIEFpIiwgMzApLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNsaWNlIG9mIExpZmUiLCAzMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU211dCIsIDMyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTcG9ydHMiLCAzMyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU3VwZXJuYXR1cmFsIiwgMzQpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlRyYWdlZHkiLCAzNSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVmlydHVhbCBSZWFsaXR5IiwgMzYpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIld1eGlhIiwgMzcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlhpYW54aWEiLCAzOCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiWHVhbmh1YW4iLCAzOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQXJ0cyIsIDQwKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJCaW9ncmFwaGllcyIsIDQxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJCdXNpbmVzcyIsIDQyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJDb21wdXRlcnMiLCA0MyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRWR1Y2F0aW9uIiwgNDYpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkVudGVydGFpbm1lbnQiLCA0NyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRmljdGlvbiIsIDQ4KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIdW1vciIsIDUxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJJbnZlc3RpbmciLCA1MiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTGl0ZXJhdHVyZSIsIDUzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNZW1vaXJzIiwgNTQpDQoNCiAgICAgICAgXQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zb3J0VHlwZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTGF0ZXN0JywgJ2xhdGVzdCcpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ05ld2VzdCcsICduZXdlc3QnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdUb3AgdmlldycsICd0b3B2aWV3JykNCiAgICAgICAgXSwNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LmdldFNlY3Rpb25zID0gKGtleXMpID0+IHsNCiAgICAgICAgdmFyIHNlY3Rpb25zID0gWw0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImxhdGVzdCIsICJMYXRlc3QgVXBkYXRlIiwgIkxhdGVzdCIsIHRydWUpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oIm5ld2VzdCIsICJOZXdlc3QgTm92ZWwiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAibmV3ZXN0IikpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oInRvcCIsICJUb3AgdmlldyIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJ0b3B2aWV3IikpDQogICAgICAgIF0NCg0KICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmlsdGVyKHggPT4gIWtleXMgfHwga2V5cy5pbmNsdWRlcyh4Lm5hbWUpKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QudHJhbnNsYXRlU2VjdGlvbiA9IGFzeW5jIChzZWN0aW9uLCBwYWdlKSA9PiB7DQogICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmxhdGVzdChwYWdlKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5zZWFyY2goc2VjdGlvbi5maWx0ZXIgfHwgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgcGFnZSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIgPSAoKSA9PiB7DQogICAgICAgIHJldHVybiBuZXcgRmlsdGVyKFsiYWxsIl0sICJ0b3B2aWV3Iik7DQogICAgfTsNCg0KDQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaCA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHNvcnRUeXBlVXJpID0gImh0dHBzOi8vbm92ZWxvbmxpbmVmdWxsLmNvbS9ub3ZlbF9saXN0P3R5cGU9e3N9JmNhdGVnb3J5PXtnfSZzdGF0ZT1hbGwmcGFnZT17cH0iDQogICAgICAgIHZhciBzb3J0VHlwZVVybCA9IHNvcnRUeXBlVXJpLnJlcGxhY2UoIntzfSIsIGZpbHRlci5zb3J0VHlwZSkucmVwbGFjZSgie3B9IiwgcGFnZS50b1N0cmluZygpKS5yZXBsYWNlKCJ7Z30iLCBmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDAgPyBmaWx0ZXIuZ2VucmVzWzBdIDogImFsbCIpOw0KDQogICAgICAgIHZhciB1cmwgPSAoIWZpbHRlci50aXRsZSB8fCBmaWx0ZXIudGl0bGUgPT0gIiIpICYmIGZpbHRlci5zb3J0VHlwZSAmJiBmaWx0ZXIuc29ydFR5cGUgIT0gJycgPyBzb3J0VHlwZVVybCA6IHJldHVybk9iamVjdC5zZWFyY2hVcmwucmVwbGFjZSgne3F9JywgKGZpbHRlci50aXRsZSB8fCAiIikucmVwbGFjZSgvWyBdLywgIl8iKSk7DQoNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCIudXBkYXRlX2l0ZW0sIC5pdGVtdXBkYXRlIikuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoImltZyIpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJpbWciKS5hdHRyKCJhbHQgfCB0aXRsZSIpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICAgICIiLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJhIikuYXR0cigiaHJlZiIpLnVybCgpLA0KICAgICAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lKSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQoNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Tm92ZWwgPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsKSk7DQogICAgICAgIHZhciBjaGFwdGVycyA9IGNvbnRhaW5lci5maW5kKCIuY2hhcHRlci1saXN0IC5yb3cgYSIpLm1hcCh4ID0+IG5ldyBDaGFwdGVyKHgudGV4dChmYWxzZSksIHguYXR0cigiaHJlZiIpLnVybCgpKSk7DQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIHZhciBpbmZvcyA9IGNvbnRhaW5lci5maW5kKCIudHJ1eWVuX2luZm9fcmlnaHQgbGkiKQ0KDQoNCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGluZm9zLmVxKDIpLmZpbmQoImEiKS50ZXh0QXJyYXkoKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmF1dGhvciA9IGluZm9zLmVxKDEpLmZpbmQoImEiKS50ZXh0KCk7DQogICAgICAgIG5vdmVsUmV2aWV3cy51dm90ZXMgPSBpbmZvcy5lcSg2KS50ZXh0KGZhbHNlKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmRlc2NyaXB0aW9uID0gaW5mb3Muc2VsZWN0KCIjbm9pZHVuZ20iKS50ZXh0KGZhbHNlKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmNvbXBsZXRlZCA9IGluZm9zLmVxKDMpLnNlbGVjdCgiYSIpLnRleHQoZmFsc2UpID09PSAiQ29tcGxldGVkIiA/ICJTdGF0dXM6Q29tcGxldGVkIiA6ICJTdGF0dXM6T25nb2luZyI7DQoNCiAgICAgICAgcmV0dXJuIG5ldyBEZXRhbGlJdGVtKA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgiLmluZm9faW1hZ2UgaW1nIikuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcudHJ1eWVuX2luZm9fcmlnaHQgaDEnKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJyNub2lkdW5nbScpLmNsZWFuSW5uZXJIVE1MKCksDQogICAgICAgICAgICBub3ZlbFVybCwNCiAgICAgICAgICAgIGNoYXB0ZXJzLnJldmVyc2UoKSwNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICAgICAgdW5kZWZpbmVkLA0KICAgICAgICApOw0KICAgIH0NCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IG5ldyBjbGllbnQoKS5nZXRIdG1sKHVybCkpLnNlbGVjdCgiLnZ1bmdfZG9jIikuY2xlYW5Jbm5lckhUTUwoKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0ID0gYXN5bmMgKHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHVybCA9IHJldHVybk9iamVjdC5sYXRlc3RVcmwucmVwbGFjZSgie3B9IiwgcGFnZS50b1N0cmluZygpKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCIudXBkYXRlX2l0ZW0iKS5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbSh4LnNlbGVjdCgiaW1nIikuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoImltZyIpLmF0dHIoInRpdGxlIikudGV4dChmYWxzZSksDQogICAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoImEiKS5hdHRyKCJocmVmIikudXJsKCksDQogICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUpKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm4gcmV0dXJuT2JqZWN0Ow0KfTs=&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5yZWFkbGlnaHRub3ZlbCI7DQogICAgcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCiAgICByZXR1cm5PYmplY3QubmFtZSA9ICdSZWFkTGlnaHROb3ZlbCc7DQogICAgcmV0dXJuT2JqZWN0LmRpc3BsYXlOYW1lID0gIlItTm92ZWwtTGlnaHQiOw0KICAgIHJldHVybk9iamVjdC5sYXRlc3RVcmwgPSAnaHR0cHM6Ly93d3cucmVhZGxpZ2h0bm92ZWwuY2MnOw0KICAgIHJldHVybk9iamVjdC51cmwgPSAnaHR0cHM6Ly93d3cucmVhZGxpZ2h0bm92ZWwuY2MvJzsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoVXJsID0gJ2h0dHBzOi8vd3d3LnJlYWRsaWdodG5vdmVsLmNjL3NlYXJjaC97cX0ve3B9JzsNCiAgICByZXR1cm5PYmplY3QucGFuaW5hdGlvbiA9IGZhbHNlOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hQYWdpbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3QuaWNvbiA9ICdodHRwczovL3d3dy5nb29nbGUuY29tL3MyL2Zhdmljb25zP2RvbWFpbj1odHRwczovL3d3dy5yZWFkbGlnaHRub3ZlbC5jYy8nOw0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzID0gbmV3IFBhcnNlclNlYXJjaFNldHRpbmdzKCk7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBbnknLCAwKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdGYW50YXN5JywgMSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWGlhbnhpYScsIDIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1JvbWFudGljJywgMyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnSGlzdG9yaWNhbCcsIDQpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1NjaS1maScsIDUpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0dhbWUnLCA2KSwNCiAgICAgICAgXSwNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LmdldFNlY3Rpb25zID0gYXN5bmMgKGtleXMpID0+IHsNCiAgICAgICAgdmFyIHNlY3Rpb25zID0gWw0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImxhdGVzdCIsICJMYXRlc3QgVXBkYXRlIiwgIkxhdGVzdCIsIHRydWUpDQogICAgICAgIF0NCg0KICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmlsdGVyKHggPT4gIWtleXMgfHwga2V5cy5pbmNsdWRlcyh4Lm5hbWUpKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QudHJhbnNsYXRlU2VjdGlvbiA9IGFzeW5jIChzZWN0aW9uLCBwYWdlKSA9PiB7DQogICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmxhdGVzdChwYWdlKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5zZWFyY2goc2VjdGlvbi5maWx0ZXIgfHwgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgcGFnZSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIgPSAoKSA9PiB7DQogICAgICAgIHZhciBmaWx0ZXIgPSBuZXcgRmlsdGVyKCk7DQogICAgICAgIHJldHVybiBmaWx0ZXI7DQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5nZXRHZW5yZXNTZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciBxID0gJ2h0dHBzOi8vd3d3LnJlYWRsaWdodG5vdmVsLmNjL21lbWJlcmFjdGlvbi5hc3B4JzsNCiAgICAgICAgdmFyIGYgPSB7DQogICAgICAgICAgICBhY3Rpb246ICduZXh0Ym9va2NhdGVnb3J5JywNCiAgICAgICAgICAgIGNhdGVnb3J5aWQ6IGZpbHRlci5nZW5yZXNbMF0sDQogICAgICAgICAgICBwYWdlOiBwYWdlLA0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBqc29uID0gYXdhaXQgSHR0cENsaWVudC5wb3N0Rm9ybShxLCBmKTsNCg0KICAgICAgICByZXR1cm4ganNvbiAmJiBqc29uLmRhdGEgPyBqc29uLmRhdGEubWFwKCh4KSA9Pg0KICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0oDQogICAgICAgICAgICAgICAgICAgIGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGF3YWl0IHJldHVybk9iamVjdC5nZXROb3ZlbCh4LkJvb2tQaW5ZaW4udXJpKHJldHVybk9iamVjdC5wYXJzZXIudXJsKSArICIvIiwgdHJ1ZSkpLmltYWdlDQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgeC5Cb29rTmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHguRGVzY3JpcHRpb24sDQogICAgICAgICAgICAgICAgICAgICAgICB4LkJvb2tQaW5ZaW4udXJpKHRyZXR1cm5PYmplY3RoaXMudXJsKSArICIvIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lDQogICAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICkgOg0KICAgICAgICAgICAgW107DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaCA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCiAgICAgICAgaWYgKGZpbHRlci5nZW5yZXMubGVuZ3RoID4gMCkNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QuZ2V0R2VucmVzU2VhcmNoKGZpbHRlciwgcGFnZSk7DQoNCiAgICAgICAgdmFyIHF1ZXJ5ID0gcmV0dXJuT2JqZWN0LnNlYXJjaFVybA0KICAgICAgICAgICAgLnJlcGxhY2UoJ3txfScsIGZpbHRlci50aXRsZSB8fCAiIikNCiAgICAgICAgICAgIC5yZXBsYWNlKCd7cH0nLCBwYWdlLnRvU3RyaW5nKCkpOw0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwocXVlcnkpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgnLmxpc3QtaXRlbScpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICByZXN1bHQucHVzaCgNCiAgICAgICAgICAgICAgICBuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnaW1nJykuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCdpbWcnKS5hdHRyKCJhbHQgfCB0aXRsZSIpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICAgICAgICAnJywNCiAgICAgICAgICAgICAgICAgICAgeC5zZWxlY3QoJy5ib29rLW5hbWUnKS5hdHRyKCJocmVmIikudXJsKCksDQogICAgICAgICAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lDQogICAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICk7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXROb3ZlbCA9IGFzeW5jIChub3ZlbFVybCwgaWdub3JlQ2hhcHRlcnMpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsLCBpZ25vcmVDaGFwdGVycykpOw0KICAgICAgICB2YXIgY2hhcHRlcnMgPSBbXTsNCiAgICAgICAgdmFyIG5vdmVsUmV2aWV3cyA9IG5ldyBOb3ZlbFJldmlld3MoKTsNCiAgICAgICAgaWYgKCFpZ25vcmVDaGFwdGVycykgew0KICAgICAgICAgICAgdmFyIGh0bWxDaGFwdGVycyA9IGNvbnRhaW5lci5maW5kKCcuY2hhcHRlci1saXN0IGEnKTsNCiAgICAgICAgICAgIGh0bWxDaGFwdGVycy5mb3JFYWNoKCh4KSA9PiB7DQogICAgICAgICAgICAgICAgY2hhcHRlcnMucHVzaCgNCiAgICAgICAgICAgICAgICAgICAgbmV3IENoYXB0ZXIoeC5zZWxlY3QoJy5jaGFwdGVyLW5hbWUnKS50ZXh0KGZhbHNlKSwgeC5hdHRyKCJocmVmIikudXJsKCkpDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIG5vdmVsUmV2aWV3cy5nZW5yZXMgPSBjb250YWluZXIuZmluZCgiLmJhc2UtaW5mbyAuYm9vay1jYXRhbG9nIC50eHQiKS50ZXh0QXJyYXkoKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmF1dGhvciA9IGNvbnRhaW5lci5zZWxlY3QoIi5hdXRob3IgLm5hbWUiKS50ZXh0KGZhbHNlKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLnV2b3RlcyA9IGNvbnRhaW5lci5zZWxlY3QoIi5zY29yZSIpLnRleHQoZmFsc2UpICsgIiAvIDEwIjsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmNvbXBsZXRlZCA9IGNvbnRhaW5lci5zZWxlY3QoIi5iYXNlLWluZm8gLmJvb2stc3RhdGUgLnR4dCIpLnRleHQoZmFsc2UpID09PSAiQ29tcGxldGVkIiA/ICJTdGF0dXM6Q29tcGxldGVkIiA6ICJTdGF0dXM6T25nb2luZyI7DQogICAgICAgIHJldHVybiBuZXcgRGV0YWxpSXRlbSgNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy5ib29rLWNvbnRhaW5lciBpbWcnKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy5ib29rLWluZm8gLmJvb2stbmFtZScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLnN5bm9wc2lzIC5jb250ZW50IC5kZXNjJykuY2xlYW5Jbm5lckhUTUwoKSwNCiAgICAgICAgICAgIG5vdmVsVXJsLA0KICAgICAgICAgICAgY2hhcHRlcnMsDQogICAgICAgICAgICBub3ZlbFJldmlld3MsDQogICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgIHVuZGVmaW5lZCwNCiAgICAgICAgKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlciA9IGFzeW5jICh1cmwpID0+IHsNCiAgICAgICAgcmV0dXJuIHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgbmV3IGNsaWVudCgpLmdldEh0bWwodXJsKSkuc2VsZWN0KCcucmVhZC1jb250YWluZXIgLnNlY3Rpb24tbGlzdCcpLmNsZWFuSW5uZXJIVE1MKCk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdCA9IGFzeW5jIChwYWdlKSA9PiB7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbChyZXR1cm5PYmplY3QubGF0ZXN0VXJsKSk7DQogICAgICAgIHZhciByZXN1bHQgPSBbXTsNCg0KICAgICAgICBjb250YWluZXIuZmluZCgnLnVwZGF0ZS1jb250ZW50JykuZm9yRWFjaCgoeCkgPT4gew0KICAgICAgICAgICAgdmFyIHUgPSB4LnNlbGVjdCgnLml0ZW0tdGl0bGUgYScpLmF0dHIoImhyZWYiKS50ZXh0KGZhbHNlKTsNCiAgICAgICAgICAgIHZhciB0aXRsZSA9IHguc2VsZWN0KCcuaXRlbS10aXRsZSBhJykudGV4dChmYWxzZSk7DQogICAgICAgICAgICBpZiAodSAhPSAiIiAmJiAhcmVzdWx0LmZpbmQoKHgpID0+IHUudXJpKHJldHVybk9iamVjdC51cmwpID09IHgubm92ZWwgfHwgdGl0bGUgPT0geC50aXRsZSkpDQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goDQogICAgICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0oDQogICAgICAgICAgICAgICAgICAgICAgICBhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoYXdhaXQgcmV0dXJuT2JqZWN0LmdldE5vdmVsKHUudXJpKHJldHVybk9iamVjdC51cmwpLCB0cnVlKSkuaW1hZ2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICcnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUudXJpKHJldHVybk9iamVjdC51cmwpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lDQogICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgcmV0dXJuIHJldHVybk9iamVjdDsNCn07&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50KSA9PiB7DQoJY29uc3QgcmV0dXJuT2JqZWN0ID0ge307DQoJcmV0dXJuT2JqZWN0LmlkID0gIjEucmVhZG5vdmVsZnVsbCI7DQoJcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCglyZXR1cm5PYmplY3QubmFtZSA9ICdSZWFkTm92ZWxGdWxsJzsNCglyZXR1cm5PYmplY3QuZGlzcGxheU5hbWUgPSAiUi1Ob3ZlbC1GdWxseSI7DQoJcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQoJcmV0dXJuT2JqZWN0LmxhdGVzdFVybCA9ICdodHRwczovL3JlYWRub3ZlbGZ1bGwuY29tL2xhdGVzdC1yZWxlYXNlLW5vdmVsP3BhZ2U9e3B9JzsNCglyZXR1cm5PYmplY3QudXJsID0gJ2h0dHBzOi8vcmVhZG5vdmVsZnVsbC5jb20vJzsNCglyZXR1cm5PYmplY3Quc2VhcmNoVXJsID0gJ2h0dHBzOi8vcmVhZG5vdmVsZnVsbC5jb20vc2VhcmNoP2tleXdvcmQ9e3F9JnBhZ2U9e3B9JzsNCglyZXR1cm5PYmplY3QuY2hhcHRlcnNVcmwgPSAnaHR0cHM6Ly9yZWFkbm92ZWxmdWxsLmNvbS9hamF4L2NoYXB0ZXItb3B0aW9uP25vdmVsSWQ9e2lkfSZjdXJyZW50Q2hhcHRlcklkPTEnOw0KCXJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gdHJ1ZTsNCglyZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IHRydWU7DQoJcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly9yZWFkbm92ZWxmdWxsLmNvbS9pbWcvZmF2aWNvbi5pY28nOw0KCXJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KCXJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQoJCW11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCgkJdmFsdWVzOiBbDQoJCQluZXcgbGFiZWxWYWx1ZSgnU2hvdW5lbicpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ0hhcmVtJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnQ29tZWR5JyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnTWFydGlhbCBBcnRzJywgJ01hcnRpYWwrQXJ0cycpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ1NjaG9vbCBMaWZlJywgJ1NjaG9vbCtMaWZlJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnTXlzdGVyeScpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ1Nob3VqbycpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ1JvbWFuY2UnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdTY2ktZmknKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdHZW5kZXIgQmVuZGVyJywgJ0dlbmRlcitCZW5kZXInKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdNYXR1cmUnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdGYW50YXN5JyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnSG9ycm9yJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnRHJhbWEnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdUcmFnZWR5JyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnU3VwZXJuYXR1cmFsJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnRWNjaGknKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdYdWFuaHVhbicpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ0FkdmVudHVyZScpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ1BzeWNob2xvZ2ljYWwnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdYaWFueGlhJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnV3V4aWEnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdIaXN0b3JpY2FsJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnU2xpY2Ugb2YgTGlmZScsICdTbGljZStvZitMaWZlJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnTG9saWNvbicpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ0FkdWx0JyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnSm9zZWknKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdTcG9ydHMnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdTbXV0JyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnTWVjaGEnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdZYW9pJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnU2hvdW5lbiBBaScsICdTaG91bmVuK0FpJyksDQoJCV0sDQoJfTsNCglyZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3Muc29ydFR5cGVzID0gew0KCQltdWx0aVNlbGVjdGlvbjogZmFsc2UsDQoJCXZhbHVlczogWw0KCQkJbmV3IGxhYmVsVmFsdWUoJ0xhdGVzdCBSZWxlYXNlIE5vdmVsJywgJ2xhdGVzdC1yZWxlYXNlLW5vdmVsJyksDQoJCQluZXcgbGFiZWxWYWx1ZSgnSG90IE5vdmVsJywgJ2hvdC1ub3ZlbCcpLA0KCQkJbmV3IGxhYmVsVmFsdWUoJ0NvbXBsZXRlZCBOb3ZlbCcsICdjb21wbGV0ZWQtbm92ZWwnKSwNCgkJCW5ldyBsYWJlbFZhbHVlKCdNb3N0IFBvcHVsYXInLCAnbW9zdC1wb3B1bGFyLW5vdmVsJyksDQoJCV0sDQoJfTsNCglyZXR1cm5PYmplY3QuZ2V0U2VjdGlvbnMgPSAoa2V5cykgPT4gew0KCQl2YXIgc2VjdGlvbnMgPSBbDQoJCQluZXcgU2VjdGlvbigibGF0ZXN0IiwgIkxhdGVzdCBVcGRhdGUiLCAiTGF0ZXN0IiwgdHJ1ZSksDQoJCQluZXcgU2VjdGlvbigiaG90IiwgIkhvdCBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJob3Qtbm92ZWwiKSksDQoJCQluZXcgU2VjdGlvbigiY29tcGxldGVkIiwgIkNvbXBsZXRlZCBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcih1bmRlZmluZWQsICJjb21wbGV0ZWQtbm92ZWwiKSksDQoJCQluZXcgU2VjdGlvbigicG9wdWxhciIsICJNb3N0IFBvcHVsYXIiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAibW9zdC1wb3B1bGFyLW5vdmVsIikpDQoJCV0NCgkJcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQoJfQ0KCXJldHVybk9iamVjdC50cmFuc2xhdGVTZWN0aW9uID0gYXN5bmMgKHNlY3Rpb24sIHBhZ2UpID0+IHsNCgkJaWYgKHNlY3Rpb24uaWRlbnRpZmllciA9PSAiTGF0ZXN0IikgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQoJCWVsc2UgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5zZWFyY2goc2VjdGlvbi5maWx0ZXIgfHwgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgcGFnZSk7DQoJfQ0KCXJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KCQl2YXIgZmlsdGVyID0gbmV3IEZpbHRlcigpOw0KCQlyZXR1cm4gZmlsdGVyOw0KCX07DQoJcmV0dXJuT2JqZWN0LnNlYXJjaCA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCgkJdmFyIGdlbnJlVXJsID0gImdlbnJlL3tnfT9wYWdlPXtwfSIudXJpKHJldHVybk9iamVjdC51cmwpLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQoJCXZhciBzb3J0VHlwZVVybCA9ICJ7c30/cGFnZT17cH0iLnVyaShyZXR1cm5PYmplY3QudXJsKS5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpOw0KCQl2YXIgcSA9IGZpbHRlci5nZW5yZXMubGVuZ3RoID4gMCA/IGdlbnJlVXJsLnJlcGxhY2UoIntnfSIsIGZpbHRlci5nZW5yZXNbMF0pIDogKGZpbHRlci5zb3J0VHlwZSAmJiBmaWx0ZXIuc29ydFR5cGUgIT0gJycgPyBzb3J0VHlwZVVybC5yZXBsYWNlKCJ7c30iLCBmaWx0ZXIuc29ydFR5cGUpIDogdW5kZWZpbmVkKTsNCgkJdmFyIHF1ZXJ5ID0gcSB8fCByZXR1cm5PYmplY3Quc2VhcmNoVXJsLnJlcGxhY2UoJ3txfScsIGZpbHRlci50aXRsZSB8fCAiIikucmVwbGFjZSgne3B9JywgcGFnZS50b1N0cmluZygpKTsNCgkJdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHF1ZXJ5KSk7DQoJCXZhciByZXN1bHQgPSBbXTsNCgkJY29udGFpbmVyLmZpbmQoJy5saXN0LW5vdmVsIC5yb3cnKS5mb3JFYWNoKCh4KSA9PiB7DQoJCQlpZiAoeC5zZWxlY3QoJ2ltZycpLmF0dHIoInNyYyIpLmhhc1ZhbHVlKCkpIHJlc3VsdC5wdXNoKG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoJ2ltZycpLmF0dHIoInNyYyIpLnVybCgpLnJlcGxhY2UoL1swLTldK3hbMC05XSsvZ2ksICIxNTB4MTcwIiksIHguc2VsZWN0KCcubm92ZWwtdGl0bGUgYScpLnRleHQoZmFsc2UpLCAnJywgeC5zZWxlY3QoJy5ub3ZlbC10aXRsZSBhJykuYXR0cigiaHJlZiIpLnVybCgpLCByZXR1cm5PYmplY3QubmFtZSksICk7DQoJCX0pOw0KCQlyZXR1cm4gcmVzdWx0Ow0KCX0NCglyZXR1cm5PYmplY3QuZ2V0Q2hhcHRlcnMgPSBhc3luYyAobm92ZWxVcmwsIGh0bWxDb250YWluZXIpID0+IHsNCgkJdmFyIGNoYXB0ZXJzID0gW107DQoJCXZhciB1cmwgPSByZXR1cm5PYmplY3QuY2hhcHRlcnNVcmwucmVwbGFjZSgne2lkfScsIChodG1sQ29udGFpbmVyLnNlbGVjdCgnI3JhdGluZycpLmF0dHIoImRhdGEtbm92ZWwtaWQiKS5oYXNWYWx1ZSgpID8gaHRtbENvbnRhaW5lci5zZWxlY3QoJyNyYXRpbmcnKS5hdHRyKCJkYXRhLW5vdmVsLWlkIikudGV4dCgpIDogaHRtbENvbnRhaW5lci5zZWxlY3QoJ1tkYXRhLW5vdmVsLWlkXScpLmF0dHIoImRhdGEtbm92ZWwtaWQiKS50ZXh0KCkpKTsNCgkJdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KCQljb250YWluZXIuZmluZCgnb3B0aW9uJykuZm9yRWFjaCh4ID0+IHsNCgkJCWlmICh4LmF0dHIoInZhbHVlIikuaGFzVmFsdWUoKSkgY2hhcHRlcnMucHVzaChuZXcgQ2hhcHRlcih4LnRleHQoZmFsc2UpLCB4LmF0dHIoInZhbHVlIikudXJsKCkpKTsNCgkJfSk7DQoJCXJldHVybiBjaGFwdGVyczsNCgl9DQoJcmV0dXJuT2JqZWN0LmdldE5vdmVsID0gYXN5bmMgKG5vdmVsVXJsKSA9PiB7DQoJCXZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbChub3ZlbFVybCkpOw0KCQl2YXIgY2hhcHRlcnMgPSBhd2FpdCByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlcnMobm92ZWxVcmwsIGNvbnRhaW5lcik7DQoJCXZhciBpdGVtID0gbmV3IE5vdmVsUmV2aWV3cygpOw0KCQl2YXIgaW5mbyA9IGNvbnRhaW5lci5maW5kKCcuaW5mbyBsaScpOw0KCQlpdGVtLmdlbnJlcyA9IGluZm8ud2hlcmUoeCA9PiB4LmlubmVySFRNTCgpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigiZ2VucmUiKSAhPSAtMSkuZmluZCgiYSIpLnRleHRBcnJheSgpOw0KCQlpdGVtLmF1dGhvciA9IGluZm8ud2hlcmUoeCA9PiB4LmlubmVySFRNTCgpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigiYXV0aG9yIikgIT0gLTEpLmZpbmQoImEiKS50ZXh0KGZhbHNlKQ0KCQlpdGVtLmNvbXBsZXRlZCA9IGluZm8ud2hlcmUoeCA9PiB4LmlubmVySFRNTCgpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigic3RhdHVzIikgIT0gLTEpLnRleHQoZmFsc2UpOw0KCQlpdGVtLmFsdGVybmF0aXZlTmFtZXMgPSBpbmZvLndoZXJlKHggPT4geC5pbm5lckhUTUwoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoImFsdGVybmF0aXZlIG5hbWVzIikgIT0gLTEpLnRleHQoKTsNCgkJcmV0dXJuIG5ldyBEZXRhbGlJdGVtKGNvbnRhaW5lci5zZWxlY3QoJy5ib29rIGltZycpLmF0dHIoInNyYyIpLnVybCgpLCBjb250YWluZXIuc2VsZWN0KCcudGl0bGUnKS50ZXh0KGZhbHNlKSwgY29udGFpbmVyLnNlbGVjdCgnLmRlc2MtdGV4dCcpLmNsZWFuSW5uZXJIVE1MKCksIG5vdmVsVXJsLCBjaGFwdGVycywgaXRlbSwgcmV0dXJuT2JqZWN0Lm5hbWUsIHVuZGVmaW5lZCk7DQoJfQ0KCXJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KCQlyZXR1cm4gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBuZXcgY2xpZW50KCkuZ2V0SHRtbCh1cmwpKS5zZWxlY3QoJyNjaHItY29udGVudCcpLmNsZWFuSW5uZXJIVE1MKCk7DQoJfQ0KCXJldHVybk9iamVjdC5sYXRlc3QgPSBhc3luYyAocGFnZSkgPT4gew0KCQl2YXIgdXJsID0gcmV0dXJuT2JqZWN0LmxhdGVzdFVybC5yZXBsYWNlKCd7cH0nLCBwYWdlLnRvU3RyaW5nKCkpOw0KCQl2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwodXJsKSk7DQoJCXZhciByZXN1bHQgPSBbXTsNCgkJY29udGFpbmVyLmZpbmQoJy5saXN0LW5vdmVsIC5yb3cnKS5mb3JFYWNoKCh4KSA9PiB7DQoJCQlpZiAoeC5zZWxlY3QoJ2ltZycpLmF0dHIoInNyYyIpLmhhc1ZhbHVlKCkpIHJlc3VsdC5wdXNoKG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoJ2ltZycpLmF0dHIoInNyYyIpLnVybCgpLnJlcGxhY2UoL1swLTldK3hbMC05XSsvZ2ksICIxNTB4MTcwIiksIHguc2VsZWN0KCcubm92ZWwtdGl0bGUgYScpLnRleHQoKSwgJycsIHguc2VsZWN0KCcubm92ZWwtdGl0bGUgYScpLmF0dHIoImhyZWYiKS51cmwoKSwgcmV0dXJuT2JqZWN0Lm5hbWUpLCApOw0KCQl9KTsNCgkJcmV0dXJuIHJlc3VsdDsNCgl9DQoJcmV0dXJuIHJldHVybk9iamVjdDsNCn07&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5yb3lhbHJvYWQiOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJMYW5ndWFnZSA9ICJlbiI7DQogICAgcmV0dXJuT2JqZWN0Lm5hbWUgPSAnUm95YWxSb2FkJzsNCiAgICByZXR1cm5PYmplY3QuZGlzcGxheU5hbWUgPSByZXR1cm5PYmplY3QubmFtZTsNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vd3d3LnJveWFscm9hZC5jb20vZmljdGlvbnMvbGF0ZXN0LXVwZGF0ZXM/cGFnZT17cH0nOw0KICAgIHJldHVybk9iamVjdC51cmwgPSAnaHR0cHM6Ly93d3cucm95YWxyb2FkLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL3d3dy5yb3lhbHJvYWQuY29tL2ZpY3Rpb25zL3NlYXJjaD9wYWdlPXtwfSZ0aXRsZT17cX0nOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IHRydWU7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly93d3cucm95YWxyb2FkLmNvbS9mYXZpY29uLTE2eDE2LnBuZz92PTIwMjAwMTI1JzsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MgPSBuZXcgUGFyc2VyU2VhcmNoU2V0dGluZ3MoKTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MubXVsdGlTZWxlY3Rpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJBY3Rpb24iLCAiYWN0aW9uIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQWR2ZW50dXJlIiwgImFkdmVudHVyZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkNvbWVkeSIsICJjb21lZHkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJDb250ZW1wb3JhcnkiLCAiY29udGVtcG9yYXJ5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRHJhbWEiLCAiZHJhbWEiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJQc3ljaG9sb2dpY2FsIiwgInBzeWNob2xvZ2ljYWwiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJSb21hbmNlIiwgInJvbWFuY2UiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTYXRpcmUiLCAic2F0aXJlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2NpLUZpIiwgInNjaV9maSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNob3J0IFN0b3J5IiwgIm9uZV9zaG90IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVHJhZ2VkeSIsICJ0cmFnZWR5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRmFudGFzeSIsICJmYW50YXN5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTXlzdGVyeSIsICJteXN0ZXJ5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGlzdG9yaWNhbCIsICJoaXN0b3JpY2FsIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSG9ycm9yIiwgImhvcnJvciIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1hZ2ljIiwgIm1hZ2ljIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQW50aS1IZXJvIExlYWQiLCAiYW50aS1oZXJvX2xlYWQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJBcnRpZmljaWFsIEludGVsbGlnZW5jZSIsICJhcnRpZmljaWFsX2ludGVsbGlnZW5jZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkF0dHJhY3RpdmUgTUMiLCAiYXR0cmFjdGl2ZV9tYyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkN5YmVycHVuayIsICJjeWJlcnB1bmsiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJEdW5nZW9uIiwgImR1bmdlb24iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJEeXN0b3BpYSIsICJkeXN0b3BpYSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkZlbWFsZSBMZWFkIiwgImZlbWFsZV9sZWFkIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRmlyc3QgQ29udGFjdCIsICJGaXJzdF9Db250YWN0IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR2FtZUxpdCIsICJHYW1lTGl0IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR2VuZGVyIEJlbmRlciIsICJnZW5kZXJfYmVuZGVyIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR2VuZXRpY2FsbHkgRW5naW5lZXJlZCIsICJHZW5ldGljYWxseV9FbmdpbmVlcmVkIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR3JpbWRhcmsiLCAiR3JpbWRhcmsiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIYXJkIFNjaS1maSIsICJIYXJkX1NjaV9maSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhhcmVtIiwgImhhcmVtIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGlnaCBGYW50YXN5IiwgImhpZ2hfZmFudGFzeSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkxpdFJQRyIsICJMaXRSUEciKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJMb29wIiwgIkxvb3AiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJMb3cgRmFudGFzeSIsICJsb3dfZmFudGFzeSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1hbGUgTGVhZCIsICJtYWxlX2xlYWQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNYXJ0aWFsIEFydHMiLCAibWFydGlhbF9hcnRzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTXVsdGlwbGUgTGVhZCBDaGFyYWN0ZXJzIiwgIm11dGxpcGxlX2xlYWQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNeXRob3MiLCAibXl0aG9zIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTm9uLUh1bWFuIGxlYWQiLCAibm9uLWh1bWFuX2xlYWQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJQb3J0YWwgRmFudGFzeSAvIElzZWthaSIsICJzdW1tb25lZF9oZXJvIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUG9zdCBBcG9jYWx5cHRpYyIsICJwb3N0X2Fwb2NhbHlwdGljIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUHJvZ3Jlc3Npb24iLCAicHJvZ3Jlc3Npb24iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJSZWFkZXIgaW50ZXJhY3RpdmUiLCAicmVhZGVyX2ludGVyYWN0aXZlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUmVpbmNhcm5hdGlvbiIsICJyZWluY2FybmF0aW9uIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUnVsaW5nIENsYXNzIiwgInJ1bGluZ19jbGFzcyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNjaG9vbCBMaWZlIiwgInNjaG9vbF9saWZlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2VjcmV0IElkZW50aXR5IiwgInNlY3JldF9pZGVudGl0eSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNsaWNlIG9mIExpZmUiLCAic2xpY2Vfb2ZfbGlmZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNvZnQgU2NpLWZpIiwgIlNvZnRfU2NpX2ZpIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU3BhY2UgT3BlcmEiLCAic3BhY2Vfb3BlcmEiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTcG9ydHMiLCAic3BvcnRzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU3RlYW1wdW5rIiwgInN0ZWFtcHVuayIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlN0cmF0ZWd5IiwgInN0cmF0ZWd5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU3Ryb25nIExlYWQiLCAic3Ryb25nX2xlYWQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTdXBlciBIZXJvZXMiLCAic3VwZXJfaGVyb2VzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU3VwZXJuYXR1cmFsIiwgInN1cGVybmF0dXJhbCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlRlY2hub2xvZ2ljYWxseSBFbmdpbmVlcmVkIiwgIlRlY2hub2xvZ2ljYWxseV9FbmdpbmVlcmVkIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVGltZSBUcmF2ZWwiLCAiVGltZV9UcmF2ZWwiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJVcmJhbiBGYW50YXN5IiwgInVyYmFuX2ZhbnRhc3kiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJWaWxsYWlub3VzIExlYWQiLCAidmlsbGFpbm91c19sZWFkIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVmlydHVhbCBSZWFsaXR5IiwgInZpcnR1YWxfcmVhbGl0eSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIldhciBhbmQgTWlsaXRhcnkiLCAid2FyX2FuZF9taWxpdGFyeSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIld1eGlhIiwgInd1eGlhIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiWGlhbnhpYSIsICJ4aWFueGlhIikNCiAgICAgICAgXQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zdGF0dXNlcyA9IHsNCiAgICAgICAgbXVsdGlTZWxlY3Rpb246IHRydWUsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkNvbXBsZXRlZCIsICJDT01QTEVURUQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJPbmdvaW5nIiwgIk9OR09JTkciKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIaWF0dXMiLCAiSElBVFVTIiksDQoNCiAgICAgICAgXQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5sYW5ndWFnZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRmFuIEZpY3Rpb24iLCAiZmFuZmljdGlvbiIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk9yaWdpbmFsIiwgIm9yaWdpbmFsIikNCiAgICAgICAgXQ0KICAgIH0NCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldFNlY3Rpb25zID0gKGtleXMpID0+IHsNCiAgICAgICAgdmFyIHNlY3Rpb25zID0gWw0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImxhdGVzdCIsICJMYXRlc3QgVXBkYXRlIiwgIkxhdGVzdCIsIHRydWUpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImNvbXBsZXRlZCIsICJDb21wbGV0ZWQiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgIkNPTVBMRVRFRCIpKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJvbmdvaW5nIiwgIk9uZ29pbmciLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgIk9OR09JTkciKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigicm9tYW5jZSIsICJSb21hbmNlIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsicm9tYW5jZSJdKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiYWN0aW9uIiwgIkFjdGlvbiIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcihbImFjdGlvbiJdKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibXlzdGVyeSIsICJNeXN0ZXJ5IiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsibXlzdGVyeSJdKSksDQogICAgICAgIF0NCg0KICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmlsdGVyKHggPT4gIWtleXMgfHwga2V5cy5pbmNsdWRlcyh4Lm5hbWUpKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QudHJhbnNsYXRlU2VjdGlvbiA9IGFzeW5jIChzZWN0aW9uLCBwYWdlKSA9PiB7DQogICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmxhdGVzdChwYWdlKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5zZWFyY2goc2VjdGlvbi5maWx0ZXIgfHwgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgcGFnZSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIgPSAoKSA9PiB7DQogICAgICAgIHZhciBmaWx0ZXIgPSBuZXcgRmlsdGVyKCk7DQogICAgICAgIHJldHVybiBmaWx0ZXI7DQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3Quc2VhcmNoVXJsLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSkucmVwbGFjZSgie3F9IiwgZmlsdGVyLnRpdGxlIHx8ICIiKTsNCiAgICAgICAgaWYgKGZpbHRlci5nZW5yZXMubGVuZ3RoID4gMCkNCiAgICAgICAgICAgIHVybCArPSAiJiIgKyBmaWx0ZXIuZ2VucmVzLm1hcCh4ID0+ICJ0YWdzQWRkPSIgKyB4KS5qb2luKCImIikNCg0KICAgICAgICBpZiAoZmlsdGVyLmFjdGl2ZSAmJiBmaWx0ZXIuYWN0aXZlICE9ICIiKQ0KICAgICAgICAgICAgdXJsICs9ICImc3RhdHVzPSIgKyBmaWx0ZXIuYWN0aXZlOw0KDQogICAgICAgIGlmIChmaWx0ZXIubGFuZ3VhZ2UgJiYgZmlsdGVyLmxhbmd1YWdlICE9ICIiKQ0KICAgICAgICAgICAgdXJsICs9ICImdHlwZT0iICsgZmlsdGVyLmxhbmd1YWdlOw0KDQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLmZpY3Rpb24tbGlzdC1pdGVtIikuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBMaWdodEl0ZW0oeC5zZWxlY3QoImltZyIpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCIuZmljdGlvbi10aXRsZSIpLnRleHQoKSwNCiAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLmZpY3Rpb24tdGl0bGUgYSIpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldE5vdmVsPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsKSk7DQogICAgICAgIHZhciBjaGFwdGVycyA9IGNvbnRhaW5lci5maW5kKCIjY2hhcHRlcnMgdGJvZHkgdHIiKS5tYXAoeCA9PiB4LnNlbGVjdCgiYSIpKS5maWx0ZXIoeCA9PiB4Lmhhc0VsZW1lbnQoKSkubWFwKHggPT4gbmV3IENoYXB0ZXIoeC50ZXh0KCksIHguYXR0cigiaHJlZiIpLnVybCgpKSk7DQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIHZhciBpbmZvcyA9IGNvbnRhaW5lci5zZWxlY3QoIi5maWN0aW9uLWluZm8gLmNvbC1tZC04Iik7DQoNCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGluZm9zLmZpbmQoIi50YWdzIGEiKS50ZXh0QXJyYXkoKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmF1dGhvciA9IGNvbnRhaW5lci5zZWxlY3QoIi5maWMtdGl0bGUgc3Bhbltwcm9wZXJ0eT1uYW1lXSIpLnRleHQoKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmRlc2NyaXB0aW9uID0gY29udGFpbmVyLnNlbGVjdCgiLmRlc2NyaXB0aW9uIikuY2xlYW5Jbm5lckhUTUwoKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmNvbXBsZXRlZCA9IGNvbnRhaW5lci5zZWxlY3QoIi50YWdzIikuY2xvc2VzdCgiZGl2IikuZmluZCgic3BhbiIpLndoZXJlKHg9PiB4LmlubmVySFRNTCgpLmluZGV4T2YoIkNPTVBMRVRFRCIpICE9IC0xKS5oYXNFbGVtZW50cygpID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIg0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCIudGV4dC1jZW50ZXIgaW1nIikuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCIuZmljLXRpdGxlIGgxIikudGV4dChmYWxzZSksDQogICAgICAgICAgICBub3ZlbFJldmlld3MuZGVzY3JpcHRpb24sDQogICAgICAgICAgICBub3ZlbFVybCwNCiAgICAgICAgICAgIGNoYXB0ZXJzLA0KICAgICAgICAgICAgbm92ZWxSZXZpZXdzLA0KICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUsDQogICAgICAgICAgICB1bmRlZmluZWQsDQogICAgICAgICk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXIgPSBhc3luYyAodXJsKT0+IHsNCiAgICAgICAgcmV0dXJuIHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgbmV3IGNsaWVudCgpLmdldEh0bWwodXJsKSkuc2VsZWN0KCIuY2hhcHRlci1jb250ZW50IikuY2xlYW5Jbm5lckhUTUwoKTsNCg0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5sYXRlc3Q9IGFzeW5jIChwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3QubGF0ZXN0VXJsLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuc2VsZWN0KCIuZmljdGlvbi1saXN0LWl0ZW0iKS5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbSgNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiaW1nIikuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoIi5maWN0aW9uLXRpdGxlIikudGV4dChmYWxzZSksDQogICAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoIi5maWN0aW9uLXRpdGxlIGEiKS5hdHRyKCJocmVmIikudXJsKCksDQogICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUpKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm4gcmV0dXJuT2JqZWN0Ow0KDQp9Ow==&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS5zY3JpYmJsZWh1YiI7DQogICAgcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCiAgICByZXR1cm5PYmplY3QubmFtZSA9ICdTY3JpYmJsZUh1Yic7DQogICAgcmV0dXJuT2JqZWN0LmRpc3BsYXlOYW1lID0gIlItTm92ZWwtSHViIjsNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vd3d3LnNjcmliYmxlaHViLmNvbS8/cGc9e3B9JzsNCiAgICByZXR1cm5PYmplY3QudXJsID0gJ2h0dHBzOi8vd3d3LnNjcmliYmxlaHViLmNvbSc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL3d3dy5zY3JpYmJsZWh1Yi5jb20vP3M9e3F9JnBvc3RfdHlwZT1maWN0aW9ucG9zdHMnOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IGZhbHNlOw0KICAgIHJldHVybk9iamVjdC5pY29uID0gJ2h0dHBzOi8vd3d3LnNjcmliYmxlaHViLmNvbS9mYXZpY29uLmljbyc7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzID0gbmV3IFBhcnNlclNlYXJjaFNldHRpbmdzKCk7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLm11bHRpU2VsZWN0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3Muc29ydFR5cGVzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NoYXB0ZXJzIHBlciBXZWVrJywgImZyZXF1ZW5jeSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0RhdGUgQWRkZWQnLCAiZGF0ZWFkZGVkIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRmF2b3JpdGVzJywgImZhdm9yaXRlcyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0xhc3QgVXBkYXRlJywgImxhc3RjaHBkYXRlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTnVtYmVyIG9mIFJhdGluZ3MnLCAibnVtb2ZyYXRlIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUGFnZXMnLCAicGFnZXMiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdQYWdldmlld3MnLCAicGFnZXZpZXdzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUmF0aW5ncycsICJyYXRpbmdzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnUmVhZGVycycsICJyZWFkZXJzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVG90YWwgV29yZHMnLCAidG90YWx3b3JkcyIpLA0KICAgICAgICBdLA0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MuZ2VucmVzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogdHJ1ZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQWN0aW9uIiwgOSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQ29tZWR5IiwgNyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRmFudGFzeSIsIDE5KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIaXN0b3JpY2FsIiwgMjEpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkxpdFJQRyIsIDExODApLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk15c3RlcnkiLCA5MDkpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNjaS1maSIsIDkxMiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQWR1bHQiLCA5MDIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkRyYW1hIiwgOTAzKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJHZW5kZXIgQmVuZGVyIiwgOTA1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIb3Jyb3IiLCAyMiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWFydGlhbCBBcnRzIiwgOTA3KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJQc3ljaG9sb2dpY2FsIiwgOTEwKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTZWluZW4iLCA5MTMpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlN1cGVybmF0dXJhbCIsIDUpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkFkdmVudHVyZSIsIDgpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkVjY2hpIiwgOTA0KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJHaXJscyBMb3ZlIiwgODkyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJJc2VrYWkiLCAzNyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWF0dXJlIiwgMjApLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlJvbWFuY2UiLCA2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTbGljZSBvZiBMaWZlIiwgOTE0KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJUcmFnZWR5IiwgOTAxKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJCb3lzIExvdmUiLCA4OTEpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkZhbmZpY3Rpb24iLCAzOCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGFyZW0iLCAxMDE1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJKb3NlaSIsIDkwNiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWVjaGEiLCA5MDgpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNjaG9vbCBMaWZlIiwgOTExKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTbXV0IiwgOTE1KSwNCg0KICAgICAgICBdDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnN0YXR1c2VzID0gew0KICAgICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkFsbCIsICJhbGwiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJDb21wbGV0ZWQiLCAiY29tcGxldGVkIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiT25nb2luZyIsICJvbmdvaW5nIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGlhdHVzIiwgImhpYXR1cyIpDQogICAgICAgIF0NCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0U2VjdGlvbnMgPSAoa2V5cykgPT4gew0KICAgICAgICB2YXIgc2VjdGlvbnMgPSBbDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibGF0ZXN0IiwgIkxhdGVzdCBVcGRhdGUiLCAiTGF0ZXN0IiwgdHJ1ZSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigicG9wdWxhciIsICJQb3B1bGFyIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgInBhZ2V2aWV3cyIpKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJmYXZvcml0ZXMiLCAiRmF2b3JpdGVzIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgImZhdm9yaXRlcyIpKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJjb21wbGV0ZWQiLCAiQ29tcGxldGVkIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsICJjb21wbGV0ZWQiKSkNCiAgICAgICAgXQ0KDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC50cmFuc2xhdGVTZWN0aW9uID0gYXN5bmMgKHNlY3Rpb24sIHBhZ2UpID0+IHsNCiAgICAgICAgaWYgKHNlY3Rpb24uaWRlbnRpZmllciA9PSAiTGF0ZXN0IikNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QubGF0ZXN0KHBhZ2UpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LnNlYXJjaChzZWN0aW9uLmZpbHRlciB8fCByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlcigpLCBwYWdlKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZGVmYXVsdEZpbHRlciA9ICgpID0+IHsNCiAgICAgICAgdmFyIGZpbHRlciA9IG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAicGFnZXZpZXdzIiwgdW5kZWZpbmVkLCAiYWxsIik7DQogICAgICAgIHJldHVybiBmaWx0ZXI7DQogICAgfTsNCg0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciBzb3J0VHlwZVVyaSA9ICJodHRwczovL3d3dy5zY3JpYmJsZWh1Yi5jb20vc2VyaWVzLWZpbmRlci8/c2Y9MSZnaT17Z30mbWdpPWFuZCZzb3J0PXtzb3J0fSZvcmRlcj1kZXNjJmNwPXtzdGF0dXN9JnBnPSIgKyBwYWdlOw0KICAgICAgICB2YXIgc29ydFR5cGVVcmwgPSBzb3J0VHlwZVVyaS5yZXBsYWNlKCJ7Z30iLCBmaWx0ZXIuZ2VucmVzLmpvaW4oIiwiKSkucmVwbGFjZSgie3NvcnR9IiwgZmlsdGVyLnNvcnRUeXBlKS5yZXBsYWNlKCJ7c3RhdHVzfSIsIGZpbHRlci5hY3RpdmUpOw0KDQogICAgICAgIHZhciB1cmwgPSBmaWx0ZXIudGl0bGUgJiYgZmlsdGVyLnRpdGxlLmxlbmd0aCA+IDAgPyByZXR1cm5PYmplY3Quc2VhcmNoVXJsLnJlcGxhY2UoIntxfSIsIGZpbHRlci50aXRsZSkgOiBzb3J0VHlwZVVybDsNCg0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwodXJsKSk7DQogICAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgICAgY29udGFpbmVyLmZpbmQoIi5zZWFyY2hfbWFpbl9ib3giKS5mb3JFYWNoKHggPT4gew0KICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbSgNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiaW1nIikuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoIi5zZWFyY2hfdGl0bGUiKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnNlYXJjaF90aXRsZSBhIikuYXR0cigiaHJlZiIpLnVybCgpLA0KICAgICAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lKSk7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXJzID0gYXN5bmMgKGlkKSA9PiB7DQogICAgICAgIGNvbnNvbGUubG9nKCJzdHJTSUQ6IiArIGlkKQ0KICAgICAgICB2YXIgaHRtbCA9IGF3YWl0IEh0dHBDbGllbnQucG9zdEZvcm0oImh0dHBzOi8vd3d3LnNjcmliYmxlaHViLmNvbS93cC1hZG1pbi9hZG1pbi1hamF4LnBocCIsIHsNCiAgICAgICAgICAgIGFjdGlvbjogIndpX2dldHRvY2NocCIsDQogICAgICAgICAgICBzdHJTSUQ6IHBhcnNlSW50KGlkKSwNCiAgICAgICAgICAgIHN0cm15cG9zdGlkOiAwLA0KICAgICAgICAgICAgc3RyRmljOiAieWVzIg0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJldHVybk9iamVjdC5wYXJzZXIuanEoSHR0cENsaWVudC5wYXJzZUh0bWwoaHRtbCkpLmZpbmQoImEiKS5tYXAoeCA9PiBuZXcgQ2hhcHRlcih4LnRleHQoZmFsc2UpLCB4LmF0dHIoImhyZWYiKS51cmwoKSkpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXROb3ZlbCA9IGFzeW5jIChub3ZlbFVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwpKTsNCiAgICAgICAgdmFyIGlkID0gY29udGFpbmVyLnNlbGVjdCgiI215cG9zdGlkIikubm9kZVZhbHVlKCkgPyBjb250YWluZXIuc2VsZWN0KCIjbXlwb3N0aWQiKS5ub2RlVmFsdWUoKSA6IG5vdmVsVXJsLnNwbGl0KCIvIilbbm92ZWxVcmwuc3BsaXQoIi8iKS5pbmRleE9mKCJzZXJpZXMiKSArIDFdOw0KICAgICAgICB2YXIgY2hhcHRlcnMgPSBhd2FpdCByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlcnMoaWQgfHwgIiIpOw0KICAgICAgICB2YXIgcmVnID0gbmV3IFJlZ0V4cCgvIihyYXRpbmdWYWx1ZSkiOiIoKFxcInxbXiJdKSopIi8sICJpIikNCiAgICAgICAgdmFyIHJlcyA9IHJlZy5leGVjKGNvbnRhaW5lci5pbm5lckhUTUwoKSk7DQogICAgICAgIHZhciByYXRlID0gZXZhbCgocmVzICYmIHJlcy5sZW5ndGggPiAwID8gKHJlcy5maW5kQXQoMCkgfHwgIiIpLnNwbGl0KCI6IikubGFzdCgpIHx8ICIiIDogIjEiKSk7DQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIG5vdmVsUmV2aWV3cy5hdXRob3IgPSBjb250YWluZXIuc2VsZWN0KCJbcHJvcGVydHk9J2F1dGhvciddIC5hdXRoX25hbWVfZmljIikudGV4dChmYWxzZSk7DQogICAgICAgIG5vdmVsUmV2aWV3cy5nZW5yZXMgPSBjb250YWluZXIuZmluZCgiLndpX2ZpY19nZW5yZSBhIikudGV4dEFycmF5KCk7DQogICAgICAgIG5vdmVsUmV2aWV3cy51dm90ZXMgPSAiUmF0aW5nOiIgKyBwYXJzZUludChyYXRlID8gcmF0ZSA6ICIxIikudG9GaXhlZCgwKSArICIvNSI7DQogICAgICAgIG5vdmVsUmV2aWV3cy5jb21wbGV0ZWQgPSBjb250YWluZXIuc2VsZWN0KCIud2lkZ2V0X2ZpY19zaW1pbGFyIikudGV4dChmYWxzZSkuaW5kZXhPZigiQ29tcGxldGVkIikgIT0gLTEgPyAiU3RhdHVzOkNvbXBsZXRlZCIgOiAiU3RhdHVzOk9uZ29pbmciOw0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCIubm92ZWwtY292ZXIgaW1nIikuYXR0cigic3JjIikudXJsKCksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcuZmljX3RpdGxlJykudGV4dChmYWxzZSksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcud2lfZmljX2Rlc2MnKS5jbGVhbklubmVySFRNTCgpLA0KICAgICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgICBjaGFwdGVycy5yZXZlcnNlKCksDQogICAgICAgICAgICBub3ZlbFJldmlld3MsDQogICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgIHVuZGVmaW5lZCwNCiAgICAgICAgKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlciA9IGFzeW5jICh1cmwpID0+IHsNCiAgICAgICAgcmV0dXJuIHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgbmV3IGNsaWVudCgpLmdldEh0bWwodXJsKSkuc2VsZWN0KCIuY2hwX3JhdyIpLmNsZWFuSW5uZXJIVE1MKCk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmxhdGVzdCA9IGFzeW5jIChwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSByZXR1cm5PYmplY3QubGF0ZXN0VXJsLnJlcGxhY2UoIntwfSIsIHBhZ2UudG9TdHJpbmcoKSk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICBjb250YWluZXIuc2VsZWN0KCIjbWFpbl9yZWxlYXNlcyB0ZCIpLmZvckVhY2goeCA9PiB7DQogICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJpbWciKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLmZwX3RpdGxlIikudGV4dChmYWxzZSksDQogICAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgICAgeC5zZWxlY3QoIi5mcF90aXRsZSIpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSkpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm4gcmV0dXJuT2JqZWN0Ow0KDQp9Ow==&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS50YXByZWFkIjsNCiAgICByZXR1cm5PYmplY3QuZGV0YWxpSXRlbVR5cGUgPSBEZXRhbGlJdGVtVHlwZS5Ob3ZlbDsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyTGFuZ3VhZ2UgPSAiZW4iOw0KICAgIHJldHVybk9iamVjdC5uYW1lID0gJ1RhcFJlYWQnOw0KICAgIHJldHVybk9iamVjdC5kaXNwbGF5TmFtZSA9ICJULU5vdmVsLVJlYWQiOw0KICAgIHJldHVybk9iamVjdC5sYXRlc3RVcmwgPSAnaHR0cHM6Ly93d3cudGFwcmVhZC5jb20vYWpheC9ib29rL2xhc3R1cGRhdGVsaXN0JzsNCiAgICByZXR1cm5PYmplY3QudXJsID0gJ2h0dHBzOi8vd3d3LnRhcHJlYWQuY29tLyc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL3d3dy50YXByZWFkLmNvbS9hamF4L3NlYXJjaC9zdG9yeSc7DQogICAgcmV0dXJuT2JqZWN0LnBhbmluYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hQYWdpbmF0aW9uID0gZmFsc2U7DQogICAgcmV0dXJuT2JqZWN0Lmljb24gPSAnaHR0cHM6Ly9zdGF0aWMudGFwcmVhZC5jb20vcGMvaW1hZ2VzL2Zhdmljb24uaWNvJzsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MgPSBuZXcgUGFyc2VyU2VhcmNoU2V0dGluZ3MoKTsNCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiQWxsIiwgMCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiV3V4aWEmWGlhbnhpYSIsIDEpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkZhbnRhc3kiLCAyKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJSb21hbmNlIiwgMyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTEdCVCsiLCA0MyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVXJiYW4iLCA0NCksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiR2FtZXMiLCA0NSksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiRWFzdGVybiIsIDQ2KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJIb3Jyb3ImVGhyaWxsZXIiLCA0NyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSGlzdG9yaWNhbCIsIDc1KSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTY2ktRmkiLCA3NiksDQoNCiAgICAgICAgXQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJob3Jyb3IiLCAiSG9ycm9yJlRocmlsbGVyIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFs0N10pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJyb21hbmNlIiwgIlJvbWFuY2UiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIoWzNdKSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigiZmFudGFzeSIsICJGYW50YXN5IiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsyXSkpLA0KICAgICAgICBdDQoNCiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcih4ID0+ICFrZXlzIHx8IGtleXMuaW5jbHVkZXMoeC5uYW1lKSk7DQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICB2YXIgZmlsdGVyID0gbmV3IEZpbHRlcigpOw0KICAgICAgICByZXR1cm4gZmlsdGVyOw0KICAgIH07DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0R2VucmUgPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSAiaHR0cHM6Ly93d3cudGFwcmVhZC5jb20vYWpheC9jYXRlZ29yeS9kZXRhaWwiOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIHZhciBkYXRhID0gYXdhaXQgSHR0cENsaWVudC5wb3N0Rm9ybSh1cmwsIHsgY2F0ZUlkOiBmaWx0ZXIuZ2VucmVzWzBdLCBwYWdlTm86IHBhZ2UgfSk7DQogICAgICAgIGlmIChkYXRhICYmIGRhdGEucmVzdWx0ICYmIGRhdGEucmVzdWx0LmJvb2tMaXN0KSB7DQogICAgICAgICAgICBkYXRhLnJlc3VsdC5ib29rTGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbShhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoYXdhaXQgcmV0dXJuT2JqZWN0LmdldE5vdmVsKGl0ZW0uYm9va0lkLCB0cnVlKSkuaW1hZ2UNCiAgICAgICAgICAgICAgICB9LCBpdGVtLmJvb2tOYW1lLCBpdGVtLmRlc2NyaXB0aW9uLCBpdGVtLmJvb2tJZCwgcmV0dXJuT2JqZWN0Lm5hbWUpKQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaCA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCiAgICAgICAgaWYgKGZpbHRlci5nZW5yZXMubGVuZ3RoID4gMCkNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QuZ2V0R2VucmUoZmlsdGVyLCBwYWdlKTsNCg0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIHZhciBkYXRhID0gYXdhaXQgSHR0cENsaWVudC5wb3N0Rm9ybShyZXR1cm5PYmplY3Quc2VhcmNoVXJsLCB7IHNlYXJjaFRleHQ6IGZpbHRlci50aXRsZSB8fCAiIiwgc3RvcnlUeXBlOiAxLCBwYWdlTm86IHBhZ2UgfSk7DQogICAgICAgIGlmIChkYXRhICYmIGRhdGEucmVzdWx0ICYmIGRhdGEucmVzdWx0LnN0b3J5TGlzdCkgew0KICAgICAgICAgICAgZGF0YS5yZXN1bHQuc3RvcnlMaXN0LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXcgTGlnaHRJdGVtKGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChhd2FpdCByZXR1cm5PYmplY3QuZ2V0Tm92ZWwoaXRlbS5zdG9yeUlkLCB0cnVlKSkuaW1hZ2UNCiAgICAgICAgICAgICAgICB9LCBpdGVtLnN0b3J5TmFtZSwgIiIsIGl0ZW0uc3RvcnlJZCwgcmV0dXJuT2JqZWN0Lm5hbWUpKQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVycyA9IGFzeW5jIChib29rSWQpID0+IHsNCiAgICAgICAgdmFyIGRhdGEgPSBhd2FpdCBIdHRwQ2xpZW50LnBvc3RGb3JtKCJodHRwczovL3d3dy50YXByZWFkLmNvbS9hamF4L2Jvb2svY29udGVudHMiLCB7IGJvb2tJZDogYm9va0lkIH0pOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGlmIChkYXRhICYmIGRhdGEucmVzdWx0ICYmIGRhdGEucmVzdWx0LmNoYXB0ZXJMaXN0KQ0KICAgICAgICAgICAgZGF0YS5yZXN1bHQuY2hhcHRlckxpc3QuZm9yRWFjaChpdGVtID0+IHsNCiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXcgQ2hhcHRlcihpdGVtLmNoYXB0ZXJOYW1lLCAoaXRlbS5ib29rSWQgKyAiLyIgKyBpdGVtLmNoYXB0ZXJJZCkudXJpKCJodHRwczovL3d3dy50YXByZWFkLmNvbS9hamF4L2Jvb2svY2hhcHRlciIpKSkNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQoNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Tm92ZWwgPSBhc3luYyAobm92ZWxVcmwsIGlnbm9yZWNoYXB0ZXJzKSA9PiB7DQogICAgICAgIG5vdmVsVXJsID0gcGFyc2VJbnQobm92ZWxVcmwpLnRvU3RyaW5nKCk7DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbChub3ZlbFVybC50b1N0cmluZygpLnVyaSgiaHR0cHM6Ly93d3cudGFwcmVhZC5jb20vYm9vay9kZXRhaWwvIiksIGlnbm9yZWNoYXB0ZXJzKSk7DQogICAgICAgIHZhciBjaGFwdGVycyA9ICFpZ25vcmVjaGFwdGVycyA/IGF3YWl0IHJldHVybk9iamVjdC5nZXRDaGFwdGVycyhub3ZlbFVybCkgOiBbXTsNCiAgICAgICAgdmFyIG5vdmVsUmV2aWV3cyA9IG5ldyBOb3ZlbFJldmlld3MoKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGNvbnRhaW5lci5maW5kKCIuYmFzZS1pbmZvIC5ib29rLWNhdGFsb2cgLnR4dCIpLnRleHRBcnJheSgpOw0KICAgICAgICBub3ZlbFJldmlld3MuYXV0aG9yID0gY29udGFpbmVyLnNlbGVjdCgiLmF1dGhvciAubmFtZSIpLnRleHQoZmFsc2UpOw0KICAgICAgICBub3ZlbFJldmlld3MudXZvdGVzID0gY29udGFpbmVyLnNlbGVjdCgiLnNjb3JlIikudGV4dCgpICsgIiAvIDUiOw0KICAgICAgICBub3ZlbFJldmlld3MuY29tcGxldGVkID0gY29udGFpbmVyLnNlbGVjdCgiLmJhc2UtaW5mbyAuYm9vay1zdGF0ZSAudHh0IikudGV4dChmYWxzZSkgPT09ICJDb21wbGV0ZWQiID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIjsNCiAgICAgICAgcmV0dXJuIG5ldyBEZXRhbGlJdGVtKA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmJvb2staW1nIGltZycpLmF0dHIoInNyYyIpLnVybCgpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmJvb2stbmFtZScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmRlc2MnKS5jbGVhbklubmVySFRNTCgpLA0KICAgICAgICAgICAgbm92ZWxVcmwsDQogICAgICAgICAgICBjaGFwdGVycywNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5uYW1lLA0KICAgICAgICAgICAgdW5kZWZpbmVkLA0KICAgICAgICApOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICB2YXIgdXJsQ29udGVudCA9IHVybC5zcGxpdCgiLyIpOw0KICAgICAgICB2YXIgYm9va0lkID0gdXJsQ29udGVudFt1cmxDb250ZW50Lmxlbmd0aCAtIDJdOw0KICAgICAgICB2YXIgY2hhcHRlcklkID0gdXJsQ29udGVudFt1cmxDb250ZW50Lmxlbmd0aCAtIDFdOw0KICAgICAgICBjb25zb2xlLmxvZygiYm9va0lkOiIgKyBib29rSWQpDQogICAgICAgIGNvbnNvbGUubG9nKCJjaGFwdGVySWQ6IiArIGNoYXB0ZXJJZCkNCiAgICAgICAgdmFyIGRhdGEgPSBhd2FpdCBuZXcgY2xpZW50KCkucG9zdEZvcm0oImh0dHBzOi8vd3d3LnRhcHJlYWQuY29tL2FqYXgvYm9vay9jaGFwdGVyIiwgeyBib29rSWQ6IGJvb2tJZCwgY2hhcHRlcklkOiBjaGFwdGVySWQgfSkNCiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5yZXN1bHQpDQogICAgICAgICAgICByZXR1cm4gZGF0YS5yZXN1bHQuY29udGVudDsNCiAgICAgICAgcmV0dXJuICJTb21ldGhpbmcgd2VudCB3cm9uZyI7DQoNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0ID0gYXN5bmMgKHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHVybCA9IHJldHVybk9iamVjdC5sYXRlc3RVcmw7DQogICAgICAgIHZhciBkYXRhID0gYXdhaXQgSHR0cENsaWVudC5wb3N0Rm9ybSh1cmwsIHsgYW1vdW10OiAwLCBwYWdlTm86IHBhZ2UgfSk7DQogICAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5yZXN1bHQgJiYgZGF0YS5yZXN1bHQpIHsNCiAgICAgICAgICAgIGRhdGEucmVzdWx0LmZvckVhY2goaXRlbSA9PiB7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IExpZ2h0SXRlbShhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoYXdhaXQgcmV0dXJuT2JqZWN0LmdldE5vdmVsKGl0ZW0uYm9va0lkLCB0cnVlKSkuaW1hZ2UNCiAgICAgICAgICAgICAgICB9LCBpdGVtLnRpdGxlLCAiIiwgaXRlbS5ib29rSWQsIHJldHVybk9iamVjdC5uYW1lKSkNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICByZXR1cm4gcmV0dXJuT2JqZWN0Ow0KfTs=&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS53dXhpYXdvcmxkIjsNCiAgICByZXR1cm5PYmplY3QuZGV0YWxpSXRlbVR5cGUgPSBEZXRhbGlJdGVtVHlwZS5Ob3ZlbDsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyTGFuZ3VhZ2UgPSAiZW4iOw0KICAgIHJldHVybk9iamVjdC5uYW1lID0gJ1d1eGlhd29ybGQnOw0KICAgIHJldHVybk9iamVjdC5kaXNwbGF5TmFtZSA9ICJXLU5vdmVsLVdvcmxkIjsNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vd3d3Lnd1eGlhd29ybGQuY29tL3VwZGF0ZXMnOw0KICAgIHJldHVybk9iamVjdC51cmwgPSAnaHR0cHM6Ly93d3cud3V4aWF3b3JsZC5jb20nOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hVcmwgPSAnaHR0cHM6Ly93d3cud3V4aWF3b3JsZC5jb20vYXBpL25vdmVscy9zZWFyY2gnOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gZmFsc2U7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFBhZ2luYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5pY29uID0gJ2h0dHBzOi8vd3d3Lnd1eGlhd29ybGQuY29tL2Zhdmljb24tMzJ4MzIucG5nP3Y9andFa0tYdzhQWSc7DQoNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MgPSBuZXcgUGFyc2VyU2VhcmNoU2V0dGluZ3MoKTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MubXVsdGlTZWxlY3Rpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPQ0KICAgIHsNCiAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgdmFsdWVzOiBbDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBY3Rpb24nKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NoZWF0IFN5c3RlbXMnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0Nvb2tpbmcnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0FsY2hlbXknKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NyYWZ0aW5nJyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDb21lZHknKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0ZhbnRhc3knKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0hhcmVtJyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNYXR1cmUnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0tpbmdkb20gQnVpbGRpbmcnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ01vZGVybiBTZXR0aW5nJyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNeXN0ZXJ5JyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdQb2xpdGljYWwgSW50cmlndWUnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1BldHMnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1Bvc3QtYXBvY2FseXB0aWMnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1JvbWFuY2UnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0ZlbWFsZSBQcm90YWdvbmlzdCcpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU2NpLWZpJyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdUaHJpbGxlcicpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnU3VwZXJwb3dlcnMnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1RyYWdlZHknKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1ZpcnR1YWwgUmVhbGl0eScpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWGlhbnhpYScpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnV3V4aWEnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1h1YW5odWFuJyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdFc3BvcnRzJyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDdWx0aXZhdGlvbicpLA0KICAgICAgXSwNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmxhbmd1YWdlcyA9DQogICAgew0KICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgdmFsdWVzOiBbDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBbnknKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NoaW5lc2UnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0VuZ2xpc2gnKSwNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0tvcmVhbicpLA0KICAgICAgXSwNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnN0YXR1c2VzID0NCiAgICB7DQogICAgICBtdWx0aVNlbGVjdGlvbjogZmFsc2UsDQogICAgICB2YWx1ZXM6IFsNCiAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0FueScsIG51bGwpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnT25nb2luZycsIHRydWUpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQ29tcGxldGVkJywgZmFsc2UpLA0KICAgICAgXSwNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnNvcnRUeXBlcyA9DQogICAgew0KICAgICAgbXVsdGlTZWxlY3Rpb246IGZhbHNlLA0KICAgICAgdmFsdWVzOiBbDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdOYW1lJyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdQb3B1bGFyJyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDaGFwdGVycycpLA0KICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTmV3JyksDQogICAgICAgIG5ldyBsYWJlbFZhbHVlKCdSYXRpbmcnKSwNCiAgICAgIF0sDQogICAgfTsNCg0KDQogICAgcmV0dXJuT2JqZWN0LmdldFNlY3Rpb25zID0gKGtleXMpID0+IHsNCiAgICAgICAgdmFyIHNlY3Rpb25zID0gWw0KICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICBuZXcgU2VjdGlvbigibmV3IiwgIk5ldyBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgSHR0cENsaWVudC5jbG9uZUl0ZW0ocmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgeyBzb3J0VHlwZTogIk5ldyIgfSkpLA0KICAgICAgICAgIG5ldyBTZWN0aW9uKCJwb3B1bGFyIiwgIlBvcHVsYXIgTm92ZWwiLCAiU2VhcmNoIiwgZmFsc2UsIEh0dHBDbGllbnQuY2xvbmVJdGVtKHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHsgc29ydFR5cGU6ICJQb3B1bGFyIiB9KSksDQogICAgICAgICAgbmV3IFNlY3Rpb24oImNvbXBsZXRlZCIsICJDb21wbGV0ZWQgTm92ZWwiLCAiU2VhcmNoIiwgZmFsc2UsIEh0dHBDbGllbnQuY2xvbmVJdGVtKHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHsgYWN0aXZlOiBmYWxzZSB9KSkNCiAgICAgICAgXQ0KICAgIA0KICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmlsdGVyKHggPT4gIWtleXMgfHwga2V5cy5pbmNsdWRlcyh4Lm5hbWUpKTsNCiAgICAgIH0NCiAgICANCiAgICAgIHJldHVybk9iamVjdC50cmFuc2xhdGVTZWN0aW9uID0gYXN5bmMgKHNlY3Rpb24sIHBhZ2UpID0+IHsNCiAgICAgICAgaWYgKHNlY3Rpb24uaWRlbnRpZmllciA9PSAiTGF0ZXN0IikNCiAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0dXJuT2JqZWN0LmxhdGVzdChwYWdlKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgICAgfQ0KICAgIA0KICAgICAgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIgPSAoKSA9PiB7DQogICAgICAgIHZhciBmaWx0ZXIgPSBuZXcgRmlsdGVyKCk7DQogICAgICAgIGZpbHRlci5sYW5ndWFnZSA9IHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5sYW5ndWFnZXMudmFsdWVzLmZpbmRBdCgwKS52YWx1ZTsNCiAgICAgICAgZmlsdGVyLnNvcnRUeXBlID0gcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnNvcnRUeXBlcy52YWx1ZXMuZmluZEF0KDApLnZhbHVlOw0KICAgICAgICBmaWx0ZXIuYWN0aXZlID0gcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnN0YXR1c2VzLnZhbHVlcy5maW5kQXQoMCkudmFsdWU7DQogICAgICAgIHJldHVybiBmaWx0ZXI7DQogICAgICB9DQogICAgDQogICAgICByZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSk9PiB7DQogICAgICAgIHZhciBkYXRhID0gYXdhaXQgSHR0cENsaWVudC5wb3N0SnNvbihyZXR1cm5PYmplY3Quc2VhcmNoVXJsLCBmaWx0ZXIpOw0KICAgICAgICByZXR1cm4gZGF0YSAmJiBkYXRhLml0ZW1zDQogICAgICAgICAgPyBkYXRhLml0ZW1zLmZpbHRlcigoeCkgPT4gIXguc25lYWtQZWVrKS5tYXAoDQogICAgICAgICAgICAoeCkgPT4NCiAgICAgICAgICAgICAgbmV3IExpZ2h0SXRlbSgNCiAgICAgICAgICAgICAgICB4LmNvdmVyVXJsLA0KICAgICAgICAgICAgICAgIHgubmFtZSwNCiAgICAgICAgICAgICAgICB4LnN5bm9wc2lzLA0KICAgICAgICAgICAgICAgIHguc2x1Zy51cmkoJ2h0dHBzOi8vd3d3Lnd1eGlhd29ybGQuY29tL25vdmVsLycpLCByZXR1cm5PYmplY3QubmFtZQ0KICAgICAgICAgICAgICApLA0KICAgICAgICAgICkNCiAgICAgICAgICA6IFtdOw0KICAgICAgfQ0KICAgIA0KICAgICAgcmV0dXJuT2JqZWN0LmdldE5vdmVsPSBhc3luYyAobm92ZWxVcmwpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsKSk7DQogICAgICAgIHZhciBjaGFwdGVycyA9IFtdOw0KICAgICAgICBjb250YWluZXIuZmluZCgnLm5vdmVsLWNvbnRlbnQgLmNoYXB0ZXItaXRlbSBhJykuZm9yRWFjaCgoeCkgPT4gew0KICAgICAgICAgIGNoYXB0ZXJzLnB1c2goDQogICAgICAgICAgICBuZXcgQ2hhcHRlcigNCiAgICAgICAgICAgICAgeC50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgICAgeC5hdHRyKCJocmVmIikudXJsKCkNCiAgICAgICAgICAgICksDQogICAgICAgICAgKTsNCiAgICAgICAgfSk7DQogICAgDQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgDQogICAgICAgIHZhciBub2RlID0gY29udGFpbmVyLnNlbGVjdCgiLm5vdmVsLWJvZHkiKTsNCiAgICANCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGNvbnRhaW5lci5maW5kKCcuZ2VucmVzIGEnKS50ZXh0QXJyYXkoKTsNCiAgICAgICAgdmFyIGF1dGhvciA9IG5vZGUuc2VsZWN0KCJkdDpjb250YWlucyhBdXRob3IpIikNCiAgICAgICAgbm92ZWxSZXZpZXdzLmF1dGhvciA9IGF1dGhvci5jbG9zZXN0KCJkaXYiKS5maW5kKCJkZCIpLnRleHQoZmFsc2UpOw0KICAgICAgICByZXR1cm4gbmV3IERldGFsaUl0ZW0oDQogICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLmltZy10aHVtYm5haWwnKS5hdHRyKCJzcmMiKS51cmwoKSwNCiAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcubm92ZWwtYm9keSBoMicpLnRleHQoZmFsc2UpLA0KICAgICAgICAgIGNvbnRhaW5lci5maW5kKCcubm92ZWwtYm90dG9tID5kaXYnKS5lcSgxKS5jbGVhbklubmVySFRNTCgpLA0KICAgICAgICAgIG5vdmVsVXJsLA0KICAgICAgICAgIGNoYXB0ZXJzLA0KICAgICAgICAgIG5vdmVsUmV2aWV3cywNCiAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgKTsNCiAgICAgIH0NCiAgICANCiAgICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyPSBhc3luYyAodXJsKSA9PiB7DQogICAgICAgIHJldHVybiByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IG5ldyBjbGllbnQoKS5nZXRIdG1sKHVybCkpLnNlbGVjdCgnI2NoYXB0ZXItY29udGVudCcpLmNsZWFuSW5uZXJIVE1MKCk7DQogICAgICB9DQogICAgDQogICAgICByZXR1cm5PYmplY3QubGF0ZXN0PSBhc3luYyAocGFnZSkgPT57DQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbChyZXR1cm5PYmplY3QubGF0ZXN0VXJsKSk7DQogICAgICAgIHJldHVybiBjb250YWluZXIuZmluZCgnLnNlY3Rpb24tY29udGVudCAudGl0bGUgYScpLm1hcCgoeCkgPT4gew0KICAgICAgICAgIHJldHVybiBuZXcgTGlnaHRJdGVtKGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgIHZhciBlbGVtID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwoeC5hdHRyKCdocmVmJykudXJsKCksIHRydWUpKQ0KICAgICAgICAgICAgcmV0dXJuIGVsZW0uc2VsZWN0KCIuaW1nLXRodW1ibmFpbCIpLmF0dHIoInNyYyIpLnVybCgpOw0KICAgICAgICAgIH0sIHgudGV4dChmYWxzZSksICcnLCB4LmF0dHIoJ2hyZWYnKS51cmwoKSwgcmV0dXJuT2JqZWN0Lm5hbWUpOw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgIHJldHVybiByZXR1cm5PYmplY3Q7DQp9Ow==&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS53dXhpYXdvcmxkX3NpdGUiOw0KICAgIHJldHVybk9iamVjdC5kZXRhbGlJdGVtVHlwZSA9IERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJMYW5ndWFnZSA9ICJlbiI7DQogICAgcmV0dXJuT2JqZWN0Lm5hbWUgPSAnV3V4aWF3b3JsZC5TaXRlJzsNCiAgICByZXR1cm5PYmplY3QuZGlzcGxheU5hbWUgPSAiVy1Ob3ZlbC1TIjsNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0VXJsID0gJ2h0dHBzOi8vd3V4aWF3b3JsZC5zaXRlL3BhZ2Uve3B9Lyc7DQogICAgcmV0dXJuT2JqZWN0LnVybCA9ICdodHRwczovL3d1eGlhd29ybGQuc2l0ZSc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICdodHRwczovL3d1eGlhd29ybGQuc2l0ZS93cC1hZG1pbi9hZG1pbi1hamF4LnBocCc7DQogICAgcmV0dXJuT2JqZWN0LnBhbmluYXRpb24gPSB0cnVlOw0KICAgIHJldHVybk9iamVjdC5zZWFyY2hQYWdpbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3QuaWNvbiA9ICdodHRwczovL3d1eGlhd29ybGQuYi1jZG4ubmV0L3dwLWNvbnRlbnQvdXBsb2Fkcy8yMDE5LzA0L2Zhdmljb24tMS5pY28nOw0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzID0gbmV3IFBhcnNlclNlYXJjaFNldHRpbmdzKCk7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLm11bHRpU2VsZWN0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3QucGFyc2VyU2VhcmNoU2V0dGluZ3MuZ2VucmVzID0NCiAgICB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdBY3Rpb24nLCAiYWN0aW9uIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWR1bHQnLCAiYWR1bHQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJEcmFtYSIsICJkcmFtYSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkVjY2hpIiwgImVjY2hpIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQWR2ZW50dXJlJywgImFkdmVudHVyZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkdlbmRlciBCZW5kZXIiLCAiZ2VuZGVyLWJlbmRlciIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhpc3RvcmljYWwiLCAiaGlzdG9yaWNhbCIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIkhvcnJvciIsICJob3Jyb3IiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJJc2VrYWkiLCAiaXNla2FpIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiSm9zZWkiLCAiam9zZWkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJMR0JUKyIsICJsZ2J0IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWFnaWNhbCBSZWFsaXNtIiwgIm1hZ2ljYWwtcmVhbGlzbSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1hbmh3YSIsICJtYW5od2EiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJNYXJ0aWFsIEFydHMiLCAibWFydGlhbC1hcnRzIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiTWF0dXJlIiwgIm1hdHVyZSIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIk1lY2hhIiwgIm1lY2hhIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUHN5Y2hvbG9naWNhbCIsICJwc3ljaG9sb2dpY2FsIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiUmVpbmNhcm5hdGlvbiIsICJyZWluY2FybmF0aW9uIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2Nob29sIExpZmUiLCAic2Nob29sLWxpZmUiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTZWluZW4iLCAic2VpbmVuIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiU2hvdWpvIiwgInNob3VqbyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIlNob3Vqby1BaSIsICJzaG91am8tYWkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTaG91bmVuIiwgInNob3VuZW4iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTaG91bmVuLUFpIiwgInNob3VuZW4tYWkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTbGljZSBvZiBMaWZlIiwgInNsaWNlLW9mLWxpZmUiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTbXV0IiwgInNtdXQiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJTdXBlcm5hdHVyYWwiLCAic3VwZXJuYXR1cmFsIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgiVGhyaWxsZXIiLCAidGhyaWxsZXIiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJUZWVuIiwgInRlZW4iKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJWaWRlbyBHYW1lcyIsICJ2aWRlby1nYW1lcyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoIldlYmNvbWljcyIsICJ3ZWJjb21pY3MiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdDb21lZHknLCAiY29tZWR5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnRmFudGFzeScsICJmYW50YXN5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnSGFyZW0nLCAiaGFyZW0tbm92ZWwiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdZYW9pJywgInlhb2kiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCJZdXJpIiwgInl1cmkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdLaW5nZG9tIEJ1aWxkaW5nJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnTW9kZXJuIFNldHRpbmcnKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdNeXN0ZXJ5JywgIm15c3RlcnkiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdSb21hbmNlJywgInJvbWFuY2UiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdTY2ktZmknLCAic2NpLWZpIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVHJhZ2VkeScsICJ0cmFnZWR5IiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnVmlydHVhbCBSZWFsaXR5JyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnWGlhbnhpYScsICJ4aWFueGlhIiksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnV3V4aWEnLCAid3V4aWEiKSwNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdYdWFuaHVhbicsICJ4dWFuaHVhbiIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ1Nwb3J0cycsICJzcG9ydHMiKSwNCiAgICAgICAgXSwNCiAgICB9Ow0KDQogICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLnN0YXR1c2VzID0NCiAgICB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiBmYWxzZSwNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnT25nb2luZycsICJvbi1nb2luZyIpLA0KICAgICAgICAgICAgbmV3IGxhYmVsVmFsdWUoJ0NvbXBsZXRlZCcsICJlbmQiKSwNCiAgICAgICAgXSwNCiAgICB9Ow0KDQoNCiAgICByZXR1cm5PYmplY3QuZ2V0U2VjdGlvbnMgPSAoa2V5cykgPT4gew0KICAgICAgICB2YXIgc2VjdGlvbnMgPSBbDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibGF0ZXN0IiwgIkxhdGVzdCBVcGRhdGUiLCAiTGF0ZXN0IiwgdHJ1ZSksDQogICAgICAgICAgICBuZXcgU2VjdGlvbigibWFuZ2EiLCAiQ29taWNzIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsid2ViY29taWNzIl0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJhY3Rpb24iLCAiQWN0aW9uIE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsiYWN0aW9uIl0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJhZHVsdCIsICJBZHVsdCBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcihbImFkdWx0Il0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJyb21hbmNlIiwgIlJvbWFuY2UgTm92ZWwiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIoWyJyb21hbmNlIl0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJkcmFtYSIsICJEcmFtYSBOb3ZlbCIsICJTZWFyY2giLCBmYWxzZSwgbmV3IEZpbHRlcihbImRyYW1hIl0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJjb21wbGV0ZWQiLCAiQ29tcGxldGVkIE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsICJlbmQiKSkNCiAgICAgICAgXQ0KDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC50cmFuc2xhdGVTZWN0aW9uID0gYXN5bmMgKHNlY3Rpb24sIHBhZ2UpID0+IHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChzZWN0aW9uLmlkZW50aWZpZXIgPT0gIkxhdGVzdCIpDQogICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5zZWFyY2goc2VjdGlvbi5maWx0ZXIgfHwgcmV0dXJuT2JqZWN0LmRlZmF1bHRGaWx0ZXIoKSwgcGFnZSk7DQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcikNCiAgICAgICAgICAgIHJldHVybiBbXTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICByZXR1cm4gbmV3IEZpbHRlcigpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRUeXBlID0gKHVybCkgPT4gew0KICAgICAgICB2YXIgdXJsID0gdXJsLnRvTG93ZXJDYXNlKCk7DQogICAgICAgIGlmICh1cmwuaW5kZXhPZigibWFuZ2EiKSAhPSAtMSB8fCB1cmwuaW5kZXhPZigiY29taWMiKSAhPSAtMSB8fCB1cmwuaW5kZXhPZigiY29taWNzIikgIT0gLTEgfHwgdXJsLmluZGV4T2YoIndlYmNvbWljcyIpICE9IC0xKQ0KICAgICAgICAgICAgcmV0dXJuIERldGFsaUl0ZW1UeXBlLk1hbmFnYTsNCiAgICAgICAgcmV0dXJuIERldGFsaUl0ZW1UeXBlLk5vdmVsOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRCeUdlbnJlcyA9IGFzeW5jIChmaWx0ZXIsIHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgICB2YXIgYWR2YW5jZWRTZWFjaFVybCA9ICJodHRwczovL3d1eGlhd29ybGQuc2l0ZS9wYWdlLyIrcGFnZSsiLz9zPSZwb3N0X3R5cGU9d3AtbWFuZ2Eme2d9Jm9wJmF1dGhvciZhcnRpc3QmcmVsZWFzZSZhZHVsdCZ7c30iDQogICAgICAgIGlmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDApDQogICAgICAgICAgICBhZHZhbmNlZFNlYWNoVXJsID0gYWR2YW5jZWRTZWFjaFVybC5yZXBsYWNlKCJ7Z30iLCBmaWx0ZXIuZ2VucmVzLm1hcCh4ID0+ICJnZW5yZSU1QiU1RD0iICt4KS5qb2luKCImIikpDQogICAgICAgIGVsc2UgYWR2YW5jZWRTZWFjaFVybCA9IGFkdmFuY2VkU2VhY2hVcmwucmVwbGFjZSgiJntnfSIsICIiKQ0KDQogICAgICAgIGlmIChmaWx0ZXIuYWN0aXZlICYmIGZpbHRlci5hY3RpdmUgIT0gIiIpDQogICAgICAgICAgICBhZHZhbmNlZFNlYWNoVXJsID0gYWR2YW5jZWRTZWFjaFVybC5yZXBsYWNlKCJ7c30iLCBmaWx0ZXIuYWN0aXZlKTsNCiAgICAgICAgZWxzZSBhZHZhbmNlZFNlYWNoVXJsID0gYWR2YW5jZWRTZWFjaFVybC5yZXBsYWNlKCIme3N9IiwgIiIpOw0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwoYWR2YW5jZWRTZWFjaFVybCkpOw0KICAgICAgICBjb250YWluZXIuZmluZCgiLmMtdGFicy1pdGVtX19jb250ZW50IikuZm9yRWFjaCh4ID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKA0KICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0oDQogICAgICAgICAgICAgICAgICAgIHguc2VsZWN0KCIudGFiLXRodW1iIGltZyIpLmF0dHIoInNyYyB8IHNyY3NldCIpLnVybCgpLA0KICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnRhYi10aHVtYiBhIikuYXR0cigidGl0bGUiKS50ZXh0KCksDQogICAgICAgICAgICAgICAgICAgICIiLA0KICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnRhYi10aHVtYiBhIikuYXR0cigiaHJlZiIpLnVybCgpLA0KICAgICAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0LmdldFR5cGUoeC5zZWxlY3QoIi50YWItdGh1bWIgYSIpLmF0dHIoImhyZWYiKS51cmwoKSkNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICApDQogICAgICAgIH0pDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQoNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoID0gYXN5bmMgKGZpbHRlciwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoIWZpbHRlci50aXRsZSkNCiAgICAgICAgZmlsdGVyLnRpdGxlID0iIjsNCiAgICAgICAgaWYgKChmaWx0ZXIudGl0bGUuaXNFbXB0eU9yU3BhY2VzKCkpICYmIChmaWx0ZXIuZ2VucmVzLmxlbmd0aCA+IDAgfHwgKCFmaWx0ZXIuYWN0aXZlICYmIGZpbHRlci5hY3RpdmUgIT0gIiIpKSkNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3QuZ2V0QnlHZW5yZXMoZmlsdGVyLCBwYWdlKTsNCg0KICAgICAgICBpZiAoZmlsdGVyLnRpdGxlLmlzRW1wdHlPclNwYWNlcygpKQ0KICAgICAgICAgICAgcmV0dXJuIFtdOw0KDQoNCiAgICAgICAgdmFyIGpzb24gPSBhd2FpdCBIdHRwQ2xpZW50LnBvc3RGb3JtKHJldHVybk9iamVjdC5zZWFyY2hVcmwsIHsgYWN0aW9uOiAid3AtbWFuZ2Etc2VhcmNoLW1hbmdhIiwgdGl0bGU6IGZpbHRlci50aXRsZSB9KTsNCg0KICAgICAgICBpZiAoanNvbiAmJiBqc29uLmRhdGEgJiYganNvbi5kYXRhLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHJldHVybiBqc29uLmRhdGEubWFwKHggPT4gew0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgICAgICBhc3luYyAoKSA9PiAoYXdhaXQgcmV0dXJuT2JqZWN0LmdldE5vdmVsKHgudXJsLnVyaShyZXR1cm5PYmplY3QudXJsKSwgdHJ1ZSkpLmltYWdlLA0KICAgICAgICAgICAgICAgICAgICB4LnRpdGxlLA0KICAgICAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICAgICAgeC51cmwudXJpKHJldHVybk9iamVjdC51cmwpLA0KICAgICAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0LmdldFR5cGUoeC50eXBlIHx8IHgudXJsKQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIFtdOw0KDQogICAgfQ0KDQogICAgcmV0dXJuT2JqZWN0LmdldENoYXB0ZXJzID0gYXN5bmMgKGNvbnRhaW5lcikgPT4gew0KICAgICAgICB2YXIgdXJsID0gImh0dHBzOi8vd3V4aWF3b3JsZC5zaXRlL3dwLWFkbWluL2FkbWluLWFqYXgucGhwIjsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gY29udGFpbmVyLnNlbGVjdCgiLmxpc3RpbmctY2hhcHRlcnNfd3JhcCIpLmhhc0VsZW1lbnQoKSAmJiBjb250YWluZXIuZmluZCgiLmxpc3RpbmctY2hhcHRlcnNfd3JhcCBhIikubGVuZ3RoKCkgPiAxID8gY29udGFpbmVyLmZpbmQoIi5saXN0aW5nLWNoYXB0ZXJzX3dyYXAgYSIpIDogcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LnBvc3RGb3JtKHVybCwgeyBhY3Rpb246ICJtYW5nYV9nZXRfY2hhcHRlcnMiLCBtYW5nYTogY29udGFpbmVyLnNlbGVjdCgiLnJhdGluZy1wb3N0LWlkIikuYXR0cigidmFsdWUiKS50ZXh0KCkgfSkpLmZpbmQoImEiKTsNCiAgICAgICAgcmV0dXJuIGNoYXB0ZXJzLm1hcCgoeCkgPT4gew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGFwdGVyKA0KICAgICAgICAgICAgICAgIHgudGV4dChmYWxzZSksDQogICAgICAgICAgICAgICAgeC5hdHRyKCJocmVmIikudXJsKCkNCiAgICAgICAgICAgICk7DQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXROb3ZlbCA9IGFzeW5jIChub3ZlbFVybCwgaWdub3JlQ2hhcHRlcnMpID0+IHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKG5vdmVsVXJsLCBpZ25vcmVDaGFwdGVycykpOw0KICAgICAgICB2YXIgY2hhcHRlcnMgPSBbXTsNCiAgICAgICAgaWYgKCFpZ25vcmVDaGFwdGVycykgew0KICAgICAgICAgICAgY2hhcHRlcnMgPSBhd2FpdCByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlcnMoY29udGFpbmVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQogICAgICAgIGlmICghaWdub3JlQ2hhcHRlcnMpIHsNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cy51dm90ZXMgPSBjb250YWluZXIuc2VsZWN0KCIudm90ZS1kZXRhaWxzIikucmVtb3ZlKCdbcHJvcGVydHk9Iml0ZW1SZXZpZXdlZCJdJykudGV4dChmYWxzZSk7DQogICAgICAgICAgICBub3ZlbFJldmlld3MuYXV0aG9yID0gY29udGFpbmVyLmZpbmQoIi5hdXRob3ItY29udGVudCBhIikudGV4dChmYWxzZSk7DQogICAgICAgICAgICBub3ZlbFJldmlld3MuZ2VucmVzID0gY29udGFpbmVyLmZpbmQoIi5nZW5yZXMtY29udGVudCBhIikudGV4dEFycmF5KCk7DQogICAgICAgICAgICBub3ZlbFJldmlld3MuY29tcGxldGVkID0gY29udGFpbmVyLmZpbmQoIi5wb3N0LWNvbnRlbnRfaXRlbSIpLndoZXJlKHggPT4geC5pbm5lckhUTUwoKS5pbmRleE9mKCJDb21wbGV0ZWQiKSAhPSAtMSkuaGFzRWxlbWVudCgpID8gIlN0YXR1czpDb21wbGV0ZWQiIDogIlN0YXR1czpPbmdvaW5nIjsNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cy5kZXNjcmlwdGlvbiA9IGNvbnRhaW5lci5zZWxlY3QoIi5kZXNjcmlwdGlvbi1zdW1tYXJ5IikuY2xlYW5Jbm5lckhUTUwoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBuZXcgRGV0YWxpSXRlbSgNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy5zdW1tYXJ5X2ltYWdlIGltZycpLmF0dHIoInNyYyB8IHNyY3NldCIpLnVybCgpLA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLnBvc3QtdGl0bGUnKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgIG5vdmVsUmV2aWV3cy5kZXNjcmlwdGlvbiB8fCAiIiwNCiAgICAgICAgICAgIG5vdmVsVXJsLA0KICAgICAgICAgICAgY2hhcHRlcnMucmV2ZXJzZSgpLA0KICAgICAgICAgICAgbm92ZWxSZXZpZXdzLA0KICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUsDQogICAgICAgICAgICAiIiwNCiAgICAgICAgICAgIHJldHVybk9iamVjdC5nZXRUeXBlKG5vdmVsVXJsKQ0KICAgICAgICApOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRDaGFwdGVyID0gYXN5bmMgKHVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBuZXcgY2xpZW50KCkuZ2V0SHRtbCh1cmwpKS5yZW1vdmUoInNjcmlwdCIpLnJlbW92ZSgic3R5bGUiKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9ICIiOw0KICAgICAgICBpZiAocmV0dXJuT2JqZWN0LmdldFR5cGUodXJsKSA9PT0gRGV0YWxpSXRlbVR5cGUuTWFuYWdhKQ0KICAgICAgICAgICAgcmVzdWx0ID0gY29udGFpbmVyLmZpbmQoIi5yZWFkaW5nLWNvbnRlbnQgaW1nIikubWFwKHggPT4geC5hdHRyKCJzcmMiKS5oYXNWYWx1ZSgpID8geC5hdHRyKCJzcmMiKS51cmwoKSA6ICIiKS5maWx0ZXIoeCA9PiAheC5pc0VtcHR5T3JTcGFjZXMoKSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJlc3VsdCA9IGNvbnRhaW5lci5zZWxlY3QoIi5yZWFkaW5nLWNvbnRlbnQiKS5jbGVhbklubmVySFRNTCgpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5sYXRlc3QgPSBhc3luYyAocGFnZSkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwocmV0dXJuT2JqZWN0LmxhdGVzdFVybC5yZXBsYWNlKCJ7cH0iLCBwYWdlLnRvU3RyaW5nKCkpKSk7DQoNCiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5maW5kKCIucGFnZS1pdGVtLWRldGFpbCIpLm1hcCh4ID0+IHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgTGlnaHRJdGVtKA0KICAgICAgICAgICAgICAgIHguc2VsZWN0KCJpbWciKS5hdHRyKCJzcmMgfCBzcmNzZXQiKS51cmwoKSwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnBvc3QtdGl0bGUgYSIpLnRleHQoKSwNCiAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICB4LnNlbGVjdCgiLnBvc3QtdGl0bGUgYSIpLmF0dHIoImhyZWYiKS51cmwoKSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QubmFtZSwNCiAgICAgICAgICAgICAgICByZXR1cm5PYmplY3QuZ2V0VHlwZSh4LnNlbGVjdCgiLnBvc3QtdGl0bGUgYSIpLmF0dHIoImhyZWYiKS51cmwoKSkNCiAgICAgICAgICAgICkNCiAgICAgICAgfSkNCiAgICB9DQoNCg0KICAgIHJldHVybiByZXR1cm5PYmplY3Q7DQp9Ow==&KFNlY3Rpb24sIENoYXB0ZXIsIEh0dHBDbGllbnQsIERldGFsaUl0ZW0sIExpZ2h0SXRlbSwgUGFyc2VyU2VhcmNoU2V0dGluZ3MsIEZpbHRlciwgbGFiZWxWYWx1ZSwgRGV0YWxpSXRlbVR5cGUsIE5vdmVsUmV2aWV3cywgY2xpZW50LCBJbWFnZUhhbmRsZXIpID0+IHsNCiAgICBjb25zdCByZXR1cm5PYmplY3QgPSB7fTsNCiAgICByZXR1cm5PYmplY3QuaWQgPSAiMS56aW5ub3ZlbCI7DQogICAgcmV0dXJuT2JqZWN0LmRldGFsaUl0ZW1UeXBlID0gRGV0YWxpSXRlbVR5cGUuTm92ZWw7DQogICAgcmV0dXJuT2JqZWN0LnBhcnNlckxhbmd1YWdlID0gImVuIjsNCiAgICByZXR1cm5PYmplY3QubmFtZSA9ICdaaW5Ob3ZlbCc7DQogICAgcmV0dXJuT2JqZWN0LmRpc3BsYXlOYW1lID0gIlotTm92ZWwiOw0KICAgIHJldHVybk9iamVjdC5sYXRlc3RVcmwgPSAnaHR0cHM6Ly96aW5ub3ZlbC5jb20vcGFnZS97cH0vJzsNCiAgICByZXR1cm5PYmplY3QudXJsID0gJ2h0dHBzOi8vemlubm92ZWwuY29tLyc7DQogICAgcmV0dXJuT2JqZWN0LnNlYXJjaFVybCA9ICcnOw0KICAgIHJldHVybk9iamVjdC5wYW5pbmF0aW9uID0gdHJ1ZTsNCiAgICByZXR1cm5PYmplY3Quc2VhcmNoUGFnaW5hdGlvbiA9IGZhbHNlOw0KICAgIHJldHVybk9iamVjdC5pY29uID0gJ2h0dHBzOi8vemlubm92ZWwuY29tL3dwLWNvbnRlbnQvdXBsb2Fkcy8yMDIwLzA3L2Nyb3BwZWQtVW50aXRsZWQtMi0zMngzMi5qcGcnOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncyA9IG5ldyBQYXJzZXJTZWFyY2hTZXR0aW5ncygpOw0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5nZW5yZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgICB2YWx1ZXM6IFtdLA0KICAgIH07DQoNCg0KICAgIHJldHVybk9iamVjdC5wYXJzZXJTZWFyY2hTZXR0aW5ncy5zb3J0VHlwZXMgPSB7DQogICAgICAgIG11bHRpU2VsZWN0aW9uOiB0cnVlLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICAgIG5ldyBsYWJlbFZhbHVlKCdPbmdvaW5nJywgJ29uLWdvaW5nJyksDQogICAgICAgICAgICBuZXcgbGFiZWxWYWx1ZSgnQ29tcGxldGVkIE5vdmVsJywgJ2VuZCcpLA0KICAgICAgICBdLA0KICAgIH07DQoNCg0KICAgIHJldHVybk9iamVjdC5sb2FkU2V0dGluZ3MgPSBhc3luYyAoKSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAocmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcy52YWx1ZXMubGVuZ3RoIDw9IDApIHsNCiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwoImh0dHBzOi8vemlubm92ZWwuY29tLz9zPSZwb3N0X3R5cGU9d3AtbWFuZ2EiKSkNCiAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgiI3NlYXJjaC1hZHZhbmNlZCAuY2hlY2tib3gtZ3JvdXAgLmNoZWNrYm94IikuZm9yRWFjaChhID0+IHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuT2JqZWN0LnBhcnNlclNlYXJjaFNldHRpbmdzLmdlbnJlcy52YWx1ZXMucHVzaChuZXcgbGFiZWxWYWx1ZShhLmZpbmQoImxhYmVsIikudGV4dCgpLCBhLmZpbmQoImlucHV0IikuYXR0cigidmFsdWUiKS50ZXh0KCkpKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5sb2coKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5nZXRTZWN0aW9ucyA9IChrZXlzKSA9PiB7DQogICAgICAgIHZhciBzZWN0aW9ucyA9IFsNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJsYXRlc3QiLCAiTGF0ZXN0IFVwZGF0ZSIsICJMYXRlc3QiLCB0cnVlKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJhY3Rpb24iLCAiQWN0aW9uIE5vdmVsIiwgIlNlYXJjaCIsIGZhbHNlLCBuZXcgRmlsdGVyKFsiYWN0aW9uIl0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJyb21hbmNlIiwgIlJvbWFuY2UgTm92ZWwiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIoWyJyb21hbmNlIl0pKSwNCiAgICAgICAgICAgIG5ldyBTZWN0aW9uKCJvbmdvaW5nIiwgIk9uZ29pbmcgTm92ZWwiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAiZW5kIikpLA0KICAgICAgICAgICAgbmV3IFNlY3Rpb24oImNvbXBsZXRlZCIsICJDb21wbGV0ZWQgTm92ZWwiLCAiU2VhcmNoIiwgZmFsc2UsIG5ldyBGaWx0ZXIodW5kZWZpbmVkLCAiZW5kIikpDQoNCiAgICAgICAgXQ0KDQogICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoeCA9PiAha2V5cyB8fCBrZXlzLmluY2x1ZGVzKHgubmFtZSkpOw0KICAgIH0NCg0KICAgIHRyYW5zbGF0ZVNlY3Rpb24gPSBhc3luYyAoc2VjdGlvbiwgcGFnZSkgPT4gew0KICAgICAgICBpZiAoc2VjdGlvbi5pZGVudGlmaWVyID09ICJMYXRlc3QiKQ0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHVybk9iamVjdC5sYXRlc3QocGFnZSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXR1cm5PYmplY3Quc2VhcmNoKHNlY3Rpb24uZmlsdGVyIHx8IHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyKCksIHBhZ2UpOw0KICAgIH0NCg0KICAgIHJldHVybk9iamVjdC5kZWZhdWx0RmlsdGVyID0gKCkgPT4gew0KICAgICAgICB2YXIgZmlsdGVyID0gbmV3IEZpbHRlcigpOw0KICAgICAgICByZXR1cm4gZmlsdGVyOw0KICAgIH0NCiAgICAvL2h0dHBzOi8vemlubm92ZWwuY29tLz9zPXtzfSZwb3N0X3R5cGU9d3AtbWFuZ2EmZ2VucmUlNUIlNUQ9YWN0aW9uJmdlbnJlJTVCJTVEPWFkdmVudHVyZSZvcD0mYXV0aG9yPSZhcnRpc3Q9JnJlbGVhc2U9JmFkdWx0PSZzdGF0dXMlNUIlNUQ9ZW5kJnN0YXR1cyU1QiU1RD1vbi1nb2luZw0KICAgIHJldHVybk9iamVjdC5zZWFyY2ggPSBhc3luYyAoZmlsdGVyLCBwYWdlKSA9PiB7DQogICAgICAgIHZhciB1cmwgPSAiaHR0cHM6Ly96aW5ub3ZlbC5jb20vP3M9IiArKGZpbHRlci50aXRsZSB8fCAiIikrIiZwb3N0X3R5cGU9d3AtbWFuZ2Eme2dlbnJlfSZvcD0mYXV0aG9yPSZhcnRpc3Q9JnJlbGVhc2U9JmFkdWx0PSZ7c3RhdHVzfSINCiAgICAgICAgaWYgKGZpbHRlci5nZW5yZXMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIntnZW5yZX0iLCBmaWx0ZXIuZ2VucmVzLm1hcCh4ID0+ICJnZW5yZSU1QiU1RD0iK3gpLmpvaW4oIiYiKSk7DQogICAgICAgIH0gZWxzZSB1cmwgPSB1cmwucmVwbGFjZSgiJntnZW5yZX0iLCAiIik7DQoNCiAgICAgICAgaWYgKGZpbHRlci5zb3J0VHlwZSAmJiBmaWx0ZXIuc29ydFR5cGUubGVuZ3RoID4gMSkNCiAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCJ7c3RhdHVzfSIsICJzdGF0dXMlNUIlNUQ9IiArZmlsdGVyLnNvcnRUeXBlKTsNCiAgICAgICAgZWxzZSB1cmwgPSB1cmwucmVwbGFjZSgiJntzdGF0dXN9IiwgIiIpOw0KDQogICAgICAgIHZhciBjb250YWluZXIgPSByZXR1cm5PYmplY3QucGFyc2VyLmpxKGF3YWl0IEh0dHBDbGllbnQuZ2V0SHRtbCh1cmwpKTsNCiAgICAgICAgdmFyIHJlc3VsdCA9IFtdDQogICAgICAgIGNvbnRhaW5lci5maW5kKCcuYy10YWJzLWl0ZW0gLnJvdycpLmZvckVhY2goKHgpID0+IHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKA0KICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0oeC5maW5kKCJpbWciKS5hdHRyKCJkYXRhLXNyYyIpLnVybCgpLA0KICAgICAgICAgICAgICAgICAgICB4LnNlbGVjdCgnLnBvc3QtdGl0bGUgYScpLnRleHQoZmFsc2UpLA0KICAgICAgICAgICAgICAgICAgICAnJywNCiAgICAgICAgICAgICAgICAgICAgeC5zZWxlY3QoJy5wb3N0LXRpdGxlIGEnKS5hdHRyKCJocmVmIikudXJsKCksIHJldHVybk9iamVjdC5uYW1lDQogICAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQoNCg0KICAgIHJldHVybk9iamVjdC5nZXROb3ZlbCA9IGFzeW5jIChub3ZlbFVybCkgPT4gew0KICAgICAgICB2YXIgY29udGFpbmVyID0gcmV0dXJuT2JqZWN0LnBhcnNlci5qcShhd2FpdCBIdHRwQ2xpZW50LmdldEh0bWwobm92ZWxVcmwpKTsNCiAgICAgICAgdmFyIGNoYXB0ZXJzID0gY29udGFpbmVyLmZpbmQoIi5saXN0aW5nLWNoYXB0ZXJzX3dyYXAgbGkgYSIpLm1hcCh4ID0+IG5ldyBDaGFwdGVyKHgudGV4dChmYWxzZSksIHguYXR0cigiaHJlZiIpLnVybCgpKSkucmV2ZXJzZSgpDQogICAgICAgIHZhciBub3ZlbFJldmlld3MgPSBuZXcgTm92ZWxSZXZpZXdzKCk7DQoNCiAgICAgICAgbm92ZWxSZXZpZXdzLmdlbnJlcyA9IGNvbnRhaW5lci5maW5kKCIuZ2VucmVzLWNvbnRlbnQgYSIpLm1hcCh4ID0+IHgudGV4dChmYWxzZSkpOw0KICAgICAgICBub3ZlbFJldmlld3MuYXV0aG9yID0gY29udGFpbmVyLmZpbmQoIi5hdXRob3ItY29udGVudCBhIikubWFwKHggPT4geC50ZXh0KGZhbHNlKSkuam9pbigiLCAiKTsNCiAgICAgICAgbm92ZWxSZXZpZXdzLnV2b3RlcyA9IGNvbnRhaW5lci5zZWxlY3QoIi5wb3N0LXJhdGluZyAudG90YWxfdm90ZXMiKS50ZXh0KGZhbHNlKSArICIgLyA1IjsNCiAgICAgICAgbm92ZWxSZXZpZXdzLmNvbXBsZXRlZCA9IGNvbnRhaW5lci5zZWxlY3QoIi5wb3N0LXN0YXR1cyAucG9zdC1jb250ZW50X2l0ZW0gLnN1bW1hcnktY29udGVudCIpLnRleHQoZmFsc2UpID09PSAiQ29tcGxldGVkIiA/ICJTdGF0dXM6Q29tcGxldGVkIiA6ICJTdGF0dXM6T25nb2luZyI7DQoNCiAgICAgICAgcmV0dXJuIG5ldyBEZXRhbGlJdGVtKA0KICAgICAgICAgICAgY29udGFpbmVyLnNlbGVjdCgnLnN1bW1hcnlfaW1hZ2UgaW1nJykuYXR0cigiZGF0YS1zcmMiKS51cmwoKSwNCiAgICAgICAgICAgIGNvbnRhaW5lci5zZWxlY3QoJy5wb3N0LXRpdGxlJykudGV4dChmYWxzZSksDQogICAgICAgICAgICBjb250YWluZXIuc2VsZWN0KCcuZGVzY3JpcHRpb24tc3VtbWFyeScpLmNsZWFuSW5uZXJIVE1MKCksDQogICAgICAgICAgICBub3ZlbFVybCwNCiAgICAgICAgICAgIGNoYXB0ZXJzLA0KICAgICAgICAgICAgbm92ZWxSZXZpZXdzLA0KICAgICAgICAgICAgcmV0dXJuT2JqZWN0Lm5hbWUsDQogICAgICAgICAgICB1bmRlZmluZWQsDQogICAgICAgICk7DQogICAgfQ0KDQoNCiAgICByZXR1cm5PYmplY3QuZ2V0Q2hhcHRlciA9IGFzeW5jICh1cmwpID0+IHsNCiAgICAgICAgcmV0dXJuIHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgbmV3IGNsaWVudCgpLmdldEh0bWwodXJsKSkuc2VsZWN0KCcucmVhZGluZy1jb250ZW50JykuY2xlYW5Jbm5lckhUTUwoKTsNCiAgICB9DQoNCiAgICByZXR1cm5PYmplY3QubGF0ZXN0ID0gYXN5bmMgKHBhZ2UpID0+IHsNCiAgICAgICAgdmFyIHVybCA9IHJldHVybk9iamVjdC5sYXRlc3RVcmwucmVwbGFjZSgne3B9JywgcGFnZS50b1N0cmluZygpKTsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJldHVybk9iamVjdC5wYXJzZXIuanEoYXdhaXQgSHR0cENsaWVudC5nZXRIdG1sKHVybCkpOw0KICAgICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICAgIGNvbnRhaW5lci5maW5kKCcucGFnZS1jb250ZW50LWxpc3RpbmcgLnBhZ2UtaXRlbS1kZXRhaWwnKS5mb3JFYWNoKCh4KSA9PiB7DQogICAgICAgICAgICBpZiAoeC5zZWxlY3QoJ2ltZycpLmF0dHIoInNyYyIpLmhhc1ZhbHVlKCkpDQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goDQogICAgICAgICAgICAgICAgICAgIG5ldyBMaWdodEl0ZW0oeC5maW5kKCJpbWciKS5hdHRyKCJkYXRhLXNyYyIpLnVybCgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgeC5zZWxlY3QoJy5wb3N0LXRpdGxlIGEnKS50ZXh0KGZhbHNlKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICcnLA0KICAgICAgICAgICAgICAgICAgICAgICAgeC5zZWxlY3QoJy5wb3N0LXRpdGxlIGEnKS5hdHRyKCJocmVmIikudXJsKCksIHJldHVybk9iamVjdC5uYW1lDQogICAgICAgICAgICAgICAgICAgICkpOw0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIHJldHVybiByZXR1cm5PYmplY3Q7DQp9Ow==